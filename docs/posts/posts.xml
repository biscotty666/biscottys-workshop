<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>biscotty&#39;s Workshop</title>
<link>https://biscotty.online/posts/posts.html</link>
<atom:link href="https://biscotty.online/posts/posts.xml" rel="self" type="application/rss+xml"/>
<description>For the love of learning</description>
<generator>quarto-1.7.31</generator>
<lastBuildDate>Tue, 20 May 2025 06:00:00 GMT</lastBuildDate>
<item>
  <title>The Magical Mulberry</title>
  <link>https://biscotty.online/posts/chinese-medicine/magical-mulberry/</link>
  <description><![CDATA[ 






<div style="float: right; width: 40%; margin-left: 10px;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="mulberry1.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Branch, fruit, leaves of the mulberry"><img src="https://biscotty.online/posts/chinese-medicine/magical-mulberry/mulberry1.jpg" class="img-fluid figure-img" style="border-radius: 5%;" alt="Picture of mulberry branch with leaves and fruit"></a></p>
<figcaption>Branch, fruit, leaves of the mulberry<sup>1</sup></figcaption>
</figure>
</div>
</div>
<p>The much maligned mulberry, banned in many places such as the USA and Brazil for its highly invasive nature, is unique in two ways: 1) it provided, directly or indirectly, a greater variety of medicinal substances than any other plant, and; 2) it changed the course of human history. This article is primarily about the former, but I’ll look at the latter later.</p>
<p>When I taught Chinese Materia Medica, a course in which students learn all of the properties of over 1,000 medicinal substances, one of the challenges was to make the subject tangible beyond the pages of the texts. At this stage in their studies, clinical experience was focused on acupuncture, and their only exposure to herbs was through books and lectures. Many plants commonly used in Chinese Medicine (CM) grow all around us, sometimes in our own back yard. In order to help them “get in touch” with the topic, my students had a regular assignment to identify and report on such herbs which they identified around town. Making connections with plants they see every day helped them to memorize their properties, functions and indications.</p>
<p>A perennial favorite was the mulberry tree, and for good reason. The mulberry tree originated in China, but spread throughout the globe, and is now considered an invasive species in many areas. It is a tree of tremendous historical as well as medical importance, being the host of the silkworm. Silk production in China was so important that the primary inter-continental trade route for 1,500 years, up until the mid-15<sup>th</sup> century was named for it: the <a href="https://en.wikipedia.org/wiki/Silk_Road">Silk Road</a>. More on that later.</p>
<p>This silkworm itself provides two medicinal substances, but the mulberry tree provides no less than four, and another parasite of the tree, mistletoe, provides yet another. It is not unusual for CM to use different parts of a plant for different purposes, but such a range is unique. Depending on the part of the tree used, it may work on acute conditions like colds and flu, or chronic conditions like atrophy. It may work on the most superficial levels of the body, or the deepest levels. Some are used to address psychological/emotional issues, others explicitly physical. Some are nourishing, others are “dispersing”<sup>2</sup>.</p>
<p>In this article, I will explore the variety of uses of the different parts of the tree. This does not constitute medical advice, and use of any herb should be approached with caution. Even those which are not toxic (none of these are) can produce unwanted side effects and be harmful to your health. Doctors of Chinese Medicine spend years of study before prescribing, and for good reason. As regards the fruit…eat up!</p>
<section id="the-tree" class="level2">
<h2 class="anchored" data-anchor-id="the-tree">The tree</h2>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><span style="font-size: 1.2em;"><em>sāng shù</em> 桑樹 <em>Mori alba</em></span></p>
</div>
</div>
</div>
<div style="float: right; width: 40%; margin-left: 10px;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="mulberrytree.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Mulberry tree"><img src="https://biscotty.online/posts/chinese-medicine/magical-mulberry/mulberrytree.jpg" class="img-fluid figure-img" style="border-radius: 5%;" alt="Picture of a mulberry tree"></a></p>
<figcaption>Mulberry tree<sup>3</sup></figcaption>
</figure>
</div>
</div>
<p>I should specify that I am discussing the white mulberry. Despite the wide range of functions and indications attributed to the various parts, we can, never-the-less, identify some commonalities. CM classifies pharmacuticals in various ways including their nature<sup>4</sup>, flavor<sup>5</sup>, part(s) of the body affected, and pathogenic influences<sup>6</sup>.</p>
<p>The mulberry tree is cold in nature. All plants are placed on a spectrum from hot to cold, which is an indication of its ability to either increase or reduce body temperature, either systemically or locally. It primarily affects the <em>Lung System</em><sup>7</sup> and the <em>Liver System</em><sup>8</sup>. Most parts are bitter or pungent, flavors associated with clearing and dispersing pathogenic influences, and among these, the mulberry targets wind, dampness and phlegm.</p>
</section>
<section id="the-leaves" class="level2">
<h2 class="anchored" data-anchor-id="the-leaves">The leaves</h2>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><span style="font-size: 1.2em;"><em>sāng yè</em> 桑葉 <em>Mori Folium</em></span> <span class="citation" data-cites="bensky_chinese_2004">(Bensky 2004, 54)</span> <span class="citation" data-cites="chen_chinese_2004">(Chen, Chen, and Crampton 2004, 74)</span></p>
</div>
</div>
</div>
<div style="float: right; width: 40%; margin: 5px;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="mulberry-leaves.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Mulberry leaves"><img src="https://biscotty.online/posts/chinese-medicine/magical-mulberry/mulberry-leaves.jpg" class="img-fluid figure-img" style="border-radius: 5%;" alt="Picture of dried mulberry leaves"></a></p>
<figcaption>Mulberry leaves</figcaption>
</figure>
</div>
</div>
<p>Mulberry leaves are one of the most commonly used herbs to treat certain types of cough: those associated with warm weather colds and flu, and those with a lot of phlegm in the lungs. In CM, the <em>Lung System</em> controls the skin as well as the lungs themselves, and is responsible for temperature regulation. It is our primary defense against all airborne pathogens, including viruses and bacteria. <em>Sāng yè</em> is one of the main ingredients<sup>9</sup> in the classical formula <em>sāng yè tāng</em>, which exemplifies the treatment of colds occurring in warm weather.</p>
<p>Among other things, the <em>Liver System</em> is responsible for vision and the eyes, and the leaves are important in treating red, swollen eyes. Interestingly, in both these applications, <em>sāng yè</em> is most often combined with chrysanthemum flowers<sup>10</sup>. In CM, herbs are (almost) always used in combinations, and certain pairings are recognized as particularly useful. (Herbal combinations<sup>11</sup>, usually pairings, constitute a separate course in the Chinese curriculum, but is sadly missing in the curriculum in the USA.)</p>
</section>
<section id="the-fruit" class="level2">
<h2 class="anchored" data-anchor-id="the-fruit">The fruit</h2>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><span style="font-size: 1.2em;"><em>sāng shèn</em> 桑葚 <em>Mori Fructus</em></span> <span class="citation" data-cites="bensky_chinese_2004">(Bensky 2004, 763)</span> <span class="citation" data-cites="chen_chinese_2004">(Chen, Chen, and Crampton 2004, 959)</span></p>
</div>
</div>
</div>
<div style="float: right; width: 30%; margin-left: 10px;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="mulberries.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Mulberries"><img src="https://biscotty.online/posts/chinese-medicine/magical-mulberry/mulberries.jpg" class="img-fluid figure-img" style="border-radius: 5%;" alt="Picture of mulberries in a bowl"></a></p>
<figcaption>Mulberries<sup>12</sup></figcaption>
</figure>
</div>
</div>
<p>Mulberries are delicious. If you spot them around your neighborhood, pick a few and taste. If you are ambitious, pick a lot and make jam.</p>
<p>While the leaves affect the most superficial parts of the body, the fruit affects some of the deepest levels. Unlike the other parts, the fruit has no affect on the Lungs, but does strongly affect the Liver. While the other parts of the tree are primarily used to treat pathogens, the fruit is nourishing, building the resources the body needs to heal itself. More specifically, it nourishes the blood. The Chinese concept of blood is more expansive than the western definition, and “insufficiency of blood” is often the root not only of anemia but also of insomnia, depression, and other emotional disorders. Physical manifestations include hypotension, dizziness, and tinnitus. The mulberry fruit is currently being used in China for the treatment of diabetes.</p>
</section>
<section id="the-twigs" class="level2">
<h2 class="anchored" data-anchor-id="the-twigs">The twigs</h2>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><span style="font-size: 1.2em;"><em>sāng zhī</em> 桑枝 <em>Mori Ramulus</em></span> <span class="citation" data-cites="bensky_chinese_2004">(Bensky 2004, 355)</span> <span class="citation" data-cites="chen_chinese_2004">(Chen, Chen, and Crampton 2004, 327)</span></p>
</div>
</div>
</div>
<div style="float: right; width: 40%; margin-left: 10px;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="sangzhi.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="sāng zhī 桑枝 Mori Ramulus"><img src="https://biscotty.online/posts/chinese-medicine/magical-mulberry/sangzhi.jpg" class="img-fluid figure-img" style="border-radius: 5%;" alt="Picture of sliced, dried mulberry twigs"></a></p>
<figcaption><em>sāng zhī</em> 桑枝 <em>Mori Ramulus</em></figcaption>
</figure>
</div>
</div>
<p>If the pathogenic forces of wind, dampness and heat make it through the superficial levels of the body, they enter the joints, limbs, and what CM refers to as the “sinews”<sup>13</sup>. This can lead to symptoms such as swelling, pain, numbness, or even paralysis. Where the mulberry leaves focus on the superficial layers, the twig or branch penetrates deeper as well, expelling the pathogenic forces from those areas. This herb is targeted at the Liver.</p>
</section>
<section id="the-root-bark" class="level2">
<h2 class="anchored" data-anchor-id="the-root-bark">The root bark</h2>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><span style="font-size: 1.2em;"><em>sāng bái pí</em> 桑白皮 <em>Mori Cortex</em></span> <span class="citation" data-cites="bensky_chinese_2004">(Bensky 2004, 450)</span> <span class="citation" data-cites="chen_chinese_2004">(Chen, Chen, and Crampton 2004, 741)</span></p>
</div>
</div>
</div>
<div style="float: right; width: 40%; margin-left: 10px;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="sangbaipi.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="sāng bái pí 桑白皮 Mori Cortex"><img src="https://biscotty.online/posts/chinese-medicine/magical-mulberry/sangbaipi.jpg" class="img-fluid figure-img" style="border-radius: 5%;" alt="Picture of sliced, dried mulberry twigs"></a></p>
<figcaption><em>sāng bái pí</em> 桑白皮 <em>Mori Cortex</em></figcaption>
</figure>
</div>
</div>
<p>On the other hand, the root bark is focused on the Lungs, not the Liver. <em>Sāng bái pí</em> is commonly used to treat cough and asthma. Its ability to cool and expel phlegm makes it ideal for cough and asthma characterized by thick, viscous sputum, perhaps yellow.</p>
<p>The root bark is also a diuretic, and is used to treat edema, especially that occurring in the face or limbs. It may seem strange that a medicine which targets the Lung would have anything to do with urinary function. There is a saying that “the Lungs are the upper source of water”. While urination is primarily the responsibility of the kidneys and urinary bladder, the Lungs provide downward movement in the body, and obstruction of the Lungs can result in urinary difficulty and consequent edema.</p>
</section>
<section id="mistletoe" class="level2">
<h2 class="anchored" data-anchor-id="mistletoe">Mistletoe</h2>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><span style="font-size: 1.2em;"><em>sāng jì shēng</em> 桑寄生 <em>Taxilli Herba</em></span><span class="citation" data-cites="bensky_chinese_2004">(Bensky 2004, 335)</span> <span class="citation" data-cites="chen_chinese_2004">(Chen, Chen, and Crampton 2004, 345)</span></p>
</div>
</div>
</div>
<div style="float: right; width: 40%; margin-left: 10px;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="sangjisheng.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Mistletoe on a mulberry tree"><img src="https://biscotty.online/posts/chinese-medicine/magical-mulberry/sangjisheng.jpg" class="img-fluid figure-img" style="border-radius: 5%;" alt="Picture of mistletoe on a mulberry tree"></a></p>
<figcaption>Mistletoe on a mulberry tree</figcaption>
</figure>
</div>
</div>
<p>Mistletoe is, of course, an entirely different plant from the mulberry: it is a parasite which lives on the tree. Never-the-less, its uses are similarly to the uses of the mulberry itself. <em>Sāng jì shēng</em> combines the nourishing characteristics of the mulberry fruit with the pain and numbness relieving abilities of the root bark. It is used to treat more advanced conditions of limb disorders including pain, stiffness, numbness, and atrophy<sup>14</sup>.</p>
<p><em>Sāng jì shēng</em> has another property which will seem odd to westerners. It is said to “calm the fetus”. It is one of about a dozen herbs that are used to treat a range of pregnancy-related issues from morning sickness to bleeding and threatened miscarriage. These herbs are even added to formulas for pregnant women when treating disorders unrelated to the pregnancy. Some, such as the mistletoe, also promote lactation post-partum. Doctors of Chinese Medicine in the USA rarely treat pregnant women due to insurance liability issues, but herbal medicine and acupuncture are very useful in treating many common problems which go along with being pregnant.</p>
</section>
<section id="the-silkworm" class="level2">
<h2 class="anchored" data-anchor-id="the-silkworm">The silkworm</h2>
<div style="float: right; width: 40%; margin-left: 10px;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="silkworm2.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="A healthy, happy silkworm"><img src="https://biscotty.online/posts/chinese-medicine/magical-mulberry/silkworm2.jpg" class="img-fluid figure-img" style="border-radius: 5%;" alt="Picture of a silkworm"></a></p>
<figcaption>A healthy, happy silkworm<sup>15</sup></figcaption>
</figure>
</div>
</div>
<p>Few plants can claim to have had a greater impact on human history than the mulberry. It is not for its medicinal power, rather for the fact that it is the sole host to the silkworm.</p>
<p>Until the Middle Ages, silk was only produced in Asia, mainly in China and India<sup>16</sup>. Chinese silk in particular was much desired throughout the ancient world, from Japan, whose need was insatiable, to the courts of western Europe where it was prized by the aristocracy and wealthy. It was a major factor in the relationship between China and Japan, and provided a foothold for eventual Western naval and trade dominance in the region.</p>
<p>When the Portuguese arrived in Asia, China and Japan were in a state of conflict and had no trading relationship. Never-the-less, the silk trade was very important to both countries. The Portuguese were able to access the famously closed societies by acting as go-betweens, buying silks in China and selling them in Japan<sup>17</sup>.</p>
<p>Of course, many other commodities were traded between Europe and China (and India), spices being of particular import, and the naval routes quickly surpassed in importance the overland Silk Road. The wealth accumulated by Europe as a result of this trade, and their focus on the naval and military technology needed to carry it out, ushered in the long era of western world dominance.</p>
<p>And none of this would have happened if not for the mulberry tree.</p>
<p>Getting back to medicine, it may come as a surprise, but, despite the name, Chinese Herbal Medicine includes more than just herbs. Beyond the plant kingdom, the <em>Materia Medica</em> includes animals and substances derived from them, fungi, and mineral substances.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><span style="font-size: 1.2em;"><em>bái jiāng cán</em> 白僵蠶 <em>Bombyx Batryicatus</em></span> <span class="citation" data-cites="bensky_chinese_2004">(Bensky 2004, 984)</span> <span class="citation" data-cites="chen_chinese_2004">(Chen, Chen, and Crampton 2004, 792)</span></p>
</div>
</div>
</div>
<p>This is an example of a medicinal substance that is both an animal and a fungus. These are silkworms which die after contracting a fungus called “Bombys bassiana*. (In CM terminolgy, this is considered an invasion of wind pathogen.) Similar to what we saw with the mistletoe, despite being an entirely different species, and even a different kingdom, the silkworm also works on the Lungs and Liver, where it treats relatively severed conditions of spasms, convulsions, and paralysis. (Usually animal substances have stronger effects compared to plants.)</p>
<p>As you may recall, the Lungs are responsible for the skin, and while the silkworm does not treat cough, it is commonly used to treat skin itching, rashes, and swelling of the throat, another part of the body belonging to the <em>Lung system</em>. The Lungs also control the voice, and this is used to treat loss of voice.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><span style="font-size: 1.2em;"><em>cán shā</em> 蠶沙 <em>Bombycis Faeces</em></span> <span class="citation" data-cites="bensky_chinese_2004">(Bensky 2004, 334)</span> <span class="citation" data-cites="chen_chinese_2004">(Chen, Chen, and Crampton 2004, 312)</span></p>
</div>
</div>
</div>
<div style="float: right; width: 40%; margin-left: 10px;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="silkworm.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Silkworms with feces"><img src="https://biscotty.online/posts/chinese-medicine/magical-mulberry/silkworm.jpg" class="img-fluid figure-img" style="border-radius: 5%;" alt="Picture of silkworms with feces"></a></p>
<figcaption>Silkworms with feces<sup>18</sup></figcaption>
</figure>
</div>
</div>
<p>Introducing this herb always got a reaction from my students, ranging from nervous giggles to outright disgust, exacerbated when I told them <em>cán shā</em> has a sweet flavor. The Chinese name of this medicinal is quite pleasant, as it translates into English as “silkworm sand”.</p>
<p>In keeping with a major function of the medicinals so far discussed, <em>cán shā</em> expels wind and dampness, thereby treating pain and swelling in the limbs and itchy skin rashes. Unlike the other herbs however, which are cold, <em>cán shā</em> is warm. This is an example of how medicinals are chosen based on a range of criteria. Even though this herb and the root bark go to the same parts of the body and focus on the same pathogens, they are not interchangeable, and inappropriate choice due to misdiagnosis can lead to complications.</p>
<p><em>Cán shā</em> is actually more important clinically to treat dampness in a different part of the body. It affects the abdomen and the digestive system (stomach and pancreas<sup>19</sup>). Symptoms include severe abdominal pain, vomiting, diarrhea and cramps. When used for this, it is always paired with another herb, Chinese flowering quince <em>mù guā</em> 木瓜 <em>Chaenomeles Fructus</em>.</p>
</section>
<section id="closing-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="closing-thoughts">Closing thoughts</h2>
<p>Chinese herbal medicine is a complex and voluminous topic. It has evolved continuously over two thousand years, refining methods and understanding of the properties of thousands of medicinal substances. I hope that I have given you a flavor (no pun intended) of how herbs are used by doctors of oriental medicine, a way very different from that of western herbalists.</p>
<p>Always be cautious when taking any herbal medicine. It is a common misconception that taking “nutritional supplements”, as herbs are considered in the USA, can’t really hurt you, but they can. The person stocking the shelves may not be the best resource for good information, so do your homework.</p>
<p>On the other hand, <em>sāng shēn</em>, those delicious purple berries, can be enjoyed by the handful, and make for a delicious jam. Look around your neighborhood, or in green spaces around you. If you find mulberries, pick some and enjoy.</p>



</section>


<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-bensky_chinese_2004" class="csl-entry">
Bensky, Dan, ed. 2004. <em>Chinese Herbal Medicine: Materia Medica</em>. 3. ed. Seattle, WA: Eastland Press.
</div>
<div id="ref-chen_chinese_2004" class="csl-entry">
Chen, John K., Tina T. Chen, and Laraine Crampton. 2004. <em>Chinese <span>Medical</span> <span>Herbology</span> and <span>Pharmacology</span></em>. City of Industry, Calif: Art of Medicine Press.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Mulberry branch image by <a href="https://pixabay.com/users/tortic84-2633672/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2353908">Ирина Кудрявцева</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2353908">Pixabay</a>↩︎</p></li>
<li id="fn2"><p>dispersing refers to eliminating pathogens↩︎</p></li>
<li id="fn3"><p>Photo by <a href="https://unsplash.com/@kristofer2482?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Christopher Eden</a> on <a href="https://unsplash.com/photos/a-large-tree-in-the-middle-of-a-dirt-road-kEJhPErRvSk?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a>↩︎</p></li>
<li id="fn4"><p>hot, warm, neutral, cool, cold↩︎</p></li>
<li id="fn5"><p>sour, sweet, salty, bitter, pungent↩︎</p></li>
<li id="fn6"><p>heat, cold, damp, phlegm, wind, etc.↩︎</p></li>
<li id="fn7"><p>The Lung System includes much of the immune system. It controls the <em>exterior</em> of the body, and is responsible for resisting external pathogens which result in, eg. colds and flu.↩︎</p></li>
<li id="fn8"><p>The Liver System includes the muscles and joints. It plays an important role in emotional regulation, and poor function can result in irritability, anger, depression and poor sleep.↩︎</p></li>
<li id="fn9"><p>the other being chrysanthemum flowers↩︎</p></li>
<li id="fn10"><p><em>jú huā</em> 菊花 <em>Chrysanthemi flos</em>↩︎</p></li>
<li id="fn11"><p><em>duì yào</em> 對藥↩︎</p></li>
<li id="fn12"><p>Mulberries image by <a href="https://pixabay.com/users/be_stasya-11197808/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4285322">Анастасия Белоусова</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4285322">Pixabay</a>↩︎</p></li>
<li id="fn13"><p>This includes the tendons and ligaments↩︎</p></li>
<li id="fn14"><p>Mistletoe also goes to the Kindeys and is commonly used for lumbar pain↩︎</p></li>
<li id="fn15"><p>Silkworm on hand by <a href="https://pixabay.com/users/ivabalk-782511/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5370812">ivabalk</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5370812">Pixabay</a>↩︎</p></li>
<li id="fn16"><p>India’s traditional Ayurvedic medicine is as old as China’s medical system, and shares a number of features.↩︎</p></li>
<li id="fn17"><p>by means of the Black Ship↩︎</p></li>
<li id="fn18"><p>Silkworms with feces image by <a href="https://pixabay.com/users/alexcla-33625/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=109059">Alexandre Lacerda de Almeida</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=109059">Pixabay</a>↩︎</p></li>
<li id="fn19"><p>This organ is, unfortunately, called the Spleen in Chinese medicine.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>Chinese Medicine</category>
  <category>Herbs</category>
  <category>History</category>
  <guid>https://biscotty.online/posts/chinese-medicine/magical-mulberry/</guid>
  <pubDate>Tue, 20 May 2025 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/chinese-medicine/magical-mulberry/mulberrytree.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Eating in spring</title>
  <link>https://biscotty.online/posts/chinese-medicine/eating-in-spring/</link>
  <description><![CDATA[ 






<p>The <em>Huáng dì nèi jīng</em> (黃帝內經) is the oldest extant Chinese medical text, dated to around the 2<sup>nd</sup> century B.C.E. It lays out the foundational concepts on which all Chinese medicine is based. Before addressing disease, pathology and treatment, it discusses disease <em>prevention</em>: how to stay healthy. In fact, it posits that those who maintain an appropriate diet and activity level, together with rest and relaxation, with moderation in all things, should rarely fall ill, and quickly recover when they do. The elements of this advice are hardly surprising, but the <em>nèi jīng</em> does add, and emphasizes, an element, which may seem strange to Westerners: everything should be done in accordance with the season.</p>
<p>In the clinic, attention to the season is important in diagnosing and treating patients. A fever in summer, for example, is, in nearly all respects, different from an fever in winter, with regard to etiology, pathology, treatment and prognosis. In day-to-day living, it is equally important to pay attention to the season, especially with regard to diet, if one is to maintain optimal health.</p>
<p>It should be recognized that humans today have much less regular exposure to the progression of seasons than in the vast history of our evolution. Air conditioning and cars allow people to avoid being outside almost entirely, thus limiting their exposure to environmental conditions. Those who do not spend time outside, or otherwise expose themselves to seasonal changes, tend to be more subject to seasonal illnesses in my experience.</p>
<p>Spring is upon us, and in this article, I will explain how to maintain an optimal diet for the spring season, foods to seek out and to avoid, and give some spring meal ideas.</p>
<section id="the-qi-of-spring" class="level1">
<h1>The <em>qi</em> of spring</h1>
<p>The <em>nèi jīng</em> describes how to live in accordance with each season. For the spring, it says:</p>
<blockquote class="blockquote">
<p>“…the spring season brings about the revitalization of all things in nature. It is the time of birth. (…) During this season it is advisable to retire early. Arise early also and go walking in order to absorb the fresh, invigorating energy…[O]ne should attempt to correspond to it directly by being open and unsuppressed, both physically and emotionally. (…) [E]xercise more frequently..do stretching exercises to loosen up the tendons and muscles. Emotionally, it is good to develop equanimity. This is because spring is the season of the liver, and indulgence in anger, frustration, depression sadness, or any excess emotion can injure the liver.”<span class="citation" data-cites="Ni_1995">(Ni 1995, 5)</span></p>
</blockquote>
<p>As you see, physiology and psychology are equally important and inseparable in Chinese medicine. Note the association with the <em>Liver System</em>. Each organ system, of which there are five<sup>1</sup>, are associated with a season. Therapeutically, disorder in an organ system is most easily treated in its corresponding season, and this is also the time when it is easiest to strengthen the respective organ system. In spring, foods should be chosen that promote the natural functioning of the <em>Liver System</em>. The exhortation to exercise early is particularly valuable in the case of the <em>Liver System</em>, as movement is highly therapeutic in this system..</p>
</section>
<section id="the-liver-system" class="level1">
<h1>The <em>Liver System</em></h1>
<p>Chinese medicine assigns to the <em>Liver System</em> (from now on I’ll just write <em>Liver</em>) a range of anatomical structures and physiological functions far beyond that of the liver organ. Anatomically, it includes the muscles, tendons and ligaments, psychologically it is an emotional regulator, in both cases ensuring free movement and flexibility. The <em>Liver</em> regulates the menstrual cycle. It is related to the eyes and responsible for vision. And it is associated with spring. In Chinese medicine terminology: “the <em>Liver</em> ensures the free flow of <em>qi</em> and blood”.</p>
<p>Disorders of the <em>Liver</em> manifests emotionally as depression or anger, and physically as migraines, numbness and tingling, spasms, stiffness, dizziness, fainting and poor vision. It is often the root of menstrual disorders such as dysmenorrhea and PMS. It can cause insomnia, depression, and rage, and can leave people feeling “stuck” (an important cause of procrastination). Importantly from a dietary perspective, it often causes indigestion.</p>
<p>The <em>nàn jīng</em> describes many aspects of the <em>Liver</em>, and how it relates to the seasons:</p>
<blockquote class="blockquote">
<p>“During spring, the subtlety and vastness of the universe, the intelligence and intention of the human being, the ability of the earth to produce the ten thousand things, the natural movement of the wind, and the upward motion of all plants, collectively produce the movement of the tendons, the color green, the shouting of the voice, the spasms and convlusions, the eys, the sour taste, and the angry emotions. These are all associated with the liver, since the liver is responsible for mantaining the patency of the flow of energy, and its nature is movement and expansion.”</p>
</blockquote>
<p>It also warns against the dangers particular to the <em>Liver</em>:</p>
<blockquote class="blockquote">
<p>“Anger can injure the liver, but sadness can relieve anger. When wind invades with dampness, it can injure the tendons, although dryness may eliminate the dmapness and wind.<br>
Excessive consumption of sour foods can mke the tendons flaccid, but this can be neutralized by the pungent taste.”</p>
<p><span class="citation" data-cites="Ni_1995">(Ni 1995, 20)</span></p>
</blockquote>
</section>
<section id="feeding-the-liver" class="level1">
<h1>Feeding the <em>Liver</em></h1>
<p>Food therapy is a branch of Chinese medicine, used clinically usually to assist herbal and/or acupuncture treatment. Should you suffer chronically from any of the disorders above, merely changing dietary habits is unlikely to effect a cure, and professional treatment should be sought. The suggestions here are for maintaining physical and emotional health and preventing disorders from arising.</p>
<p>Before expanding on dietary recommendations, I will reiterate that regular physical activity is one of the most valuable treatments for <em>Liver</em> disorders, and should not be neglected.</p>
<section id="properties-of-foods" class="level2">
<h2 class="anchored" data-anchor-id="properties-of-foods">Properties of foods</h2>
<p>Foods are classified in many ways, the most basic being flavor (sweet, sour, bitter, pungent, salty, bland)<sup>2</sup> and nature (cold, cool, neutral, warm, hot). Other properties include direction of action and organ systems most affected. Like herbs, each food has specific functions, and these are taken into account in the clinic. In terms of maintaining health, we need not be so concerned about the details, however.</p>
<p>The <em>nèi jīng</em> gives some guidance on supporting the <em>Liver system</em> in the spring:</p>
<blockquote class="blockquote">
<p>“In the east, wind arises, there is movement that promotes green woody grouwth, and when unripe, gives off a sour taste. The sour taset stimulates the liver when ingested and nourishes the tendons and ligaments. When the wind is gentle it harmonizes all, but when it is extreme it can be destructive, just as in people, emotion turns into rage when the liver is out of control. Metal is the control element, so therefore grief counters anger while dryness lessens the wind and pungent neutralizes sour.” <span class="citation" data-cites="Ni_1995">(Ni 1995, 243)</span></p>
</blockquote>
<p>One of the first pleasures of spring is the arrival of the many herbs that flourish at that time. The rapid, upward growth, pungent flavor, and bright green color are perfect for the <em>Liver System</em>. These can be easily incorporated in salads and soups, or be made into pesto for a light pasta dish.</p>
<p>I should note that Chinese medicine, and Chinese cuisine, strongly frown on raw food<sup>3</sup>. In my clinic, I have certainly seen patients whose health issues were tied to over-consumption of raw food. However, at least in patients without a compromised digestive system, eating raw salads as part of a balanced diet seems not to have a deleterious affect.</p>
<p>Sour foods in moderation are excellent, and so some fruit should be eaten regularly, as most are considered sour. Apricots and cherries are especially useful, but don’t worry too much and buy what is freshest. Herbed vinaigrettes are perfect.</p>
<p>As regards animal protein, shellfish is useful, such as crab, clams, oysters, and eel (<em>unagi</em>).</p>
<p>On the other hand, sweet foods should be minimized (so no lemonade). This includes not only obviously sweet foods, but also starchy foods and root vegetables. Sweet foods can impede the “free flow” of the <em>Liver</em>. This means eating relatively smaller portions of the staple grains such as rice and pasta, and more vegetables. In theory, you have built up and conserved energy stores through the winter…now it’s time to use that energy and get moving.</p>
</section>
<section id="goji-berries" class="level2">
<h2 class="anchored" data-anchor-id="goji-berries">Goji berries</h2>
<p>A specific food related to the <em>Liver</em> that I want to mention is goji berries since they have become common as a “superfood”. This is, in fact, one of the most important herbs used in the clinic to treat <em>Liver System</em> disorders. In Chinese, it is <em>gǒu qǐ zǐ</em> 枸杞子, and it is used to nourish the <em>Liver</em>, more specifically blood and <em>yin</em>. There are numerous folk stories about the regular consumption of <em>gǒu qǐ zǐ</em> leading to unusually long lives. It is tasty, widely available, and a handful can be easily added to morning cereal, cold or cooked, or to salads, or can be mixed with nuts and dried apricots<sup>4</sup> for a snack mix.</p>
</section>
</section>
<section id="basic-approach-to-cooking" class="level1">
<h1>Basic approach to cooking</h1>
<p>Cooking need not be complicated in order to create flavorful and healthy dishes. Cooking should be fun and creative, and every dish you make will teach you something about balance.</p>
<p>In general, a dish should contain a variety of flavors and colors, and should please the eye as well as the palette. Dishes should contain sweet, bitter, salty and sour flavors, all of which have receptors on the tongue, and <em>pungency</em>, which is related to the sense of smell and actually provides most of what we call the taste of a food. Most foods, and in particular the staple grains, have natural sweetness, and many vegetables, especially the greens, are naturally bitter. Adding salt, sour<sup>5</sup>, and sometimes additional sweet<sup>6</sup> elements will bring out the taste of all the other ingredients.</p>
<p>Vegetables should be lightly cooked, and be firm, not mushy. Try to have roughly equal quantities of each ingredient, with a variety of colors. Keep tasting food and adjust the ingredients as desired. Experiment and be creative. Enjoyment of food is not only physical but alse emotional, and the enjoyment itself improves the absorption of the nutrition in the food.</p>
</section>
<section id="recipe-ideas" class="level1">
<h1>Recipe ideas</h1>
<p>Most texts on Chinese food therapy provide recipes, but they tend to focus on foods common in the Chinese diet but unfamiliar or unavailable in parts of the US. With one exception, these recipes are not based in Asian cuisine, and use readily available ingredients.</p>
<p>Here I will give some ideas for some meals which are ideal for spring. They balance the pungent<sup>7</sup> and the sour, while using foods that promote the upward energy<sup>8</sup> appropriate for spring.</p>
<section id="soup-and-salad" class="level2">
<h2 class="anchored" data-anchor-id="soup-and-salad">Soup and Salad</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beetroot and fennel salad with peppermint vinegrette
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Both beets and fennel are specific to the <em>Liver</em>. The fennel used is the vegetable, not the spice. It is a crisp and crunchy bulb with a mild licorice flavor.</p>
<p>Boil a large beet, skin on, until it can be pierced with a fork and the skin slides off easily. After removing the skin, cut into bite-size cubes. Similarly, cut a fennel bulb, a bunch of spring onions, a red or yellow bell pepper, and a few celery stalks into pieces and add to the beets. Add a grated carrot, walnuts or peanuts, dried apricots and goji berries. If you like prunes, they are perfect for the Liver.</p>
<p>Mix vinegar and oil together, roughly half-half, although different vinegars are different, so you’ll need to taste and adjust. I like to use balsamic vinegar, but apple or wine vinegar is fine, too. Add fresh peppermint and a mix of whatever fresh herbs you have available, such as: parsley, cilantro, chives, tarragon, thyme, basil, oregano, etc. It is important that the herbs be fresh, not dried. Crush them with a mortar and pestle before adding, and don’t forget the salt and pepper.</p>
<p>Mix the dressing with the salad right away. Prepare it in advance, as it will taste better the longer it sits. It keeps well in the refrigerator for several days.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Leek soup with white beans and chestnuts
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Leeks, along with their relatives from the onion/garlic family, must be cooked slowly to bring out the natural sweetness and eliminate the bitterness. They should be rinsed thoroughly after chopping because they can be dirty. The entire leek is edible, but avoid the ends if they are too tough.</p>
<p>Gently heat some oil or butter with fennel seeds and a couple bay leaves until you start to smell the fennel, then add the leeks and some salt, stir to thoroughly coat the leeks in oil, adding a small amount if necessary. Keep them on low heat, stirring occasionally, until they are soft, translucent, and sweet to the taste.</p>
<p>Combine the leeks with chestnut or walnut pieces and a couple cups of cooked white beans (canned is fine). These are the large, flat beans, or butter beans. If you don’t have them, any bean will do, or even a couple of cubed potatoes. Add enough vegetable broth to cover, and let it cook for 20 minutes or so. Personally, I don’t have time to make vegetable broth, so I add a couple boullion cubes<sup>9</sup> and boiling water. Do not add cold water or broth, or it will stop the cooking process.</p>
<p>It should be done in 20 minutes or so, and near the end add some fresh herbs like parsley, cilantro, thyme, rosemary…whatever is available and strikes your fancy. Add a splash of balsamic and/or apple vinegar, and additional salt if necessary. Garnish with some chopped chives. Avoid eating this with bread, especially if you used potatoes.</p>
</div>
</div>
</div>
</section>
<section id="mains" class="level2">
<h2 class="anchored" data-anchor-id="mains">Mains</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tarragon pesto pasta
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Take a large bunch of tarragon and remove any woody or tough stems. Place in a food processor or blender with a little salt, olive oil, and a couple handfuls of walnuts. If you eat cheese, add a small piece of parmesan or pecorino romano, if not you could add a tablespoon or so of nutritional yeast if you like. Both of these add considerable <em>umami</em> to the dish. Just remember to start with a little of everything but the tarragon. As you blend, add more olive oil until the pesto looks and tastes moist, being careful not to make it “oily”. You should adjust the seasoning as you go, and add more cheese or nuts if desired.</p>
<p>This is best served with smaller pasta with lots of nooks and crannies for the pesto to get stuck in. Sometimes I’ll add a <em>small</em> squirt of lemon which gives it punch (and a little sour benefits the <em>Liver System</em>).</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stir-fry with tofu, snow peas, peanuts
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The technique here is more stir-steaming than stir-frying. Wok cooking is done at very high heat, with a small amount of liquid in the bottom which must be continually replenished so as to never dry out. The goal is to steam the vegetables, not boil them. Liquid should be added from the side of the wok, and there should always be visible steam. Vegetable broth is fine, although I like to use a mix of mirin or rice cooking wine, mushroom sauce, and fish sauce.</p>
<p>For best results, cut a firm block of tofu into bite-size pieces, place on a tray with pieces not touching, and freeze for at least four hours. For vegetables, I suggest snow peas, carrots, and red bell pepper. These should all be cut into bite size pieces.</p>
<p>Grate an inch or so of fresh ginger and fry in a little oil at medium heat until it softens and smells good. Add the tofu, some liquid, and some soy sauce. The best is Thai mushroom sauce, but any light soy sauce is ok. Add some fresh mushrooms, ideally shiitake.</p>
<p>When the tofu is softened, add a little oyster sauce, mix, and move the tofu to the side of the wok or remove it to a bowl. Make sure there is liquid in the bottom of the hot wok, and one by one cook the carrots, snow peas, and bell pepper for about one minute each, moving them to the side of the wok after they are slightly cooked.</p>
<p>Mix all the ingredients together, add additional soy sauce or oyster sauce as needed, and cook for another minute. Turn off the heat, and mix in some unsalted peanuts and chopped scallions. This is best served with Thai jasmine rice, but any will do. Remember to keep the rice portion small in the spring. I like spicy foods, so I add some Sriracha.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lime-cilantro shrimp
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Chop some onions and garlic and cook them on low-medium heat with salt in some olive oil until they start to brown. Raise the heat a little and add a chopped tomato. Let the water cook off the tomato, then add a chopped carrot, celery stalk and red bell pepper. Add water as necessary to keep everything moist but not soupy. Once the vegetables are softened but still firm, add the shrimp. As soon as they start to curl and change color, remove from the heat as they will continue to cook and will become tough if overcooked.</p>
<p>Stir in a generous amount of lime juice from fresh limes. Taste and juiciness of limes varies widely, but I find the small limes have the best flavor. Add a bunch of chopped cilantro and green onions. Serve with tortillas or rice.</p>
</div>
</div>
</div>



</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-Lu_1994" class="csl-entry">
Lu, Henry C. 1994. <em>Chinese Natural Cures</em>. Black Dog &amp; Leventhal Publishers, Inc.
</div>
<div id="ref-Ni_1995" class="csl-entry">
Ni, Maoshing. 1995. <em>The Yellow Emperor’s Classic of Medicine: A New Translation of the Neijing Suwen with Commentary</em>. Shambhala.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Liver, Kidney, Spleen, Lung, Heart↩︎</p></li>
<li id="fn2"><p>“In general, foods that are pungent have dispersing qualities, those that are sour have astringent qualities, sweet foods have harmonizing and decelerating qualities, bitter foods have a dispensing and drying effect, and salty foods have a softening effect.” <span class="citation" data-cites="Ni_1995">(Ni 1995, 94)</span>↩︎</p></li>
<li id="fn3"><p>China was the first place I ever ate cooked lettuce↩︎</p></li>
<li id="fn4"><p>Apricots are specific to the Liver↩︎</p></li>
<li id="fn5"><p>vinegar, citrus↩︎</p></li>
<li id="fn6"><p>honey, palm sugar, maple syrup, cane sugar↩︎</p></li>
<li id="fn7"><p>Includes green onions, chives, parsley, coriander, but includes most every herb which thrives in the spring and all the onion family.<span class="citation" data-cites="Lu_1994">(Lu 1994)</span>↩︎</p></li>
<li id="fn8"><p>Such foods include apricots, beets, mushrooms, cabbage, carrot, celery, eggs, grapes, honey, kidney beans, milk, olives, peanuts, oysters, string beans, sweet potatoes, kohlrabi, figs.<span class="citation" data-cites="Lu_1994">(Lu 1994)</span>↩︎</p></li>
<li id="fn9"><p>There are many high quality boullion cubes on the market these days, with many vegetarian and vegan choices. Experiment and find ones that you like.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>Chinese Medicine</category>
  <category>Food</category>
  <guid>https://biscotty.online/posts/chinese-medicine/eating-in-spring/</guid>
  <pubDate>Thu, 15 May 2025 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/chinese-medicine/eating-in-spring/goji.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>The FHS Problem</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/linux/nix-docker-fhs/</link>
  <description><![CDATA[ 






<hr>
<p>I have been using NixOS for a year and a half. It is conceptually different from other Linuxes, and is notoriously difficult to explain. Unfortunately, the strange concepts and ugly configuration language mask an underlying simplicity which I think is superior to the traditional approach. I will try, in this article, to explain a few of these concepts, and how they relate to a development problem caused by the fundamental design of traditional Linux.</p>
<section id="the-problem-with-the-fhs" class="level1">
<h1>The problem with the FHS</h1>
<p>The <em>Filesystem Hierarchy Standard</em> seems to be a basic part of Linux. Indeed, it is one of the first things everyone learns about when starting to use Linux, though they are usually unaware that it is the FHS. The FHS simply defines where different types of files should be located: executable files in /<code>bin</code> or <code>/usr/bin</code>, libraries in <code>/lib</code>, configurations in <code>/etc</code>, and so on. Most people assume this to be a fundamental aspect of Linux, but it is not.</p>
<p>On a Linux system, everything is a file, and files can be located anywhere, in any directory. As long as you know where your executables are, and they know where their libraries are, everything can be in one directory, or split across multiple paths. Linux doesn’t care.</p>
<p>On the other hand, in an ecosystem in which code is widely shared among projects, the arbitrary placement of various components made life difficult, so, early on in the life of Linux, a group of people proposed a standard (firstly the FSSTND, followed by FHS) which defined locations for the various types of files, a proposal which was quickly adopted by just about everybody.</p>
<p>The problem with this approach is its hierarchical tree structure. It would appear an obvious way to organize files, but it is by nature limiting. in modern programming, multiple versions of programming languages and libraries are necessary, not all of which are compatible. With only one <code>/lib</code> directory, only one <code>/usr/bin</code> directory, etc. how do you manage multiple versions of all the packages? A program might be dependent on a specific version of Python, while another program might require another. In development, this is particularly problematic, as version bumps can break programs, so version consistency is crucial. But on any given Linux system, ensuring such consistency is effectively impossible.</p>
<p>There is an entirely different approach, an organizational structure unfamiliar to many: a graph.</p>
</section>
<section id="the-docker-solution-containers" class="level1">
<h1>The Docker solution: Containers</h1>
<p>The most common solution to this problem is Docker containers. A variation on virtual machines, containers contain full Linux installations which are isolated from the system on which they run, with their own root file structure and all libraries. In order to be used, these containers need to be loaded as processes managed by another process.</p>
<p>This is a simple idea but a complex solution: just have multiple Linuxes all happily doing their own thing on the same piece of hardware. However, while this does solve the initial problem, and has become nearly a <em>de facto</em> standard in software development, this approach has definite drawbacks: it is not reproducible, there is no guarantee of library versions, most of the container’s contents are unneeded bloat, and it requires a separate mechanism to be run and maintained.</p>
</section>
<section id="the-nix-solution-graphs" class="level1">
<h1>The Nix solution: Graphs</h1>
<p>Instead of working around the FHS, Nix chose to abandon it. The FHS, and Docker, are layered, imperative approaches to system structural organization. A Dockerfile is a series of commands which result in the container environment, just as a typical computer system is installed through a series of commands, layering one package on another, highly dependent on file paths. This isn’t the only way, however.</p>
<p>Nix is not imperative, nor is it layered. It is declarative, and uses graphs to install software. On a Nix system, the desired environment is described in a configuration file (actually itself a functional program). When an application is installed, all necessary files are placed in a common directory, and a graph is used to connect all of the relevant bits. Every file in this directory has a name which includes a hash of the program or library itself, uniquely identifying each package/version.</p>
<p>People are comfortable with hierarchical structures. The are used in many areas of life, and can be easily visualized as an upside-down tree. Graphs, on the other hand, are not familiar. A graph consists of objects and lines connecting them. Visually, graphs can appear chaotic, given the arbitrary locations of the objects. However, when using visualization tools which draw together linked objects (force-directed graphs), structure emerges.</p>
<p>Furthermore, with the Nix approach, environments are fully reproducible, unlike with Docker and it is efficient, as only required libraries are installed, not entire OSs, and a seperate sub-system need not be running to manage anything.</p>
<p>In practice, using Nix makes life simpler, and development more secure and consistent. Since environments are declared, they are easily shared, and all versions of each file are locked in a file which is also shared. In order to enter any project environment, <em>all you need do is enter the directory</em>, and all tools and libraries declared are just there, without the need to start a separate process and enter the container. To top it all off, should you need an OCI container for use with Kubernetes or, if absolutely necessary, Docker itself, creating one from a Nix definition is trivial.</p>
</section>
<section id="reflection" class="level1">
<h1>Reflection</h1>
<p>From a technical perspective, it seems clear that the Nix approach is simpler and more efficient than the container approach. On the other hand, it relies on concepts which are unfamiliar to most programmers and system administration. Graphs, and especially functional programming, are not widely understood. People like to stay in their comfort zone, and programmers are surprisingly resistant to learning new things. The controversy around Rust and the Linux kernel is a good example of this. Rust can make the kernel safer, and has already created far superior replacements for much of GNU, but many C programmers find Rust daunting.</p>
<p>Docker itself has become a sprawling enterprise with a large variety of offerings, and an economy which has developed around it. Never-the-less, I think that the future of Linux, both as a development platform and an operating system, lies in Nix.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Linux</category>
  <category>Distributions</category>
  <category>Nix</category>
  <guid>https://biscotty.online/posts/linux/nix-docker-fhs/</guid>
  <pubDate>Sun, 04 May 2025 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/linux/nix-docker-fhs/NixosWinter.png" medium="image" type="image/png" height="108" width="144"/>
</item>
<item>
  <title>GPS Mapping with R</title>
  <link>https://biscotty.online/posts/data-science/r-gpx-mapping/trail-mapping-with-r/</link>
  <description><![CDATA[ 






<p>I recently published a series of articles on analyzing GPS data from personal sport tracking software using Python. I’ve started using R again lately and, while I like Python, I really like R. R is not a general-purpose language like Python, and is therefore far less commonly studied. It was mission-built for this type of work, and, as is often the case with custom-built tools, it is powerful, comfortable, and, frankly, fun to work with. I thought it might be interesting to compare the process in Python described in the <a href="../../../../posts/data-science/python-gpx-mapping/gpx-gps-data/index.html">previous articles</a> with the process in R.</p>
<section id="libraries" class="level2">
<h2 class="anchored" data-anchor-id="libraries">Libraries</h2>
<p>Python data frames are built on the <code>pandas</code> and <code>numpy</code> libraries, with <code>matplotlib</code> as the primary plotting tool. Data frames and vector processing are native to R. The <code>dplyr</code> library provides convenience functions for manipulating data. The amazing <code>gplot2</code> provides the functionality of <code>matplotlib</code> and <code>seaborn</code> and more, with simple syntax. The <code>sf</code> package, which stands for <em>Simple Features</em>, provides the geometry and geospatial functionality which <code>geopandas</code> and <code>shapely</code> do in Python. I’ll use <code>ggspatial</code> here for basemap tiles where I used <code>contextily</code> in Python, and I’ll add <code>patchwork</code> for convenient side-by-side display.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gpx)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggspatial)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)</span></code></pre></div>
</div>
</section>
<section id="syntax" class="level2">
<h2 class="anchored" data-anchor-id="syntax">Syntax</h2>
<p>A few notes about syntax to start off: R uses the <code>&lt;-</code> arrow for assignment, but accepts <code>=</code> as well. Data frame slicing uses the same <code>[row,column]</code> approach with explicit or boolean values. Unlike <code>pandas</code>, which distinguishes between <code>df.loc</code> and <code>df.iloc</code>, in R you can slice using numeric indices or strings without distinction. On a similar topic, R uses one-indexing, but is inclusive of the end, so <code>df[1:2]</code> in R is equivalent to Python’s <code>df.iloc[:2]</code>, or more explicitly <code>df.iloc[0:2]</code>, and the second element is directly accessed with <code>df[2]</code> instead of <code>df.iloc[1]</code>.</p>
<p>There’s an important twist to this which will catch you multiple times. Even though the syntax is <code>[row,column]</code>, if you supply only one numeric index, without a comma, it will be interpreted as a column index. So <code>df[1]</code> gets the first column, while <code>df[1, ]</code> gets the first row.</p>
<p>The main syntactical difference is R’s extensive use of piping, using the pipe operator <code>|&gt;</code>, sometimes written as <code>%&gt;%</code>. This looks similar to accessing a series of an object’s methods through a chain of <code>.</code>s in Python, but it isn’t. The pipe in R works like the pipe in a Linux shell, simply passing the output of one function to the next function as its first argument. This is one of my personal favorite aspects of working in R, since it allows for natural expression of a series of steps which constitue a workflow. <code>ggplot2</code> takes a similar <em>syntactical</em> approach, layering elements of the plot by chaining using the <code>+</code> operator.</p>
</section>
<section id="loading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-data">Loading the data</h2>
<p>Let’s get started. With Python, we needed to parse the raw <code>gpx</code> data, which is in an XML format, to a CSV formatted file, which could then be imported into a <code>pandas</code> data frame, and then turned that into a <code>geopandas</code> data frame. I used <code>beautifulsoup</code> to do so. R, fortunately, has a <code>gpx</code> library that allows us to go straight from <code>gpx</code> into a data frame. Let’s see what that looks like. The <code>str()</code> command will let us know what’s inside.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">trek_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_gpx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/b3/Workout-2024-09-06-16-29-37.gpx"</span>)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(trek_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ routes   :List of 1
  ..$ :'data.frame':    0 obs. of  4 variables:
  .. ..$ Elevation: logi(0) 
  .. ..$ Time     : logi(0) 
  .. ..$ Latitude : logi(0) 
  .. ..$ Longitude: logi(0) 
 $ tracks   :List of 1
  ..$ River Vale:'data.frame':  137 obs. of  6 variables:
  .. ..$ Elevation : num [1:137] -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 ...
  .. ..$ Time      : POSIXct[1:137], format: "2024-09-06 16:29:37" "2024-09-06 16:29:37" ...
  .. ..$ Latitude  : num [1:137] 41 41 41 41 41 ...
  .. ..$ Longitude : num [1:137] -74 -74 -74 -74 -74 ...
  .. ..$ extensions: logi [1:137] NA NA NA NA NA NA ...
  .. ..$ Segment ID: int [1:137] 1 1 1 1 1 1 1 1 1 1 ...
 $ waypoints:List of 1
  ..$ :'data.frame':    0 obs. of  4 variables:
  .. ..$ Elevation: logi(0) 
  .. ..$ Time     : logi(0) 
  .. ..$ Latitude : logi(0) 
  .. ..$ Longitude: logi(0) </code></pre>
</div>
</div>
<p>The result is not a data frame, but a list of lists. The second one, called tracks, is the only one with observations, so we can start with that. Don’t forget that R does not zero-index lists, so we use <code>2</code> not <code>1</code>, and extract it with double square brackets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">trek_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> trek_data[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(trek_tracks)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ River Vale:'data.frame': 137 obs. of  6 variables:
  ..$ Elevation : num [1:137] -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 ...
  ..$ Time      : POSIXct[1:137], format: "2024-09-06 16:29:37" "2024-09-06 16:29:37" ...
  ..$ Latitude  : num [1:137] 41 41 41 41 41 ...
  ..$ Longitude : num [1:137] -74 -74 -74 -74 -74 ...
  ..$ extensions: logi [1:137] NA NA NA NA NA NA ...
  ..$ Segment ID: int [1:137] 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<p>This gets us closer, now we have list of one. Let’s pull that out and display the first two rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">trek <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> trek_tracks[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb6-2">trek[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Elevation                Time Latitude Longitude extensions Segment ID
1        -4 2024-09-06 16:29:37 41.01128  -74.0101         NA          1
2        -4 2024-09-06 16:29:37 41.01128  -74.0101         NA          1</code></pre>
</div>
</div>
<p>Note the comma, which is very important. If only one value is supplied, it chooses columns instead of rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(trek[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Elevation                Time
1        -4 2024-09-06 16:29:37
2        -4 2024-09-06 16:29:37</code></pre>
</div>
</div>
<p>And the final frame looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(trek)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   137 obs. of  6 variables:
 $ Elevation : num  -4 -4 -4 -4 -4 -4 -4 -4 -4 -4 ...
 $ Time      : POSIXct, format: "2024-09-06 16:29:37" "2024-09-06 16:29:37" ...
 $ Latitude  : num  41 41 41 41 41 ...
 $ Longitude : num  -74 -74 -74 -74 -74 ...
 $ extensions: logi  NA NA NA NA NA NA ...
 $ Segment ID: int  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
</section>
<section id="importing-a-collection-of-treks" class="level2">
<h2 class="anchored" data-anchor-id="importing-a-collection-of-treks">Importing a collection of treks</h2>
<p>Now that I know “where” the information is, I can go ahead and import a series of files and combine them into a single data frame. As I did with Python, I will assign a unique identifier to each trek, and then combine them. The R equivalent of <code>df.append</code> in <code>pandas</code> is the aptly-named <code>bind_rows()</code> from the <code>dplyr</code> library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">files <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list.files</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">path =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/b3/"</span>, </span>
<span id="cb12-2">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.gpx$"</span>,</span>
<span id="cb12-3">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">full.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb12-4">data_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb12-5">i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (file <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> files) {</span>
<span id="cb12-7">  data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_gpx</span>(file)[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]][[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb12-8">  data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> i</span>
<span id="cb12-9">  i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-10">  data_list[[file]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data</span>
<span id="cb12-11">}</span>
<span id="cb12-12">tracks_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(data_list)</span>
<span id="cb12-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(tracks_df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   3044 obs. of  7 variables:
 $ Elevation : num  79 79 77 76 75 74 72 71 70 70 ...
 $ Time      : POSIXct, format: "2024-09-05 15:25:13" "2024-09-05 15:25:13" ...
 $ Latitude  : num  41 41 41 41 41 ...
 $ Longitude : num  -74.1 -74.1 -74.1 -74.1 -74.1 ...
 $ extensions: logi  NA NA NA NA NA NA ...
 $ Segment ID: int  1 1 1 1 1 1 1 1 1 1 ...
 $ id        : num  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<p>Note the use of <code>$</code> to access the columns. An alternate syntax, <code>data['id']</code> is available for column names with spaces. This is like <code>pandas</code> use of the <code>.</code> operator.</p>
</section>
<section id="data-frame-to-geo-data" class="level2">
<h2 class="anchored" data-anchor-id="data-frame-to-geo-data">Data frame to geo-data</h2>
<p>In Python, we turned this into a geo-enabled data frame with:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{python}</span></span>
<span id="cb14-2">trek_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gpd.GeoDataFrame( </span>
<span id="cb14-3">    trek_df, </span>
<span id="cb14-4">    geometry<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gpd.points_from_xy(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trek_df.Lon, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trek_df.Lat)</span>
<span id="cb14-5">).set_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>)</span>
<span id="cb14-6">trek_gdf.info()</span>
<span id="cb14-7"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<p>R uses the <code>sf::st_as_sf()</code> for this purpose, with much less verbose syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">treks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tracks_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Longitude"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Latitude"</span>),</span>
<span id="cb15-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(treks)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'sf' and 'data.frame':  3044 obs. of  6 variables:
 $ Elevation : num  79 79 77 76 75 74 72 71 70 70 ...
 $ Time      : POSIXct, format: "2024-09-05 15:25:13" "2024-09-05 15:25:13" ...
 $ extensions: logi  NA NA NA NA NA NA ...
 $ Segment ID: int  1 1 1 1 1 1 1 1 1 1 ...
 $ id        : num  1 1 1 1 1 1 1 1 1 1 ...
 $ geometry  :sfc_POINT of length 3044; first list element:  'XY' num  -74.1 41
 - attr(*, "sf_column")= chr "geometry"
 - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA
  ..- attr(*, "names")= chr [1:5] "Elevation" "Time" "extensions" "Segment ID" ...</code></pre>
</div>
</div>
<p>As you can see, we now have a <code>geometry</code> column and the <code>Time</code> column was assigned the appropriate type, which we had to do as an additional step in Python. I’ll grab the first trek, then plot it with <code>ggplot</code>. Using <code>ggplot</code> entails adding elements one by one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">trek <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> treks[treks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> trek) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-2">  ggspatial<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotation_map_tile</span>(      </span>
<span id="cb19-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"osm"</span>,</span>
<span id="cb19-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cachedir =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maps/"</span>,</span>
<span id="cb19-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zoomin =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Elevation)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_viridis_c</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb19-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Elevation Profile: Park Ridge"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(trek[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Time)),</span>
<span id="cb19-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiles © OpenStreetMap (ODBL license)"</span></span>
<span id="cb19-12">  )</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://biscotty.online/posts/data-science/r-gpx-mapping/trail-mapping-with-r/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this case, we pass the data frame (actually an <code>sf</code> object) to <code>ggplot</code>, then layer on the basemap and the actual points using <code>geom_sf</code>, passing it the column we want to color using the <code>aes()</code> funtion. “aes” is short for aesthetics, and it is where you specify columns to be used for that element. The details of this vary depending on the geometry. <code>theme_void()</code> removes axis ticks, and the rest should be self-explanatory.</p>
<p>We still must change the coordinate system to get appropriate distances. In R, this is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">trek_proj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> trek <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32113</span>)</span></code></pre></div>
</div>
<p>In Python, we did</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{python}</span></span>
<span id="cb21-2">trek_proj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> trek_gdf.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32111</span>)</span>
<span id="cb21-3"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<p>While the syntax looks similar, Python is accessing a method of the <code>trek</code> object, while R is simply passing the output of one function to another.</p>
</section>
<section id="elevations" class="level2">
<h2 class="anchored" data-anchor-id="elevations">Elevations</h2>
<p>I won’t move beyond points until the next article, but in the first Python one I did calculate the distance, so to be fair I will do so here. I’ll explain the code later, but it is a good example of piping in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">distance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> trek <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32113</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">do_union =</span> F) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_cast</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LINESTRING"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_length</span>()</span>
<span id="cb22-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total distance"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(distance<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kilometers"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Total distance 7.7 kilometers"</code></pre>
</div>
</div>
<p>Let’s see the other basic information. I will put it in a data frame for a nice printout.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb24-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Elevation"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Maximum"</span>,</span>
<span id="cb24-3">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Minimum"</span>,</span>
<span id="cb24-4">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Average"</span>,</span>
<span id="cb24-5">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Initial"</span>,</span>
<span id="cb24-6">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Final"</span>),</span>
<span id="cb24-7">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Meters"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(trek<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Elevation),</span>
<span id="cb24-8">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(trek<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Elevation),</span>
<span id="cb24-9">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(trek<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Elevation)),</span>
<span id="cb24-10">               trek[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Elevation,</span>
<span id="cb24-11">               trek[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(trek),]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Elevation)</span>
<span id="cb24-12">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Elevation Meters
1   Maximum     81
2   Minimum     11
3   Average     45
4   Initial     79
5     Final     74</code></pre>
</div>
</div>
<p>The <code>c()</code> function is used to create a vector (not a list), so I specify each column name and assign it a vector with data, ensuring that each vector has the same length, of course. Note how I access the last row of <code>trek</code>. There are multiple ways of doing this in R, but sadly negative indexing is not one. This is the most efficient. I will say that I miss Python’s f-string, especially with literals (<code>f""" """</code>).</p>
<p>Now we can use <code>ggplot</code> for a line chart of the elevation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(trek, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Elevation)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Elevation Profile for Park Ridge Walk on"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(trek[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Time)))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://biscotty.online/posts/data-science/r-gpx-mapping/trail-mapping-with-r/index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And here are the smoothed profiles using two different methods, and display them side by side with the <code>patchwork</code> library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)</span>
<span id="cb27-2">gam_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(trek, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Elevation)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gam"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NJ (gam smoothing)"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(trek[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Time)))</span>
<span id="cb27-6"></span>
<span id="cb27-7">loess_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(trek, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Elevation)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NJ (loess smoothing)"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(trek[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Time)))</span>
<span id="cb27-11"></span>
<span id="cb27-12">gam_plot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> loess_plot</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://biscotty.online/posts/data-science/r-gpx-mapping/trail-mapping-with-r/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>ggplot2</code>’s approach of adding layers makes code clear and easy to write, and does not have the odd <code>fig, ax</code> mechanism which can be confusing.</p>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>I hope you enjoyed this exercise, no pun intended. The code for this is on my websites <a href="https://github/biscotty666/biscottys-workshop">GitHub repository</a>. I’ll come out with part 2 soon. Happy coding!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>GIS</category>
  <category>R</category>
  <category>Python</category>
  <category>Data Science</category>
  <guid>https://biscotty.online/posts/data-science/r-gpx-mapping/trail-mapping-with-r/</guid>
  <pubDate>Sun, 30 Mar 2025 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Speed, Simplification and Segments</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/</link>
  <description><![CDATA[ 






<section id="simplification-speed-and-segments" class="level1">
<h1>Simplification, speed and segments</h1>
<section id="the-trek-so-far" class="level2">
<h2 class="anchored" data-anchor-id="the-trek-so-far">The trek so far</h2>
<p>In the first article, we took raw data from a trekking application, a GPX file in the form of standardized XML, parsed it to CSV, which we imported into a DataFrame with Pandas. Each record contains latitude, longitude, elevation and a time stamp. Using GeoPandas, we turned the latitude and longitude fields into POINT geometries and assigned an appropriate Coordinate Reference System so that we can work with the data geospatially. In the second article, we used MovingPandas to convert those POINTs into LINESTRINGs, allowing for calculations of distances not only along the route but to other locations or routes. We also learned how to auto-detect places along the trajectory where we paused.</p>
<p>In this article I will show how to incorporate the time dimension and calculate speed, duration, and other statistics, and how to split the path into segments. We already did this implicitly last time when we did stop detection, since a pause is based on time, and those pauses are natural points to split the route, and, not surprisingly, this is quite simple to do in MovingPandas. But first, we should look at simplification of the data.</p>
</section>
<section id="simplification" class="level2">
<h2 class="anchored" data-anchor-id="simplification">Simplification</h2>
<p>The raw data contains a level of granularity that is not necessarily needed, and can have a significant computational cost. The data can be simplified in different ways such as combining short time periods into longer ones, or smoothing by combining multiple paths within a certain area into a single, straight path. In this article, I’ll look at generalizing, down-sampling the time.</p>
<p>GPS trackers take frequent readings, seconds apart. Let’s look at the average time between readings in one of our treks. I’ll start by importing a GeoDataFrame with walks and bike rides in New Mexico, using the method described in the prior articles.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data/b4/combined.csv'</span>)</span>
<span id="cb1-2">gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gpd.GeoDataFrame(</span>
<span id="cb1-3">    df, </span>
<span id="cb1-4">    geometry<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gpd.points_from_xy(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.Lon, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.Lat), </span>
<span id="cb1-5">    crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span></span>
<span id="cb1-6">).to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32111</span>)</span>
<span id="cb1-7">idList <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(gdf.groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Id'</span>]).nunique().reset_index().Id)</span>
<span id="cb1-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, track <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(idList):</span>
<span id="cb1-9">    gdf.loc[gdf.Id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> track, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trajectory_id'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i</span>
<span id="cb1-10">gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(gdf.Time)</span>
<span id="cb1-11">tc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mpd.TrajectoryCollection(</span>
<span id="cb1-12">    gdf, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trajectory_id'</span>, </span>
<span id="cb1-13">    t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time'</span>, x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lon'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lat'</span></span>
<span id="cb1-14">)</span>
<span id="cb1-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(tc)</span></code></pre></div>
<pre><code>TrajectoryCollection with 130 trajectories</code></pre>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tc.plot(</span>
<span id="cb3-2">    column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trajectory_id'</span>,</span>
<span id="cb3-3">    figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb3-4">    cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'inferno'</span>, </span>
<span id="cb3-5">    legend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb3-6">)</span>
<span id="cb3-7">ax.set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Walks and Rides in NM'</span>)</span>
<span id="cb3-8">ax.set_axis_off()</span>
<span id="cb3-9">ctx.add_basemap(ax, crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gdf.crs,</span>
<span id="cb3-10">                source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ctx.providers.Esri.NatGeoWorldMap)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/tda3_1.png" class="img-fluid"></p>
<p>Here are the total number of records, and the average time between readings:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> print_intervals_size(tc):</span>
<span id="cb4-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'''</span></span>
<span id="cb4-3"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Avg sampling interval: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>((np.mean(</span>
<span id="cb4-4">        [t.get_sampling_interval().seconds <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> tc.trajectories]</span>
<span id="cb4-5">     )), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> seconds</span></span>
<span id="cb4-6"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Total records: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>([t.size() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> tc.trajectories])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-7"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">     '''</span>)</span>
<span id="cb4-8">print_intervals_size(tc)</span></code></pre></div>
<pre><code>Avg sampling interval: 5.92 seconds
Total records: 84319</code></pre>
<p>That’s way more than I need. A reading every 30 seconds is more than enough. I can use the <code>generalize()</code> function from MovingPandas to easily do so using the <code>tolerance</code> parameter:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">tc_generalized <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb6-2">    mpd.MinTimeDeltaGeneralizer(tc)</span>
<span id="cb6-3">        .generalize(tolerance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>timedelta(seconds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>))</span>
<span id="cb6-4">)</span>
<span id="cb6-5">print_intervals_size(tc_generalized)</span></code></pre></div>
<pre><code>Avg sampling interval: 33.28 seconds
Total records: 17258</code></pre>
<p>I’ll extract a single trajectory from before and after so we can see what happens with simplification. First I’ll print some basic information about the trek. Moving pandas provides functions such as <code>get_duration</code> and <code>get_length</code> to obtain information. I’ll include the print code here to demonstrate how to access the values and what functions are available. To access columns in the underlying DataFrame, you can use <code>tc.df.SomeColumn</code>. Python’s f-strings make it easy to generate these reports. ```python def trek_info(traj): print(f’’’ Date: {traj.get_start_time().strftime(‘%x’)} Activity: {‘Bike Ride’ if traj.df.Sport[0] == 1 else ‘Walk’} Duration: {traj.get_duration().seconds/60:.0f} minutes Distance: {traj.get_length(units=‘mi’):.1f} miles Avg Speed: {((traj.get_length(units=‘mi’)) /<br>
(traj.get_duration().seconds/60**2)):.1f} mph Avg Temp: {(traj.df.Temp.mean()*9/5)+32:.0f} degrees F CRS: {traj.get_crs().to_epsg()} Points: {traj.size()} Bounds: ({“,”.join( map(str, [round(traj.to_crs(4269).get_bbox()[x], 3) for x in range(4)]))})</p>
<pre><code>    Max Elevation: {traj.get_max(column='Elev'):,} meters
    Min Elevation: {traj.get_min(column='Elev'):,} meters
    Avg Elevation: {traj.df.Elev.mean():,.0f} meters
    
            Time         Location (Lon/Lat)
    Start: {
      traj.get_start_time().strftime('%X')
      }  {
      tuple([round(x,3) for x in 
      traj.to_crs(4269).get_start_location().coords[0]])
      } degrees
    End:   {
      traj.get_end_time().strftime('%X')
      }  {
      tuple([round(x,3) for x in
      traj.to_crs(4269).get_end_location().coords[0]])
      } degrees
''')</code></pre>
<pre><code>```python
traj_bike = tc.trajectories[52]
traj_bike_gen = tc_generalized.trajectories[52]
trek_info(traj_bike)</code></pre>
<pre><code>         Date:      05/30/24
        Activity:  Bike Ride
        Duration:  63 minutes
        Distance:  13.4 miles
        Avg Speed: 12.8 mph
        Avg Temp:  76 degrees F
        CRS:       32111
        Points:    681
        Bounds:    (-106.714, 35.144, -106.648, 35.183)

        Max Elevation: 1,564 meters
        Min Elevation: 1,504 meters
        Avg Elevation: 1,528 meters
        
                Time         Location (Lon/Lat)
        Start: 18:41:12  (-106.708, 35.147) degrees
        End:   19:44:04  (-106.708, 35.148) degrees</code></pre>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">trek_info(traj_bike_gen)</span></code></pre></div>
<pre><code># Difference from `traj_bike`
        Points:    105</code></pre>
<p>Here is a before and after plot:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> itertools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> chain</span>
<span id="cb13-2">f, (ax1, ax2) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb13-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, traj <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>([traj_bike, traj_bike_gen]):</span>
<span id="cb13-4">    traj.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax1[i])</span>
<span id="cb13-5">    ctx.add_basemap(ax1[i], crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>traj.crs, </span>
<span id="cb13-6">                    source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ctx.providers.CartoDB.Voyager)</span>
<span id="cb13-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, traj <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>([traj_bike, traj_bike_gen]):</span>
<span id="cb13-8">    traj.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax2[i])</span>
<span id="cb13-9">    ctx.add_basemap(ax2[i], crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>traj.crs, </span>
<span id="cb13-10">                    source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ctx.providers.CartoDB.Voyager)</span>
<span id="cb13-11">    ax2[i].set_xlim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">460000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">462000</span>)</span>
<span id="cb13-12">    ax2[i].set_ylim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">462000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">464000</span>)</span>
<span id="cb13-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> axs <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> chain(ax1, ax2): </span>
<span id="cb13-14">    axs.set_axis_off() </span>
<span id="cb13-15">ax1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Raw'</span>)</span>
<span id="cb13-16">ax1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Generalized'</span>)</span>
<span id="cb13-17">f.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Effect of Generalization to 30 Seconds'</span>)</span>
<span id="cb13-18">f.tight_layout()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/tda3_2.png" class="img-fluid"></p>
</section>
<section id="speed-and-sundry" class="level2">
<h2 class="anchored" data-anchor-id="speed-and-sundry">Speed and sundry</h2>
<p>Before moving to speed calculations, let’s make a quick plot:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">t_plot(traj_bike_gen, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'speed'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/tda3_3.png" class="img-fluid"></p>
<p>I just plotted the speed column, but a quick check will show there is no speed column.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">traj_bike_gen.df.columns</span></code></pre></div>
<pre><code>Index(['Id', 'Name', 'Lat', 'Lon', 'Elev', 'Temp', 'Weather', 'Sport',
       'Sport_s', 'trajectory_id', 'geometry'],
      dtype='object')</code></pre>
<p>Like Dorothy in Oz, you had the speed all along. MovingPandas does the calculation in the background for you. If you want an actual speed column, that’s easy enough:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">tc_generalized.add_speed()</span>
<span id="cb17-2">tc_generalized.trajectories[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>].df.columns</span></code></pre></div>
<pre><code>Index(['Id', 'Name', 'Lat', 'Lon', 'Elev', 'Temp', 'Weather', 'Sport',
       'Sport_s', 'trajectory_id', 'geometry', 'mi/h', 'speed'],
      dtype='object')</code></pre>
<p>Since my CRS is in meters, so is the speed. If I’d prefer miles per hour, I can specify the units:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">tc_generalized.add_speed(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mi/h'</span>, units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mi'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'h'</span>))</span>
<span id="cb19-2">tc_generalized.trajectories[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>].df.iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span></code></pre></div>
<pre><code>Id                                Workout-2024-05-30-18-41-12
Name                                              Albuquerque
Lat                                                 35.150019
Lon                                                 -106.7125
Elev                                                     1536
Temp                                                     24.2
Weather                                                     0
Sport                                                       1
Sport_s                                                  Bike
trajectory_id                                            52.0
geometry         POINT (457860.4830821714 460313.87076766626)
mi/h                                                13.109903
speed                                                5.860651
Name: 2024-05-30 18:43:54.251000, dtype: object</code></pre>
<p>In fact, we can automagically create distance, acceleration, direction, and time delta columns as well, all with arbitrary units. Here I’ll add a number of metrics in both metric and imperial units, by supplying the units and column names as parameters.</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">tc_generalized.add_distance(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance (km)"</span>, units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"km"</span>)</span>
<span id="cb21-2">tc_generalized.add_distance(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance (mi)"</span>, units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mi"</span>)</span>
<span id="cb21-3">tc_generalized.add_distance(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance (meters)"</span>, units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"m"</span>)</span>
<span id="cb21-4">tc_generalized.add_distance(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance (feet)"</span>, units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ft"</span>)</span>
<span id="cb21-5">tc_generalized.add_timedelta(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb21-6">tc_generalized.add_speed(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"speed (ft/min)"</span>, units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ft"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"min"</span>))</span>
<span id="cb21-7">tc_generalized.add_speed(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"speed (km/hour)"</span>, units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"km"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"h"</span>))</span>
<span id="cb21-8">tc_generalized.add_speed(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"speed (mi/hour)"</span>, units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mi"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"h"</span>))</span>
<span id="cb21-9">tc_generalized.add_acceleration(</span>
<span id="cb21-10">    overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"acceleration (mph/s)"</span>, units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mi"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s"</span>)</span>
<span id="cb21-11">)</span>
<span id="cb21-12">tc_generalized.add_acceleration(</span>
<span id="cb21-13">    overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"acceleration (kmph/s)"</span>, units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"km"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"s"</span>)</span>
<span id="cb21-14">)</span>
<span id="cb21-15">tc_generalized.add_direction(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb21-16">tc_generalized.add_angular_difference(overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb21-17">(tc_generalized.trajectories[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>]</span>
<span id="cb21-18"> .df.reset_index()</span>
<span id="cb21-19"> .loc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'speed'</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'angular_difference'</span>])</span></code></pre></div>
<pre><code>speed                                  5.860651
mi/h                                  13.109903
distance (km)                          0.175855
distance (mi)                          0.109271
distance (meters)                     175.85469
distance (feet)                      576.951082
timedelta                0 days 00:00:30.006000
speed (ft/min)                      1153.671431
speed (km/hour)                       21.098343
speed (mi/hour)                       13.109903
acceleration (mph/s)                   0.104386
acceleration (kmph/s)                  0.167992
direction                            349.062474
angular_difference                    70.594237
Name: 5, dtype: object</code></pre>
<p>And now, I can generate summaries somewhat easier:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">traj_bike_gen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tc_generalized.trajectories[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>]</span>
<span id="cb23-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'''</span></span>
<span id="cb23-3"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Total Distance: </span></span>
<span id="cb23-4"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_bike_gen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'distance (meters)'</span>]</span>
<span id="cb23-5">            <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>item()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;4.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> kilometers</span></span>
<span id="cb23-6"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_bike_gen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'distance (mi)'</span>]</span>
<span id="cb23-7">            <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>item()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;4.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> miles</span></span>
<span id="cb23-8"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Average Speed:</span></span>
<span id="cb23-9"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_bike_gen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'speed (km/hour)'</span>]</span>
<span id="cb23-10">            <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>item()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;4.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> kilometers per hour</span></span>
<span id="cb23-11"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_bike_gen<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'speed (mi/hour)'</span>]</span>
<span id="cb23-12">            <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>item()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;4.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> miles per hour</span></span>
<span id="cb23-13"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'''</span>)</span></code></pre></div>
<pre><code>    Total Distance: 
        18.5 kilometers
        11.5 miles
    Average Speed:
        19.2 kilometers per hour
        11.9 miles per hour</code></pre>
<p>I’m going to also add an elevation delta. I’d like to plot the speed next to the change in elevation. So I’ll add the column.</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">traj_bike_gen.df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ElevD'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb25-2">    [traj_bike_gen.df.iloc[i].Elev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> traj_bike_gen.df.iloc[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].Elev </span>
<span id="cb25-3">     <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(traj_bike_gen.df))]</span>
<span id="cb25-4">)</span></code></pre></div>
<p>Here is a plot of speed next to the elevation changes.</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>))</span>
<span id="cb26-2">traj_bike_gen.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'speed'</span>, </span>
<span id="cb26-3">                   cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'inferno'</span>, legend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, </span>
<span id="cb26-4">                  linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb26-5">traj_bike_gen.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ElevD'</span>, </span>
<span id="cb26-6">                   cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'inferno'</span>, legend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, </span>
<span id="cb26-7">                  linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb26-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>): </span>
<span id="cb26-9">    ctx.add_basemap(ax[i], crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>traj_bike_gen.crs, </span>
<span id="cb26-10">                   source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ctx.providers.Esri.NatGeoWorldMap)</span>
<span id="cb26-11">    ax[i].set_axis_off()</span>
<span id="cb26-12">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Speed'</span>)</span>
<span id="cb26-13">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Elevation Change'</span>)</span>
<span id="cb26-14">f.tight_layout()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/tda3_4.png" class="img-fluid"></p>
</section>
<section id="segmentation" class="level2">
<h2 class="anchored" data-anchor-id="segmentation">Segmentation</h2>
<p>The final topic I want to cover is route segmentation. This includes splitting the entire route by logical segments such as every 15 minutes or at stop points. It can also mean extracting a specific segment based on time or geographic location. MovingPandas has a variety of <code>Splitter</code> classes, depending on the purpose.</p>
<p>To demonstrate the split on stops, I’ll use the NYC walk from the last article, since I actually paused occasionally. In fact, the stop detector we used in that exercise could have given us the segments directly with it’s <code>get_stop_segments()</code> method, but here I’ll use the <code>StopSplitter</code>.</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1">df_ny <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gpd.read_file(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data/ny_trek.gpkg'</span>)</span>
<span id="cb27-2">df_ny[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Sport'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span></span>
<span id="cb27-3">ny_walk <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb27-4">    mpd.TrajectoryCollection(</span>
<span id="cb27-5">    df_ny, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trajectory_id'</span>, </span>
<span id="cb27-6">    t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time'</span>, x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lon'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lat'</span></span>
<span id="cb27-7">    ).trajectories[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb27-8"></span>
<span id="cb27-9">split_stop <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (mpd.StopSplitter(ny_walk)</span>
<span id="cb27-10">              .split(</span>
<span id="cb27-11">                min_duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> timedelta(seconds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>), </span>
<span id="cb27-12">                max_diameter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span>
<span id="cb27-13">split_stop</span></code></pre></div>
<pre><code>TrajectoryCollection with 18 trajectories</code></pre>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1">f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t_plot(ny_walk)</span>
<span id="cb29-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>): </span>
<span id="cb29-3">    split_stop.trajectories[i].plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>)</span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/tda3_5.png" class="img-fluid"></p>
<p>I can use the <code>TemporalSplitter</code> to divide my trek into hour-long segments:</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">split_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (mpd.TemporalSplitter(ny_walk)</span>
<span id="cb30-2">             .split(mode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hour'</span>))</span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/tda3_8.png" class="img-fluid"></p>
<p>I can also extract a single segment based on an arbitrary time range using <code>get_segment_between</code>. I’ll create two <code>datatime</code> variables to see where I was between 4:00 and 5:00 local time.</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">t1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2024</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UTC Time</span></span>
<span id="cb31-2">t2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> timedelta(minutes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>)</span>
<span id="cb31-3">segment <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ny_walk.get_segment_between(t1,t2)</span>
<span id="cb31-4">t_plot(segment)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/tda3_6.png" class="img-fluid"></p>
<p>Finally, I can extract the portion of the path which lies in a specific geographical area by using <code>clip</code> and intersecting the path with a POLYGON or bounding box. Here is an example:</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1">xmin, xmax, ymin, ymax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">191000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">192500</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">210000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">211000</span></span>
<span id="cb32-2">polygon <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Polygon(</span>
<span id="cb32-3">    [(xmin, ymin), (xmin, ymax), (xmax, ymax), (xmax, ymin), (xmin, ymin)]</span>
<span id="cb32-4">)</span>
<span id="cb32-5">intersections <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ny_walk.clip(polygon) </span>
<span id="cb32-6"></span>
<span id="cb32-7">f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t_plot(ny_walk)</span>
<span id="cb32-8">gpd.GeoSeries(polygon).plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lightblue'</span>, </span>
<span id="cb32-9">                           alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb32-10">intersections.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/tda3_7.png" class="img-fluid"></p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>I hope you had fun with these articles, and were able to harness your own GPS data to create some lovely maps of your excursions. If you subscribe to one of the apps like Strava or AllTrails you can get get their maps to underlay with your routes. MovingPandas has many more functions such as the <code>Smoother</code> referred to earlier, the <code>Cleaner</code> to identify and remove outliers, an <code>Aggregator</code> which generalizes across trajectories within a collection, and it can track multiple people in a single trajectory collection.</p>
<p>If you are already comfortable in Python’s data science space, but haven’t yet worked with geospatial data, I hope you were intrigued enough to look into it more, as explicitly including geospatial dimensions in your analyses is enriching without being terribly difficult. If you are a Pythonista without any DS experience, maybe this will help you jump in. I find that Python is such a simple, expressive language, and the libraries of Pandas, GeoPandas, and MovingPandas are such a joy to work with.</p>
<p>Happy Coding ## Additional Code To make the article easier to read, I have put code here which would need to be run before trying any of the code examples in the article. This includes the required libraries and the helper function I use when making the graphs. All code can be found on my <a href="https://github.com/biscotty666">GitHub repo</a>.</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd </span>
<span id="cb33-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> geopandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gpd </span>
<span id="cb33-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> movingpandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> mpd </span>
<span id="cb33-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb33-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> contextily <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> ctx</span>
<span id="cb33-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb33-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shapely.geometry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Polygon</span>
<span id="cb33-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta</span>
<span id="cb33-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb33-10">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ignore'</span>)</span>
<span id="cb33-11"></span>
<span id="cb33-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> t_plot(traj, </span>
<span id="cb33-13">            figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb33-14">            source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ctx.providers.Esri.NatGeoWorldMap, </span>
<span id="cb33-15">            title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, </span>
<span id="cb33-16">            column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb33-17">            ):</span>
<span id="cb33-18">    sport <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Bike Ride'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> traj.df.Sport[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Walk'</span></span>
<span id="cb33-19">    f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>figsize)</span>
<span id="cb33-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> column:</span>
<span id="cb33-21">        traj.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, lw<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>column, </span>
<span id="cb33-22">                  cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'inferno'</span>, legend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb33-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb33-24">        traj.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, lw<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cyan'</span>)</span>
<span id="cb33-25">    ctx.add_basemap(ax, crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>traj.crs, </span>
<span id="cb33-26">                    source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>source)</span>
<span id="cb33-27">    ax.set_axis_off()</span>
<span id="cb33-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> title: </span>
<span id="cb33-29">        ax.set_title(title)</span>
<span id="cb33-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb33-31">        ax.set_title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sport<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> in </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Name[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> on </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>index[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%x</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb33-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> f, ax</span>
<span id="cb33-33"></span>
<span id="cb33-34">annot_props <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(</span>
<span id="cb33-35">    xytext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb33-36">    textcoords<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"offset fontsize"</span>, </span>
<span id="cb33-37">    c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'center'</span>,</span>
<span id="cb33-38">    arrowprops<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(arrowstyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-'</span>, ec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orange'</span>)</span>
<span id="cb33-39">)</span>
<span id="cb33-40"></span>
<span id="cb33-41"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> trek_info(traj):</span>
<span id="cb33-42">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'''</span></span>
<span id="cb33-43"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Date:      </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_start_time()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%x</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-44"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Activity:  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Bike Ride'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Sport[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Walk'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-45"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Duration: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_duration()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>seconds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;3.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">   minutes</span></span>
<span id="cb33-46"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Distance: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_length(units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mi'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;5.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> miles</span></span>
<span id="cb33-47"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Avg Temp:  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>(traj.df.Temp.mean()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> degrees F</span></span>
<span id="cb33-48"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        CRS:       </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_crs()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>to_epsg()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-49"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Points:    </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>size()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-50"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Bounds:    (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>join(</span>
<span id="cb33-51">                          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb33-52">                          [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(traj.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>).get_bbox()[x], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) </span>
<span id="cb33-53">                           <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)]))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb33-54"></span>
<span id="cb33-55"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Max Elevation: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_max(column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Elev'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> meters</span></span>
<span id="cb33-56"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Min Elevation: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_min(column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Elev'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> meters</span></span>
<span id="cb33-57"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Avg Elevation: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Elev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> meters</span></span>
<span id="cb33-58"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb33-59"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                Time         Location (Lon/Lat)</span></span>
<span id="cb33-60"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Start: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-61">          traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_start_time()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%X</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb33-62">          <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-63">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>([<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(x,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> </span>
<span id="cb33-64">          traj.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>).get_start_location().coords[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb33-65">          <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> degrees</span></span>
<span id="cb33-66"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        End:   </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-67">          traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_end_time()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%X</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb33-68">          <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-69">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>([<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(x,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span></span>
<span id="cb33-70">          traj.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>).get_end_location().coords[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb33-71">          <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> degrees</span></span>
<span id="cb33-72"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    '''</span>)</span></code></pre></div>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>GIS</category>
  <category>Python</category>
  <category>Data Science</category>
  <guid>https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/</guid>
  <pubDate>Tue, 25 Feb 2025 07:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-speed-segments/tda3_3.png" medium="image" type="image/png" height="103" width="144"/>
</item>
<item>
  <title>Points to Paths in Python</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/</link>
  <description><![CDATA[ 






<section id="from-points-to-paths" class="level1">
<h1>From Points to Paths</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In the <a href="https://biscotty.online/blogs/gpx-gps-data">prior article</a>, I showed how to use raw GPS data generated from a sport tracker to create maps and profile elevations along the path. The GeoDataFrames created were just a collection of point geometries with time, location and elevation data. To profile, for example, speed, requires converting the point geometries to line geometries, calculating distances and time deltas between each point, and converting between coordinate systems and units of measurement. If we were concerned with bearing, we would need to also calculate angles between the line segments we create. None of this is overly complicated, just awfully tedious. But this being Python, there is a dedicated library that makes all of this easy peasy.</p>
<p>MovingPandas is a library that extends Pandas/Geopandas by taking the list of point geometries and turning them into “trajectories”. It generates directed lines between consecutive points, and provides functions for all of the calculations I mentioned above and more.</p>
<p>In this article I will show how to create and work with trajectories. I’ll then show how to use MovingPandas to find locations along the path based on time, find the distance from the path to nearby locations, and finally how to identify locations where I paused or stopped. In the next article, I will show how to simplify and smooth paths, profile speed, and segment the trajectories based on various criteria. As before, an expanded version of the code in this article is available in my <a href="https://github.com/biscotty666/GPX">repository</a>.</p>
</section>
<section id="getting-ready-for-movingpandas" class="level2">
<h2 class="anchored" data-anchor-id="getting-ready-for-movingpandas">Getting ready for MovingPandas</h2>
<p>I’ll start by loading the necessary libraries and creating a helper function for mapping as well as some defaults for annotating points on the maps. Then i will load some data converted from raw GPS data as described in the previous article.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd </span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> geopandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gpd </span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> movingpandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> mpd </span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> contextily <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> ctx</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> geopandas.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> reverse_geocode, geocode</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb1-9">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ignore'</span>)</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> t_plot(traj, </span>
<span id="cb1-12">            figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>), </span>
<span id="cb1-13">            source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ctx.providers.CartoDB.Voyager, </span>
<span id="cb1-14">            title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb1-15">    f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>figsize)</span>
<span id="cb1-16">    traj.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, lw<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chartreuse'</span>)</span>
<span id="cb1-17">    ctx.add_basemap(ax, crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>traj.crs, </span>
<span id="cb1-18">                    source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>source)</span>
<span id="cb1-19">    ax.set_axis_off()</span>
<span id="cb1-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> title: </span>
<span id="cb1-21">        ax.set_title(title)</span>
<span id="cb1-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb1-23">        ax.set_title(</span>
<span id="cb1-24">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Walk in </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Name[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> on </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>index[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%x</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb1-25">        )</span>
<span id="cb1-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> f, ax</span>
<span id="cb1-27"></span>
<span id="cb1-28">annot_props <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(</span>
<span id="cb1-29">    xytext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb1-30">    textcoords<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"offset fontsize"</span>, </span>
<span id="cb1-31">    c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'center'</span>,</span>
<span id="cb1-32">    arrowprops<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(arrowstyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-'</span>, ec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orange'</span>)</span>
<span id="cb1-33">)</span>
<span id="cb1-34"></span>
<span id="cb1-35">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data/b3/combined.csv'</span>)</span>
<span id="cb1-36">gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gpd.GeoDataFrame(</span>
<span id="cb1-37">    df, </span>
<span id="cb1-38">    geometry<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gpd.points_from_xy(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.Lon, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.Lat), </span>
<span id="cb1-39">    crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span></span>
<span id="cb1-40">).to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32111</span>)</span></code></pre></div>
<p>MovingPandas requires an integer id for each walk, which I don’t have, so I’ll create one based on the string id. I’ll also convert the <code>Time</code> from a generic object to <code>datetime64</code>.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">idList <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(gdf.groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Id'</span>]).nunique().reset_index().Id)</span>
<span id="cb2-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, track <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(idList):</span>
<span id="cb2-3">    gdf.loc[gdf.Id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> track, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trajectory_id'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i</span>
<span id="cb2-4">gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(gdf.Time)</span>
<span id="cb2-5">gdf.info()</span></code></pre></div>
<pre><code>&lt;class 'geopandas.geodataframe.GeoDataFrame'&gt;
RangeIndex: 3044 entries, 0 to 3043
Data columns (total 10 columns):
 #   Column         Non-Null Count  Dtype              
---  ------         --------------  -----              
 0   Id             3044 non-null   object             
 1   Name           3044 non-null   object             
 2   Lat            3044 non-null   float64            
 3   Lon            3044 non-null   float64            
 4   Elev           3044 non-null   int64              
 5   Time           3044 non-null   datetime64[ns, UTC]
 6   Temp           3044 non-null   float64            
 7   Weather        3044 non-null   int64              
 8   geometry       3044 non-null   geometry           
 9   trajectory_id  3044 non-null   float64            
dtypes: datetime64[ns, UTC](1), float64(4), geometry(1), int64(2), object(2)
memory usage: 237.9+ KB</code></pre>
<p>One of the walks in the collection was in New York City, and the rest in New Jersey. Since the locations are pretty far apart, I’ll split out the NYC walk from the others.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">gdf_nj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gdf.loc[gdf.Name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'New York'</span>]</span>
<span id="cb4-2">gdf_ny <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gdf.loc[gdf.Name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'New York'</span>]</span>
<span id="cb4-3">gdf_nj.shape, gdf_ny.shape</span></code></pre></div>
<pre><code>((2063, 10), (981, 10))</code></pre>
</section>
<section id="getting-going-with-movingpandas" class="level2">
<h2 class="anchored" data-anchor-id="getting-going-with-movingpandas">Getting going with MovingPandas</h2>
<p>Now I’m ready to create the trajectories. The data will be imported as a <em>Trajectory Collection</em> which will contain the individual <em>Trajectories</em>. I’ll first create one from the NJ group, which contains several walks.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">tc_nj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mpd.TrajectoryCollection(</span>
<span id="cb6-2">    gdf_nj, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trajectory_id'</span>, </span>
<span id="cb6-3">    t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time'</span>, x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lon'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lat'</span></span>
<span id="cb6-4">)</span>
<span id="cb6-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(tc_nj)</span></code></pre></div>
<pre><code>TrajectoryCollection with 6 trajectories</code></pre>
<p>Let’s see what this looks like.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> traj_collection.plot(</span>
<span id="cb8-2">    column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trajectory_id'</span>, </span>
<span id="cb8-3">    legend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Set1'</span>)</span>
<span id="cb8-4">ax.set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Walks in NJ, September 2024'</span>)</span>
<span id="cb8-5">ctx.add_basemap(ax, crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gdf_proj.crs,</span>
<span id="cb8-6">                source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ctx.providers.Esri.WorldTopoMap)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/nj1.png" class="img-fluid"></p>
<p>I can extract a single trajectory and its underlying data frame.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">traj_nj1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tc_nj.trajectories[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb9-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(traj_nj1)</span></code></pre></div>
<pre><code>Trajectory 2.0 (2024-09-07 21:20:23.975000 to 2024-09-07 22:03:42.022000) | Size: 267 | Length: 5173.1m
Bounds: (177912.1946985984, 243124.49067874879, 179216.17084672116, 245408.85808260852)
LINESTRING (178912.27991325516 244815.1747420021, 178912.27991325516 244815.1747420021, 178903.67850</code></pre>
<p>The associated data is stored in the <code>df</code> attribute:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(traj_nj1.df.info())</span></code></pre></div>
<pre><code>&lt;class 'geopandas.geodataframe.GeoDataFrame'&gt;
DatetimeIndex: 267 entries, 2024-09-07 21:20:23.975000 to 2024-09-07 22:03:42.022000
Data columns (total 9 columns):
 #   Column         Non-Null Count  Dtype   
---  ------         --------------  -----   
 0   Id             267 non-null    object  
 1   Name           267 non-null    object  
 2   Lat            267 non-null    float64 
 3   Lon            267 non-null    float64 
 4   Elev           267 non-null    int64   
 5   Temp           267 non-null    float64 
 6   Weather        267 non-null    int64   
 7   geometry       267 non-null    geometry
 8   trajectory_id  267 non-null    float64 
dtypes: float64(4), geometry(1), int64(2), object(2)
memory usage: 29.0+ KB
None</code></pre>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">t_plot(traj_nj1, source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ctx.providers.OpenStreetMap.HOT)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/nj2.png" class="img-fluid"></p>
<p>Another way to extract a specific trajectory is using MovingPandas’ <code>filter</code> function, as so:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">t_plot(</span>
<span id="cb14-2">tc_nj.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Name"</span>, [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Park Ridge"</span>])</span>
<span id="cb14-3">     .trajectories[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb14-4">)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/nj3.png" class="img-fluid"></p>
<p>For the rest of the article I’ll use the longest trek I have in this data set, the one in New York. I’ll create the Trajectory Collection, extract the single trajectory and find the start and end times and locations.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">tc_ny <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mpd.TrajectoryCollection(</span>
<span id="cb15-2">    gdf_ny, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trajectory_id'</span>, </span>
<span id="cb15-3">    t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time'</span>, x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lon'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lat'</span></span>
<span id="cb15-4">)</span>
<span id="cb15-5">traj_ny <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tc_ny.trajectories[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb15-6">st <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> traj_ny.get_start_time()</span>
<span id="cb15-7">sl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> traj_ny.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>).get_start_location()</span>
<span id="cb15-8">et <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> traj_ny.get_end_time()</span>
<span id="cb15-9">el <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> traj_ny.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>).get_end_location()</span>
<span id="cb15-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'''</span></span>
<span id="cb15-11"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">            Time         Location (Lon/Lat)</span></span>
<span id="cb15-12"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">            </span></span>
<span id="cb15-13"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Start: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>st<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%X</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">   </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>coords[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> degrees</span></span>
<span id="cb15-14"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    End:   </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>et<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%X</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">   </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>el<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>coords[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">  degrees</span></span>
<span id="cb15-15"></span>
<span id="cb15-16"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Duration:  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_ny<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_duration()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>seconds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> minutes</span></span>
<span id="cb15-17"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Distance:  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_ny<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_length(units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mi'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> miles</span></span>
<span id="cb15-18"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Direction: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_ny<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_direction()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> degrees</span></span>
<span id="cb15-19"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'''</span>)</span></code></pre></div>
<pre><code>            Time         Location (Lon/Lat)
            
    Start: 17:43:42   (-73.991157, 40.752025) degrees
    End:   20:49:09   (-73.98894, 40.726903)  degrees

    Duration:  185 minutes
    Distance:  6.69 miles
    Direction: 176 degrees</code></pre>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">t_plot(traj_ny)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/ny1.png" class="img-fluid"></p>
</section>
<section id="right-place-right-time" class="level2">
<h2 class="anchored" data-anchor-id="right-place-right-time">Right place, right time</h2>
<p>First, let me find my position at an arbitrary time, and then 30 minutes later. Where was I, for example, at 18:00, and then 45 minutes later?</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2024</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>)</span>
<span id="cb18-2">t2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> timedelta(minutes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>)</span>
<span id="cb18-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'''</span></span>
<span id="cb18-4"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Nearest:      </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_ny<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>)</span>
<span id="cb18-5">                    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_position_at(t, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nearest'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-6"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Interpolated: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_ny<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>)</span>
<span id="cb18-7">                    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_position_at(t, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'interpolated'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-8"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Previous row: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_ny<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>)</span>
<span id="cb18-9">                    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_position_at(t, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ffill'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-10"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Next row:     </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>traj_ny<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>)</span>
<span id="cb18-11">                    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_position_at(t, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bfill'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-12"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'''</span>)</span></code></pre></div>
<pre><code>    Nearest:      POINT (-74.003574 40.756368)
    Interpolated: POINT (-74.00361304734385 40.75638409846633)
    Previous row: POINT (-74.003688 40.756415)
    Next row:     POINT (-74.003574 40.756368)</code></pre>
<p>I can use the <code>geocode</code> tool provided by geopandas to get the nearest addresses at these points so I can show them on the map. Pay attention to crs, since nominatim expects lat/lon coordinates and we currently have projected coordinates.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">point <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> traj_ny.get_position_at(t, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'interpolated'</span>)</span>
<span id="cb20-2">point_up <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> traj_ny.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>).get_position_at(t, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'interpolated'</span>)</span>
<span id="cb20-3">point2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> traj_ny.get_position_at(t2, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'interpolated'</span>)</span>
<span id="cb20-4">point2_up <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> traj_ny.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>).get_position_at(t2, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'interpolated'</span>)</span>
<span id="cb20-5"></span>
<span id="cb20-6">rg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> reverse_geocode(</span>
<span id="cb20-7">    [point_up, point2_up], </span>
<span id="cb20-8">    provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nominatim"</span>, </span>
<span id="cb20-9">    user_agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your_project"</span>, </span>
<span id="cb20-10">    timeout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb20-11">).to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32111</span>)</span>
<span id="cb20-12"></span>
<span id="cb20-13">f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t_plot(traj_ny)</span>
<span id="cb20-14">gpd.GeoSeries(point).plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb20-15">gpd.GeoSeries(point2).plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb20-16"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x, y, label <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(rg.geometry.x, rg.geometry.y, rg.address):</span>
<span id="cb20-17">    ax.annotate(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">','</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">','</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, </span>
<span id="cb20-18">                xy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(x, y), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>annot_props)</span>
<span id="cb20-19">ax.set_ylim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">211500</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">214500</span>)</span>
<span id="cb20-20">ax.set_xlim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">191400</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">192500</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/ny2.png" class="img-fluid"></p>
<p>It might be more interesting to plot my location at regular intervals along the walk. What about plotting my location every 30 minutes?</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">int_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (et <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> st) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> timedelta(seconds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>))</span>
<span id="cb21-2">int_length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (et <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> st) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> int_count</span>
<span id="cb21-3">intervals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [st <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>int_length) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(int_count)]</span>
<span id="cb21-4">interval_points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [traj_ny.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>).get_position_at(</span>
<span id="cb21-5">                    t, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'interpolated'</span>) </span>
<span id="cb21-6">                   <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> intervals]</span>
<span id="cb21-7">rg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> reverse_geocode(</span>
<span id="cb21-8">    interval_points, </span>
<span id="cb21-9">    provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nominatim"</span>, </span>
<span id="cb21-10">    user_agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your_project"</span>, </span>
<span id="cb21-11">    timeout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb21-12">).to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32111</span>)</span>
<span id="cb21-13"></span>
<span id="cb21-14">f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t_plot(traj_ny, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>))</span>
<span id="cb21-15">rg.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb21-16"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x, y, label <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(rg.geometry.x, rg.geometry.y, rg.address):</span>
<span id="cb21-17">    ax.annotate(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">','</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">','</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, </span>
<span id="cb21-18">                xy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(x, y), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>annot_props)</span>
<span id="cb21-19">ax.set_title(ax.get_title() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Every 30 minutes'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/ny3.png" class="img-fluid"></p>
</section>
<section id="i-was-so-close" class="level2">
<h2 class="anchored" data-anchor-id="i-was-so-close">I was so close</h2>
<p>Not only can you calculate distances along the path, which we will look at more in the next article, but you can calculate the distance from points along the trajectory to other locations not on the path. It will determine the closest you came to other points, lines or polygons, including, of course, other trajectories. For example, when I’m in New York, I love to visit the Strand and the huge Barnes and Noble on Union Square. I didn’t have time this trip, sadly, but I’m curious how close I was from those stores.</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">addresses <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [{</span>
<span id="cb22-2">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb22-3">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The Strand"</span>, </span>
<span id="cb22-4">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'addr'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"828 Broadway, New York, NY 10003"</span></span>
<span id="cb22-5">            }, </span>
<span id="cb22-6">            {</span>
<span id="cb22-7">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb22-8">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Barnes and Noble"</span>, </span>
<span id="cb22-9">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'addr'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"33 East 17th Street, 10003, New York"</span></span>
<span id="cb22-10">            }]</span>
<span id="cb22-11">add_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(addresses)</span>
<span id="cb22-12">geo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> geocode(</span>
<span id="cb22-13">    add_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'addr'</span>], </span>
<span id="cb22-14">    provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nominatim'</span>, </span>
<span id="cb22-15">    user_agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'your_project'</span>, </span>
<span id="cb22-16">    timeout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb22-17">)</span>
<span id="cb22-18">book_stores <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> geo.join(add_df).to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32111</span>)</span>
<span id="cb22-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(book_stores)</span></code></pre></div>
<pre><code>                        geometry  \
0  POINT (192997.822 211055.516)   
1  POINT (193108.568 211461.041)   

                                             address  id              name  \
0  Strand Bookstore, 828, Broadway, University Vi...   1        The Strand   
1  Barnes &amp; Noble, 33, East 17th Street, Union Sq...   2  Barnes and Noble   

                                   addr  
0      828 Broadway, New York, NY 10003  
1  33 East 17th Street, 10003, New York</code></pre>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">dists_to <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [traj_ny.distance(book_stores.loc[i, [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'geometry'</span>]], </span>
<span id="cb24-2">                            units<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mi'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] </span>
<span id="cb24-3">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(book_stores))]</span>
<span id="cb24-4">store_names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [book_stores.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>] </span>
<span id="cb24-5">               <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(book_stores))]</span>
<span id="cb24-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(book_stores)):</span>
<span id="cb24-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Closest distance to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>store_names[i]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> was </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>dists_to[i]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> miles'</span>) </span></code></pre></div>
<pre><code>Closest distance to The Strand was 0.4 miles
Closest distance to Barnes and Noble was 0.6 miles</code></pre>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t_plot(traj_ny, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>))</span>
<span id="cb26-2">book_stores.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb26-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x, y, label <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(book_stores.geometry.x, </span>
<span id="cb26-4">                       book_stores.geometry.y, </span>
<span id="cb26-5">                       book_stores.name):</span>
<span id="cb26-6">    ax.annotate(label, xy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(x,y), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>annot_props)</span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/ny4.png" class="img-fluid"></p>
</section>
<section id="stop-detection" class="level2">
<h2 class="anchored" data-anchor-id="stop-detection">Stop detection</h2>
<p>In this final section I’ll look at stop detection. Here I’ll just be considering stop locations. In the next article, I’ll show how to use the same approach as one method for segmenting the trajectories. Stop detection requires instantiation of a stop detector which will provide the functions needed.</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1">detector <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mpd.TrajectoryStopDetector(traj_ny)</span></code></pre></div>
<p>The detector takes parameters to determine how long a pause constitutes a <code>stop</code>, and how far you need to move to constitute movement.</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">stop_points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> detector.get_stop_points(</span>
<span id="cb28-2">    min_duration<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>timedelta(seconds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>), max_diameter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb28-3">)</span>
<span id="cb28-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(stop_points)</span></code></pre></div>
<pre><code>18</code></pre>
<p>We can look up the addresses nearest to the stop points, and plot some of them on the map.</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">stop_points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stop_points.set_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32111</span>)</span>
<span id="cb30-2">rg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> reverse_geocode(</span>
<span id="cb30-3">    stop_points.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>).geometry, </span>
<span id="cb30-4">    provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nominatim"</span>, </span>
<span id="cb30-5">    user_agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your_project"</span>, timeout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb30-6">).to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32111</span>)</span></code></pre></div>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t_plot(traj_ny)</span>
<span id="cb31-2">stop_points.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>, markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, ec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>)</span>
<span id="cb31-3">point_labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>]</span>
<span id="cb31-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (x, y), label <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(</span>
<span id="cb31-5">                    rg.iloc[point_labels].geometry.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(</span>
<span id="cb31-6">                        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> p: p.coords[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), </span>
<span id="cb31-7">                    rg.iloc[point_labels].address):</span>
<span id="cb31-8">    ax.annotate(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">','</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">','</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, </span>
<span id="cb31-9">                xy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(x, y), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>annot_props)</span>
<span id="cb31-10">ax.set_title(ax.get_title() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Stop Points'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/ny5.png" class="img-fluid"></p>
</section>
<section id="interactive-graphing" class="level2">
<h2 class="anchored" data-anchor-id="interactive-graphing">Interactive graphing</h2>
<p>Showing interactive graphing in the context of a published article is not very useful, but I should point out that MovingPandas supports both <code>hvplot</code> with <code>folium</code> as well as GeoPandas’ <code>explore()</code>, both of which can be useful tools for identifying areas of interest. This is an example with <code>explore()</code>.</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1">m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> traj_ny.explore(</span>
<span id="cb32-2">    column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trajectory_id"</span>,</span>
<span id="cb32-3">    tooltip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>,</span>
<span id="cb32-4">    popup<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb32-5">    style_kwds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>},</span>
<span id="cb32-6">    name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>,</span>
<span id="cb32-7">)</span>
<span id="cb32-8"></span>
<span id="cb32-9">stop_points.explore(</span>
<span id="cb32-10">    m<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>m,</span>
<span id="cb32-11">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,</span>
<span id="cb32-12">    tooltip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stop_id"</span>,</span>
<span id="cb32-13">    popup<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb32-14">    marker_kwds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"radius"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>},</span>
<span id="cb32-15">    name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stop points"</span>,</span>
<span id="cb32-16">)</span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/ny6.png" class="img-fluid"></p>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>In the third article, I will address issues of generalization and simplification which can be important when working with large data sets. I’ll show how to generate speed, duration and distance information, and how to segment the trajectories based on geometries, stops, and other criteria. I hope that these articles are proving interesting and useful. Please visit my <a href="https://biscotty.online">website</a> and <a href="https://github.com/biscotty666/GPX">repository</a> for more code, articles and updates.</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Data Science</category>
  <category>GIS</category>
  <category>Python</category>
  <guid>https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/</guid>
  <pubDate>Mon, 03 Feb 2025 07:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/data-science/python-gpx-mapping/python-movingpandas-points-paths/ny6.png" medium="image" type="image/png" height="87" width="144"/>
</item>
<item>
  <title>NixOS: the Linux different</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/linux/nixos-linux-different/</link>
  <description><![CDATA[ 






<p>NixOS is a Linux distribution with a radically different design from any other. The NixOS approach solves many problems in the design of other Linux systems. However, since the NixOS paradigm relies on ideas foreign to many people such as graphs and functional programming, it carries a particularly steep learning curve. Switching from Ubuntu to Fedora is painless. Switching to NixOS is not.</p>
<p>I feel strongly that it is worth the learning curve, which in my experience isn’t really so bad. You can really use NixOS without understanding immutability, graphs or functional programming. But, to understand why NixOS is a cut above all the rest, some understanding of the design is helpful.</p>
<p>Here is a first attempt at a general description of NixOS and why it is so different.</p>
<section id="how-different-really-different." class="level2">
<h2 class="anchored" data-anchor-id="how-different-really-different.">How different? Really different.</h2>
<p>After you’ve been working with with Linux long enough, you realize that all distributions are pretty much the same. Different but similar package managers and different but similar package repositories, and different default desktop environments. Some kernel tweaks as well perhaps, but given a command line it is almost trivial to move from one distribution to another.</p>
<p>Not so with NixOS. Want to see what software is installed? You won’t find anything in <code>/usr/bin</code>, or any other typical <code>bin</code> or <code>opt</code> directory. Want to add an alias to <code>/etc/hosts</code>? That file, indeed much in <code>/etc</code>, turns out to be read-only, even to root. Add a user with <code>useradd</code>? Nope. Install some software in a gui “App Store”, or even with a command like <code>apt install</code>? These don’t exist. In fact, many of your basic system administration skills seem useless with NixOS not adhering to FHS (file heirarchy standard) or having the ability to edit configuration files. But, don’t be sad, your Linux skills are still important, because…</p>
</section>
<section id="its-still-linux" class="level2">
<h2 class="anchored" data-anchor-id="its-still-linux">It’s still Linux</h2>
<p>NixOS is, never-the-less, Linux just as much as is Fedora or Debian. It runs a Linux kernel with all the GNU api tools (or their Rust alternatives). It has a large package repository, the largest of any, in fact. It even uses SystemD 😞. You can add any software that runs on Linux, and to an ordinary “end user”, the daily experience is the same as on any other distro. They might remark how stable and snappy it is, but their day to day workflow would not be different.</p>
<p>Under the hood, though, everything is different on a fundamental level. Given the learning curve, which make is seem like a completely new operating system rather than just another Linux distribution, the obvious question is: why bother? There are many reasons, but one is that, once the Nix way is grokked, all of these admin tasks I mentioned become much simpler and straight-forward, more robust, easier to rollback, and fully reproducible. I guess that’s more than one reason.</p>
</section>
<section id="getting-a-little-personal" class="level2">
<h2 class="anchored" data-anchor-id="getting-a-little-personal">Getting a little personal</h2>
<p>For me, NixOS is a sort of the culmination of why I turned to Linux decades ago. When Windows first came out, compared to DOS, it was cool and all, but I felt like a veil had been drawn over the OS, which then became hidden and mysterious. Apple computers seemed even worse in this aspect. For some types of work, the graphical user interface was a great step forward. But for other things, the gui just obscured the underlying workings of the computer and made anything outside of typical usage more difficult. On top of that was the irritating instability. With every system crash, I wanted to understand what was really going on so I could fix it.</p>
<p>Then I discovered Linux, and more specifically Slackware, which uses a terminal and vi (elvis at the time) for all administrative tasks. The ability to understand exactly what my computer was doing, to configure it with text files, to install, and if necessary, build, software from the command line, was just what I was looking for. I even compiled my own kernels back then. When I started using other distributions, I never took more than a quick glance at their graphical admin tools like app stores and such. Give me the command line any day, and every distribution is basically the same.</p>
</section>
<section id="aging-systems-and-other-problems" class="level2">
<h2 class="anchored" data-anchor-id="aging-systems-and-other-problems">Aging systems and other problems</h2>
<p>As experienced Linux users know, there are many issues which arise over time on any Linux system, such as software upgrades which create library version conflicts, problems which are made worse on shared systems. Cruft accumulates as uninstalls are rarely clean, especially with regard to program data files and directories. If you install and uninstall many programs, after a certain amount of time, it is difficult to be sure exactly what lingers in /etc, /usr/share, ~/.local, or anywhere else, for that matter. After a year of installing, uninstalling and configuring software, how can you be sure what is actually there? And when your new computer arrives, or you finally decide to do a clean install instead of a version upgrade, how much effort will it take to set it up exactly how you like it?</p>
<p>Enter NixOS, where I can declare the entire operating system with text files! I can write down what I want, and know that that will be all that there is on my system, despite what may have been there before. I can, for example, simply grep my configs to see everything installed and all configurations, without needing a special package manager tool. In fact, with NixOS, nothing is every really installed, upgraded, or uninstalled, not in the traditional sense anyway. Any of these activities generates a brand, spankin’ new system image which entirely replaces the old one.</p>
</section>
<section id="embrace-the-difference" class="level2">
<h2 class="anchored" data-anchor-id="embrace-the-difference">Embrace the difference</h2>
<p>Here be dragons, but they are auspicious Chinese dragons, not scary European ones. The singular power of NixOS lies in the differences, so they are worth exploring. They involve ideas such as declarative, functional programming vs imperative, procedural programming, graphs vs stacks, immutable systems, atomic upgrades and ephemeral packages. Also, Nix/NixOS isn’t just one thing, it is a programming language (Nix), package manager (Nix), repository (nixpkgs), and operating system (NixOS).</p>
<p>Exploring all these topics would be overwhelming in one article, so it is my intention to write an occasional series on each. None of these will be tutorials, rather they are intended as an introduction to the ideas useful to understanding NixOS. As a practical matter, Nix the package manager and language can be installed on any computer and be experimented with, or even used as a primary package manager for your current system. NixOS also runs nicely in a virtual machine. To learn NixOS you’ll need to get your hands dirty, and for me at least, getting used to NixOS and configuring my system from the comfort of Fedora made the eventual switch to metal completely painless, as I just needed to copy the configs I had created to the new partition and build it, not repeat my work.</p>
<p>NixOS is not for everyone. The imperative paradigm has worked reasonably well for decades, and has the virtue of familiarity, so there is no strong motivation to change for most users. On the other hand, if, like me, you are a programmer or data scientist, for example, and you prize stability, clarity, and simplicity, if you find change and learning new ways to be stimulating, and if you know that the most interesting things in life are on the roads less traveled, you will be delighted by NixOS.</p>
<p>To get started, <a href="../../../posts/linux/nix-docker-fhs/index.html">here</a> is an article on the File Heirarchy Standard, which NixOS abandoned for a graph structure. In so doing, Nix sidesteps the need for containers such as Docker, Distrobox or Flatpaks.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Linux</category>
  <category>Distributions</category>
  <guid>https://biscotty.online/posts/linux/nixos-linux-different/</guid>
  <pubDate>Mon, 10 Jun 2024 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/linux/nixos-linux-different/NixosWinter.png" medium="image" type="image/png" height="108" width="144"/>
</item>
<item>
  <title>Obsidian and Jupyter Notebooks</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/obsidian-jupyter/</link>
  <description><![CDATA[ 






<section id="obsidian-and-jupyter-notebooks" class="level1">
<h1>Obsidian and Jupyter Notebooks</h1>
<blockquote class="blockquote">
<p>Personal Knowledge Management for Data Science</p>
</blockquote>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<p>Jupyter notebooks, or more properly iPython notebooks, are fantastic tools for data exploration and modeling. You can run bits of code, interspersed with blocks of markdown, allowing you to easily work with data and present analyses and forecasts in a visual and interactive format. Notebooks can be easily shared via GitHub, or run on-line with Colab.</p>
<p>The problem with iPython notebooks, from a Personal Knowledge Management perspective, is they end up being “books on the shelf”. For Obsidian users and PKM practitioners, the whole point is to get away from keeping information in notebooks, with all the uselessness that that implies. One could, as you will see, just do data exploration directly in Obsidian instead of in a standard iPython notebook. But Obsidian is not an IDE. The ecosystem around the interactive Python notebook IDEs, be it Jupyter Lab itself, or VS Code, etc, is so useful, that working in Obsidian while exploring data and creating models would be unacceptably tedious. Using fit-for-purpose tools is very important for efficiency.</p>
<p>We need a painless way to capture all this information in our vault, making <em>notes</em> out of the notebooks. How can we easily make this information future-useful, without repeating/duplicating our efforts or doing a ton of copy/paste? In this article, I’ll explain the solution that works well for me, ensuring Obsidian-speed access to any bits of information I have in my notebooks, as well as making review and study activities so much more pleasant. And, of course, my canvases have all gotten richer as well.</p>
</section>
<section id="setting-up-obsidian" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-obsidian">Setting up Obsidian</h2>
<p>The community plugin needed to accomplish this is called <a href="https://github.com/twibiral/obsidian-execute-code">Execute Code</a>, written by Tim Wibiral together with Jupyter and a library called <code>nbconvert</code>. The latter will convert the notebooks to markdown, and the plugin allows you to execute the code directly within a note. To get started, create a virtual environment for Obsidian to use. If you aren’t using virtual environments, please start now! It’s simple, and you will avoid future problems. From the command line, do:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$HOME</span>/.config/venvs <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> venv obsidian_venv</span>
<span id="cb1-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">source</span> obsidian_venv/bin/activate</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--upgrade</span> pip</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install jupyterlab nbconvert </span></code></pre></div>
<p>You can install other libraries like Pandas and Matplotlib as well into the virtual environment with pip install. Jupyter lab and nbconvert will be necessary to convert the notebooks to markdown. At this point, you could launch <code>jupyter lab</code>, but there is no need to. After installing packages, you can exit the virtual environment with <code>deactivate</code>. Should you need to install more packages later, you can type <code>source $HOME/.config/venvs/obsidian_venv/bin/activate</code> to re-enter the virtual environment and <code>pip install</code> other packages.</p>
<p>In Obsidian, install the Execute Code plugin. After installing the plugin you must point it to the version of Python you want to use, in this case the one we made in the virtual environment above. In the settings for the plugin, under the language-specific settings, choose Python from the drop down list. For <em>Python Path</em>, enter <code>/home/directory/.config/venvs/obsidian_venv/bin/python</code>.</p>
<p>With that done, any code block with the keyword <code>python</code> added directly after the opening back ticks of the block can be run in the Note. In Read view, a <em>Run</em> button will appear by each code block, allowing you to execute the code in the block. After execution, there will be a <em>Clear</em> button to clear up output that you want removed from the note. Code can also be executed from Edit view by using the keyword <code>run-python</code> rather than simply <code>python</code>. The plugin offers a command to run all the code in the note, as well as a command to view and kill any active runtimes.</p>
</section>
<section id="processing-a-notebook" class="level2">
<h2 class="anchored" data-anchor-id="processing-a-notebook">Processing a notebook</h2>
<p>Jupyter Lab can export an <code>ipynb</code> file directly to markdown! As of writing, VS Code can only export to <code>py</code>, <code>pdf</code> or <code>html</code>. From the file menu, select <em>Export</em> and choose <em>Markdown</em>. This will generate a zipped archive containing a markdown page, along with any image files in the notebook. The problem with this approach is that you will find all of the image files named <code>output</code> something, and so after exporting a few notebooks, there will be name conflicts in your vault.</p>
<p>Using the command line avoids this problem, and is in any case much more efficient. You will need to activate your virtual environment with <code>source</code> as described above. Then type</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jupyter</span> nbconvert <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--to</span> Markdown your_notebook.ipynb</span></code></pre></div>
<p>This will generate an <code>md</code> file which can be copied into your vault. If there are images from generated by the output, like graphs and other visuals, these will be put in a directory created by the above command. If you copy this directory, with all the image files into the vault directory that you use for attachments, the new <code>md</code> file will find them. (It is important to copy the directory itself and not just the files, since the new note will expect to find them there.)</p>
<p>Once in Obsidian you can process your Notebooks as any other file, breaking them into bite-size chunks of information. I rely heavily on “Extract this heading”, available with a right-click on any heading in a note. This replaces the section with a link to a newly-created note containing the section’s content. I find it useful to use a template that loads common libraries, since they will need to be added them at the top of the new files.</p>
<p>When converting your notebooks to notes, be aware that different notes do not share the same runtime. Be sure to include all the variables/calculations necessary for the part of the code you extracted in the new file, as this will not be available from another file’s state. Also, any images that you link to in the markdown sections of the original notebook will need to be manually copied into the vault, as only images generated from code in the file will be exported. ## Closing Thoughts</p>
<p>I first started using Obsidian for the specific purpose of studying data science. My use of Obsidian broadened considerably and quickly once I first began with it. However, after some time I realized that, because of the nature of iPython notebooks, and the necessity, or really the pleasure, of using them, I found myself many months later in the very position I was trying to avoid vis-a-vis my notes: information I needed was somewhere in my piles of notebooks, and I turned to Google more often than searching through my notebooks.</p>
<p>Now I can immerse myself in the Python project or study I am focusing on, knowing that after I’m finished, generating proper atomic notes from the work I’m doing will be a breeze. I hope that you may find this information useful. Happy coding!</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Obsidian</category>
  <category>Python</category>
  <category>Data Science</category>
  <guid>https://biscotty.online/posts/obsidian/obsidian-jupyter/</guid>
  <pubDate>Wed, 20 Mar 2024 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/obsidian-jupyter/Jupyter-Obsidian.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Trail Mapping with Python</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/data-science/python-gpx-mapping/gpx-gps-data/</link>
  <description><![CDATA[ 






<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In the world of Data Science, I’m most strongly drawn to geographically-linked data. Choropleth maps, for example, are about the most powerful way to convey statistical information and get a point across, if you will forgive the intolerable pun. Attaching data to geography somehow makes information more relatable, more personal, and more easily absorbable. It gives people a reference point, a “you are here”, if you will, or maybe “There, but for the grace of God…”.</p>
<p>I am fortunate to live in New Mexico where I can take beautiful and varied walks, hikes and bike rides nearly every day, which I do. I record most of my excursions with an app on my phone, and I realized recently that I must have lots of data that I can play with to do mapping and analysis. I was pleased to discover that the simple app I use on my phone to track my excursions can easily export the data to GPX format. I had no idea what GPX format was then, but assumed it was some standard, so things looked promising, and off I went.</p>
<p>The data I use comes from an app called SportActive. Apps like AllTrails and Strava are wonderful, especially when exploring new places, but they are overkill IMO for simple tracking of daily, and largely repetitive, activities. SportActive simply records my walks and rides, without asking if I want to share my walk with my “friends” like a meal on Facebook. (Disclaimer: I have no financial relationship with SportActive, although if you could arrange such a thing I’d happily change this disclaimer.)</p>
<p>In this and two following articles, I will show how the data can be used with Python to map and analyze the GPS information. I will show how to do analyses such as profiling elevations, calculating speeds and durations, identifying pauses, and segmenting paths based on various criteria. This type of analysis, which I’m doing for fun, is the very same as could be used to, for example, study bird migrations or the movement of container ships.</p>
<p>Python provides many libraries based around the pandas ecosystem which make working with geospatial data easy. GeoPandas extends Pandas to incorporate geometries and coordinate reference systems. GPX data is a series of geolocated points, which is easily handled by geopandas. MovingPandas facilitates turning the point geometries into “trajectories”, allowing for calculations of speed, duration and direction.</p>
<p>This article will cover parsing the raw GPS data to a csv file, which I then import into a geopandas <code>GeoDataFrame</code>. From that I will create maps and generate some basic statistical information about the trek such as distance and elevation profiles. These articles assume basic familiarity with Python, experience with Pandas being helpful. An expanded version of the code in the articles can be obtained from my GitHub repository at https://github.com/bisotty666/GPX.</p>
</section>
<section id="xml-to-csv" class="level1">
<h1>XML to CSV</h1>
<p>The GPX file turns out to be an xml file with standardized tags. Most importantly, it contains a list of tags called <code>trkpt</code> which, as the name implies, are points along the trek, each recording the geographic location in latitude and longitude, together with the elevation and the time of the recording. An example is</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb1-1">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">trkpt</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> lat=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"41.043858"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> lon=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-74.063712"</span>&gt;</span>
<span id="cb1-2">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ele</span>&gt;79&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ele</span>&gt;</span>
<span id="cb1-3">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">time</span>&gt;2024-09-05T15:25:13.858Z&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">time</span>&gt;</span>
<span id="cb1-4">&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">trkpt</span>&gt;</span></code></pre></div>
<p>This format cannot be directly imported into a <code>GeoDataFrame</code>, but <code>csv</code> files can be, and fortunately, there is a Python library called BeautifulSoup that can not only efficiently parse HTML, it can also process XML files, which I can write a <code>csv</code> file. So I’ll start by importing it as well as the <code>csv</code> library, and “make the soup”:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> bs4 <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BeautifulSoup</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> csv</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(gpx_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb2-5">    contents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb2-6"></span>
<span id="cb2-7">soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(contents, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'xml'</span>)</span></code></pre></div>
<p>I’ll grab the elements of interest, as well as some metadata, with:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">tracks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trkpt'</span>)</span>
<span id="cb3-2">elevations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ele'</span>)</span>
<span id="cb3-3">times <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'time'</span>)</span>
<span id="cb3-4">temp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s2t:temperature'</span>).text</span>
<span id="cb3-5">weather <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s2t:weather'</span>).text</span>
<span id="cb3-6">name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>).text</span></code></pre></div>
<p>I expect to concatenate a bunch of these files, so I’ll also add the filename itself as a column:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">sf_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>  os.path.splitext(gpx_file)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb4-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.split(sf_name)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb4-3">csv_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sf_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.csv'</span></span></code></pre></div>
<p>Then I make a list of the points with each of these elements connected with their geographic coordinates:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> track, elevation, time <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(tracks, elevations, times):</span>
<span id="cb5-3">    latitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> track[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lat'</span>]</span>
<span id="cb5-4">    longitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> track[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lon'</span>]</span>
<span id="cb5-5">    elevation_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> elevation.text</span>
<span id="cb5-6">    time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.text</span>
<span id="cb5-7">    data.append([<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>, latitude, longitude, elevation_value,</span>
<span id="cb5-8">                time, temp, weather])</span></code></pre></div>
<p>And now I can write the CSV file:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(csv_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'w'</span>, newline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> csvfile:</span>
<span id="cb6-2">    writer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> csv.writer(csvfile)</span>
<span id="cb6-3">    writer.writerow([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Id'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lat'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lon'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Elev'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time'</span>,</span>
<span id="cb6-4">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Temp'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Weather'</span>])</span>
<span id="cb6-5">    writer.writerows(data)</span></code></pre></div>
<p>Since I want to process a lot of these files, as well as concatenate them, I put this together in a script for batch processing, which I’ll add at the end. # Importing into Geopandas With the data in a csv file, I am ready to make the <code>GeoDataFrame</code>. First I’ll import the libraries I’ll be using in this section:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd </span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> geopandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gpd </span>
<span id="cb7-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> contextily <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> ctx</span>
<span id="cb7-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb7-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb7-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.nonparametric.smoothers_lowess <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> lowess</span>
<span id="cb7-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shapely <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LineString</span></code></pre></div>
<p>I’ll use pandas to import the <code>csv</code> file to a pandas <code>DataFrame</code>:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">trek_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data.csv'</span>)</span>
<span id="cb8-2">trek_df.iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span></code></pre></div>
<pre><code>Id                    wo-2024-09-05
Lat                       41.043858
Lon                      -74.063712
Elev                             79
Time       2024-09-05T15:25:13.004Z
Temp                          20.51
Weather                           0
Name: 0, dtype: object</code></pre>
<p>Then I’ll create a GeoPandas <code>GeoDataFrame</code> using the lat/lon coordinates and an appropriate coordinate reference:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">trek_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gpd.GeoDataFrame( </span>
<span id="cb10-2">    trek_df, </span>
<span id="cb10-3">    geometry<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gpd.points_from_xy(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trek_df.Lon, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trek_df.Lat)</span>
<span id="cb10-4">).set_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4269</span>)</span>
<span id="cb10-5">trek_gdf.info()</span></code></pre></div>
<pre><code>&lt;class 'geopandas.geodataframe.GeoDataFrame'&gt;
RangeIndex: 650 entries, 0 to 649
Data columns (total 8 columns):
 #   Column    Non-Null Count  Dtype   
---  ------    --------------  -----   
 0   Id        650 non-null    object  
 1   Lat       650 non-null    float64 
 2   Lon       650 non-null    float64 
 3   Elev      650 non-null    int64   
 4   Time      650 non-null    object  
 5   Temp      650 non-null    float64 
 6   Weather   650 non-null    int64   
 7   geometry  650 non-null    geometry
dtypes: float64(3), geometry(1), int64(2), object(2)
memory usage: 40.8+ KB</code></pre>
<p>That looks good, with no null values. The <code>Time</code> should be a <code>datetime</code> type, so I’ll go ahead and change that:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">trek_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(trek_gdf.Time)</span></code></pre></div>
<p>OK, let’s make the first map. I’ll use <code>matplotlib</code> together which <code>contextily</code>, a library which provides a wide variety of base maps with ease:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb13-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> contextily <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> ctx</span>
<span id="cb13-3"></span>
<span id="cb13-4">f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb13-5">trek_gdf.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>) </span>
<span id="cb13-6">ctx.add_basemap(ax, crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trek_gdf.crs, source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ctx.providers.OpenStreetMap.Mapnik)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/gpx-gps-data/pr3.png" class="img-fluid"></p>
<p>Sweet. In order to do calculations, however, I’ll need to project the data to a crs appropriate for the location, which is New Jersey. A quick visit to <code>epsg.io</code> suggests <code>EPSG:32111</code>, so I’ll use that. It’s in meters, not feet, which I personally prefer anyway.:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">trek_proj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> trek_gdf.to_crs(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32111</span>)</span>
<span id="cb14-2">f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb14-3">trek_proj.plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>) </span>
<span id="cb14-4">ctx.add_basemap(ax, crs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trek_proj.crs, source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ctx.providers.CartoDB.Voyager)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/gpx-gps-data/pr4.png" class="img-fluid"></p>
</section>
<section id="elevations" class="level1">
<h1>Elevations</h1>
<p>Let’s profile the elevations for the walk. First, some basic statistics:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">line <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LineString(trek_proj.geometry)</span>
<span id="cb15-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'''</span></span>
<span id="cb15-3"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    The walk was </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>line<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> kilometers</span></span>
<span id="cb15-4"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Elevations: </span></span>
<span id="cb15-5"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Initial:   </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>trek_proj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Elev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> meters </span></span>
<span id="cb15-6"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Final:     </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>trek_proj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>iloc[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Elev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> meters </span></span>
<span id="cb15-7"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Highest:   </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>trek_proj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Elev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> meters </span></span>
<span id="cb15-8"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Lowest:    </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>trek_proj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Elev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> meters </span></span>
<span id="cb15-9"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'''</span>)</span></code></pre></div>
<pre><code>    The walk was 7.0 kilometers
    Elevations: 
        Initial:   79 meters 
        Final:     22 meters 
        Highest:   81 meters 
        Lowest:    11 meters</code></pre>
<p>And a basic plot:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">f, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb17-2">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> trek_proj.Elev.plot()</span>
<span id="cb17-3">ax.set_title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'''</span></span>
<span id="cb17-4"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Elevation profile for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>trek_gdf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Name[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> on </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>trek_gdf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Time[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%x</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb17-5"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    '''</span>)</span>
<span id="cb17-6">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'meters'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/gpx-gps-data/pr5.png" class="img-fluid"></p>
<p>Using Seaborn, I can use regression to smooth this out as much or as little as I want:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">sns.set_theme()</span>
<span id="cb18-2">plot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sns.lmplot(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trek_proj, x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Point'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Elev'</span>, </span>
<span id="cb18-3">           order<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, truncate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, aspect<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb18-4">plot.figure.subplots_adjust(top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.11</span>)</span>
<span id="cb18-5">plot.fig.suptitle(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'''</span></span>
<span id="cb18-6"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Smoothed profile for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>trek_gdf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Name[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> on </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>trek_gdf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Time[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%x</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-7"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    '''</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/gpx-gps-data/pr6.png" class="img-fluid"></p>
<p>And here’s smoothing with <code>lowess</code>:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">sns.set_theme(rc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'figure.figsize'</span>:(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)})</span>
<span id="cb19-2">plot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sns.lmplot(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trek_proj, x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Point'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Elev'</span>, </span>
<span id="cb19-3">                  lowess<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, truncate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, aspect<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb19-4">plot.figure.subplots_adjust(top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.11</span>)</span>
<span id="cb19-5">plot.fig.suptitle(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'''</span></span>
<span id="cb19-6"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Lowess smoothed profile for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>trek_gdf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Name[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> on </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>trek_gdf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Time[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%x</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb19-7"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    '''</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p><img src="https://biscotty.online/posts/data-science/python-gpx-mapping/gpx-gps-data/pr7.png" class="img-fluid"></p>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>I naturally want to be able to make calculations of speed and distance, identify pauses, and do other exploration. Starting from discrete points, the steps to do so manually would be simple but exceedingly tedious. Fortunately there is a wonderful library called <code>movingpandas</code> which makes these things all very simple. I’ll explore that in the next articles.</p>
<p>I’ll go ahead and save the <code>GeoDataFrames</code> for future use:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">trek_gdf.to_file(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data/trek_gdf.gpkg'</span>, driver<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GPKG'</span>)</span>
<span id="cb20-2">trek_projected.to_file(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data/trek_projected.gpkg'</span>, driver<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GPKG'</span>)</span></code></pre></div>
</section>
</section>
<section id="code" class="level1">
<h1>Code</h1>
<p>The code for this article is available in my <a href="https://github.com/biscotty666/GPX">Github Repository</a> in the form of a Jupyter notebook. Here is the final script for batch processing the files:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">'''</span></span>
<span id="cb21-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Convert a directory of gpx files to csv.</span></span>
<span id="cb21-3"></span>
<span id="cb21-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">The script captures trek points with coordinates,</span></span>
<span id="cb21-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">elevation and time stamp as well as trek name and </span></span>
<span id="cb21-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">weather conditions.</span></span>
<span id="cb21-7"></span>
<span id="cb21-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">The script requires an input directory path.</span></span>
<span id="cb21-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">'''</span></span>
<span id="cb21-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> bs4 <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BeautifulSoup</span>
<span id="cb21-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> csv</span>
<span id="cb21-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> sys</span>
<span id="cb21-13"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pathlib</span>
<span id="cb21-14"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb21-15"></span>
<span id="cb21-16"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(sys.argv) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>:</span>
<span id="cb21-17">    sys.exit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Must supply an input directory"</span>)</span>
<span id="cb21-18">inPath <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sys.argv[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb21-19"></span>
<span id="cb21-20">files <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [os.path.join(inPath, f) </span>
<span id="cb21-21">         <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> os.listdir(inPath) </span>
<span id="cb21-22">         <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> f.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".gpx"</span>)]</span>
<span id="cb21-23">cfile <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(os.path.join(inPath, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'combined.csv'</span>))</span>
<span id="cb21-24"></span>
<span id="cb21-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(cfile, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'w'</span>, newline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb21-26">    writer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> csv.writer(f)</span>
<span id="cb21-27">    writer.writerow([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Id'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lat'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lon'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Elev'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time'</span>,</span>
<span id="cb21-28">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Temp'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Weather'</span>])</span>
<span id="cb21-29"></span>
<span id="cb21-30"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> gpx_file <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> files:</span>
<span id="cb21-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(gpx_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb21-32">       contents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb21-33"></span>
<span id="cb21-34">    soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(contents, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'xml'</span>)</span>
<span id="cb21-35"></span>
<span id="cb21-36">    tracks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trkpt'</span>)</span>
<span id="cb21-37">    elevations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ele'</span>)</span>
<span id="cb21-38">    times <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'time'</span>)</span>
<span id="cb21-39">    temp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s2t:temperature'</span>).text</span>
<span id="cb21-40">    weather <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s2t:weather'</span>).text</span>
<span id="cb21-41">    name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>).text</span>
<span id="cb21-42">    sf_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>  os.path.splitext(gpx_file)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb21-43">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.split(sf_name)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb21-44">    csv_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sf_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.csv'</span></span>
<span id="cb21-45">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb21-46"></span>
<span id="cb21-47">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> track, elevation, time <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(tracks, elevations, times):</span>
<span id="cb21-48">        latitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> track[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lat'</span>]</span>
<span id="cb21-49">        longitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> track[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lon'</span>]</span>
<span id="cb21-50">        elevation_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> elevation.text</span>
<span id="cb21-51">        time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.text</span>
<span id="cb21-52">        data.append([<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>, latitude, longitude, elevation_value,</span>
<span id="cb21-53">                    time, temp, weather])</span>
<span id="cb21-54"></span>
<span id="cb21-55">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(csv_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'w'</span>, newline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> csvfile:</span>
<span id="cb21-56">        writer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> csv.writer(csvfile)</span>
<span id="cb21-57">        writer.writerow([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Id'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lat'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lon'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Elev'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time'</span>,</span>
<span id="cb21-58">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Temp'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Weather'</span>])</span>
<span id="cb21-59">        writer.writerows(data)</span>
<span id="cb21-60"></span>
<span id="cb21-61">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(cfile, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>, newline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb21-62">        writer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> csv.writer(f)</span>
<span id="cb21-63">        writer.writerows(data)</span></code></pre></div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{carey2024,
  author = {Carey, Brian},
  title = {Trail {Mapping} with {Python}},
  date = {2024-02-28},
  url = {https://biscotty666.github.io/biscottys-workshop/2024-02-28-trail-mapping-with-python},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-carey2024" class="csl-entry quarto-appendix-citeas">
Carey, Brian. 2024. <span>“Trail Mapping with Python.”</span> February
28, 2024. <a href="https://biscotty666.github.io/biscottys-workshop/2024-02-28-trail-mapping-with-python">https://biscotty666.github.io/biscottys-workshop/2024-02-28-trail-mapping-with-python</a>.
</div></div></section></div> ]]></description>
  <category>GIS</category>
  <category>Python</category>
  <category>Data Science</category>
  <guid>https://biscotty.online/posts/data-science/python-gpx-mapping/gpx-gps-data/</guid>
  <pubDate>Wed, 28 Feb 2024 07:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/data-science/python-gpx-mapping/gpx-gps-data/pr2.png" medium="image" type="image/png" height="93" width="144"/>
</item>
<item>
  <title>Obsidian Canvas Work Spaces</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/obsidian-whiteboards/</link>
  <description><![CDATA[ 






<section id="obsidian-canvas-work-spaces" class="level1">
<h1>Obsidian Canvas Work Spaces</h1>
<blockquote class="blockquote">
<p>Visual MOCery <img src="https://biscotty.online/posts/obsidian/obsidian-whiteboards/VMocery.png" class="img-fluid"></p>
</blockquote>
<section id="organization-and-productivity" class="level2">
<h2 class="anchored" data-anchor-id="organization-and-productivity">Organization and Productivity</h2>
<p>My <a href="http://biscotty.online/blogs/freeing-your-thinking-part-1">Freeing Your Thinking</a> series of articles has had a primary theme: focus on information, not files. My first articles explained how time spent organizing files into folders and naming fleeting notes is essentially wasted time. Worse, maintaining such a system is a daily drain on productivity. Even worse, you will probably decide one day that a different structure is better and, to re-arrange everything, you need to invest yet more time. And what if you want a different structure, but still maintain the current structure at the same time? You can’t do that with folders, but you can with bookmarks. With bookmarks you can build a tree of the <em>information</em>, regardless of files and file locations. Specific information is not limited to one location.</p>
<p>The point of this system is to be as productive as possible. Organization is a tool, not a goal, and should only be used if it adds value (increases productivity). I want to avoid the loss of focus and efficiency entailed in opening files and switching between notes. Time spent organizing and working with files is inefficient given the many options available in Obsidian. Time spent organizing and working with information, on the other hand, is what it’s all about.</p>
<p>In this article I’ll look at the popular Map of Content and consider it’s virtues with respect to productivity. At least as I have seen it described, I find it an unwieldy tool for working with the information in my vault. It is inefficient, steals focus, and does not promote creativity. I will propose an approach based on Canvas. With Canvas, I can construct a rich work environment for developing my knowledge on a subject, with information displayed and structured visually. From my canvas I have direct access to all of the files implicated, and don’t need to leave the canvas to review or edit them. Tasks, goals, questions, even the narrative, are on the canvas. I will post a link at the end to my repository with this example vault.</p>
</section>
<section id="maps-of-content" class="level2">
<h2 class="anchored" data-anchor-id="maps-of-content">Maps of Content</h2>
<p>The map of content is a common way of organizing notes in an Obsidian vault. The concept is flexible, and can be applied to many sorts of notes, the simplest being a note with an index-like list of links to all of the notes relating to a topic of interest. If you have been working with Freeing Your Thinking, you might have noticed the red flag in this concept: the note itself. Creating a document consisting solely or primarily of links to other documents is file-based thinking. In fact, in this system, you get such a list for free, without effort, as you will see below. Actually, there are three ways to find and access all information on the topic of interest, without creating such a list. And I do not mean with a Dataview query in a note. So making such a note is a waste of time.</p>
<p>All of my notes have a <code>topic</code> property. This takes one or more links. The <code>topic</code> does not need to exist when assigned to a note. I have notes with a type of <code>moc</code>, but they are empty of content, only containing metadata, a topic and a type. In a NoSQL database, such documents containing only metadata are merely nodes which tie the data together. Their purpose is not to hold information per se. As a result, when I finally create the actual file, I get an index for free (three actually), with the ability to inspect all of the information without opening the files.</p>
<p>Specifically, in the right sidebar I have all of the links, as well as a graph. On the left, a simple filter gives me the same information. And I rarely need to open any of these files, since I can view and edit them directly with Hover Editor.</p>
<iframe src="https://streamable.com/e/eu4pfl?autoplay=1" width="560" height="315" frameborder="0" allowfullscreen="" allow="autoplay">
</iframe>
<p>From a simple index, the next step is often to give structure to the notes, typically in a table of contents format. This process usually involves opening and reading, perhaps editing, the notes and placing them in an appropriate “location” in the MOC note. Again, this is file-based thinking. As explained before, bookmarks provide this type of organization more effectively, flexibly, and efficiently.</p>
</section>
<section id="work-spaces" class="level2">
<h2 class="anchored" data-anchor-id="work-spaces">Work Spaces</h2>
<p>Creating a traditional Map of Content does not really get you much closer to your information. The notes may be well organized, but they remain essentially closed books. And, in the format of a note, assimilation of the larger picture of a topic is difficult, and relationships are hard to visualize. Using Canvas, on the other hand, I can create a work space for each topic I’m interested in. As mentioned, the work space contains all of the reference material side by side with questions, ideas, tasks and a working document. And the canvas contains a white board where all of the information is exposed and organized.</p>
<p>This canvas-based approach to content mapping well satisfies my two criteria for evaluating a process. It maximizes my ability to focus on the information without distraction, and it is efficient as I rarely if ever, need to leave the canvas. No opening and closing of files, or remembering file names and locations.</p>
<section id="desk-area" class="level3">
<h3 class="anchored" data-anchor-id="desk-area">Desk Area</h3>
<p>At the top of the work space I have my desk area. Here I put my goals for the topic and guiding questions, as well as any tasks related to the topic. This is also where I have my developing narrative on the topic. This long form document describes the topic and may result in an essay or article…the result of my efforts pursuing the subject and a statement of my understanding.</p>
<p>The tasks are all in a file accessible in The Stacks, which I will show in a minute. Questions and goals are actually tasks, too. At the top are queries of the form</p>
<pre><code>filename includes Occitan Tasks
filter by function task.status.symbol === '!'</code></pre>
<p>Tasks may be edited directly from the queries without opening the containing file.</p>
<p>Removing extraneous information allows the eyes to focus with less effort on the meaningful information, so I have used CSS to hide the links that would normally be displayed next to the task description. This brief video shows the features of the desk area.</p>
<iframe src="https://streamable.com/e/wmvemo?autoplay=1" width="560" height="315" frameborder="0" allowfullscreen="" allow="autoplay">
</iframe>
</section>
<section id="the-stacks" class="level3">
<h3 class="anchored" data-anchor-id="the-stacks">The Stacks</h3>
<p>On the left is my reference area. Here I have various queries allowing me to process files directly from the workspace. Canvas is nice, because I can “roll up” these views and only expand them when I need them. All notes on the topic of Occitan are grouped into fleeting notes, processed notes, and actionable notes (I have an <code>action</code> property.) They are primarily used to discover information to add to the canvas.</p>
<p>This, for example, is the “Fleeting Notes” query:</p>
<pre class="dataview"><code>list
where contains(topic, [[Occitan]]) &amp; contains(type, "fleeting")</code></pre>
<p>Here is also found the Task Master, which is the note containing the tasks related to the topic. The questions, goals and tasks displayed at the top come from this note. Once a task has been added, any further editing is done directly from the views at the top of the canvas.</p>
<p>In addition, I have queries which list all of the <strong>content</strong> of all of the notes on the Occitan topic which I can scroll through. This is a very fast way to browse all my information. Most interesting, perhaps, is the view of the content of all notes which mention Occitan but are NOT linked to the MOC.</p>
<p>The query to produce this is more involved than the others. However, if you have followed along with the DataviewJS articles, most of this should be familiar. We do have a few new functions. <code>dv.io.load()</code> returns the full contents of each file. <code>split(\n\n)</code> then divides the content into blocks. (<code>\n</code> refers to a new line, and since paragraphs are separated by blank lines that gives two <code>\n</code>s.) Then <code>filter()</code> returns only the paragraphs containing the word Occitan. Taken step by step the code should be clear.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> pagesWithTopic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">await</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Promise</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(</span>
<span id="cb3-2">    dv</span>
<span id="cb3-3">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-[[Occitan]]"</span>)</span>
<span id="cb3-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occitan Unlinked References"</span>)</span>
<span id="cb3-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occitan Tasks"</span>)</span>
<span id="cb3-6">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(n <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Promise</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">async</span> (resolve<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> reject) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb3-7">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> content <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">await</span> dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">io</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load</span>(n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">path</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-8">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resolve</span>({</span>
<span id="cb3-9">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">link</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-10">            content</span>
<span id="cb3-11">        })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-12">    }))</span>
<span id="cb3-13">)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-14"></span>
<span id="cb3-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> blocksWithTopic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pagesWithTopic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(({</span>
<span id="cb3-16">    link<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-17">    content</span>
<span id="cb3-18">}) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> ({</span>
<span id="cb3-19">    link<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-20">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">content</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> content</span>
<span id="cb3-21">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb3-22">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(content <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">includes</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Occitan'</span>))</span>
<span id="cb3-23">}))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-24"></span>
<span id="cb3-25">blocksWithTopic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>(</span>
<span id="cb3-26">    page <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span></span>
<span id="cb3-27">    page<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">content</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>(</span>
<span id="cb3-28">        n <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paragraph</span>(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>page<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">)</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n\n</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>n<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;"> `</span>)</span>
<span id="cb3-29">    )</span>
<span id="cb3-30">)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<iframe src="https://streamable.com/e/j3zzlg?autoplay=1" width="560" height="315" frameborder="0" allowfullscreen="" allow="autoplay">
</iframe>
</section>
<section id="whiteboard" class="level3">
<h3 class="anchored" data-anchor-id="whiteboard">Whiteboard</h3>
<p>At some point in every crime procedural television show they wheel out the white boards and start pinning up information, making annotations and drawing links. Items of interest are removed from their file and put up in plain site, with the information clearly exposed. There are all of the photographs, news clippings, maps and highlighted sections of documents, supplemented with commentary and lines connecting the information. The important thing here is that relevant information is clearly displayed, and no effort is needed to view it. Information is grouped visually with connections between specific information indicated by the lines.</p>
<p>The investigators make these boards because they provide a useful way to explore a subject, ask and answer questions, identify gaps in knowledge, and ultimately construct a narrative around the information. Obsidian’s Canvas allows me to do exactly the same thing, exposing my information and allowing me to arrange and re-arrange it as I work through it in my mind. As I add to the canvas, I can easily add the views to my information tree as well, giving logical structure to the visual structure.</p>
<p>Here is an overview of my workspace for the topic of the Occitan language, one I am only starting to explore.</p>
<iframe src="https://streamable.com/e/9eytfl?autoplay=1" width="560" height="315" frameborder="0" allowfullscreen="" allow="autoplay">
</iframe>
</section>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h2>
<p>Obsidian is a powerful tool, but the functionality it offers is often overlooked and/or underused. Rather than treating it as essentially a file editor and approaching it the way one would a word processor, think of it as both an information repository and a collection of tools to access and develop the information. Views on a canvas are much more intellectually stimulating than links, or even embeds, in a file.</p>
<p>The contents used for this article are available for download from my <a href="https://github.com/biscotty666/Obsidian-Canvas-Workspaces">GitHub</a>. If you find this content useful, please consider <a href="https://www.paypal.com/donate/?business=3Y2MGAU7LYQBJ&amp;no_recurring=0&amp;item_name=I+you+have+found+my+content+useful+please+consider+a+donation+to+support+future+work.&amp;currency_code=USD">making a donation</a> to support future work.</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Obsidian</category>
  <guid>https://biscotty.online/posts/obsidian/obsidian-whiteboards/</guid>
  <pubDate>Sat, 20 Jan 2024 07:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/obsidian-whiteboards/VMocery.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Git and GitHub for Obsidian Users</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/git-github-obsidian/</link>
  <description><![CDATA[ 






<section id="git-and-github-for-obsidian-users" class="level1">
<h1>Git and GitHub for Obsidian Users</h1>
<p>I’ve been doing some repair work around my house recently and have been reflecting on how important the choice of tools are in making a project go quickly and smoothly. More specifically, I’ve been thinking about how important it is to choose a tool designed for a specific purpose rather than a general purpose one. For example, while you can screw a nut on a bolt with vise grips, you’re much better off using ratchet wrench which is designed for that specific purpose. It is faster, easier, and less likely to do damage to the nut.</p>
<p>I’ve been seeing quite a few articles about git and GitHub in the context of backups and synchronization. In this article I would like to explain exactly what they are and why they are not good tools to use for backing up or synchronizing an Obsidian vault. I will then propose best-of-class solutions for these needs. At the end, I will show how git and GitHub can, in fact, be useful for some special purposes. ## Git</p>
<p>Git is a version control system designed for collaborative software development. Using git, developers are able to manage a project’s code base throughout development cycles, allowing multiple authors to contribute code to a single project, everyone keeping up to date with the latest version. It allows for maintaining separate branches for production and development, branches for features, and branches for each developer. The various branches can be <em>merged</em> as they are completed, and thereby update the production or main development branch.</p>
<p>If you are wondering how any of this relates to Obsidian, which is not a software development project and does not typically have multiple contributors, well, it doesn’t, which is kind of my point. It’s a vice grips solution for Obsidian.</p>
<p>Its design is clever, though, and worth taking a moment to understand. The information generated by git is stored in a <em>repository</em>. A repository is simply a hidden directory created in the main directory of your project, or in this case, your vault. The repository itself keeps track of <em>commits</em>. A commit is a file which describes exactly what files have been added, removed, or edited since the last commit. In the case of edits, it keeps track of the specific changes made to each file by tracking changes to each line. The changes are combined with information such as the author of the change and a description of what was changed, and this becomes a new commit. The granularity allows for identifying specific lines which introduced bugs. They can then “re-set” the project to the prior, bug-free state while someone fixes the bug, or to a point where a deleted file still existed.</p>
<p>Before moving on, I will just point out that the git repository has nothing to do with GitHub. It’s just a hidden directory on your local file system.</p>
<section id="github" class="level2">
<h2 class="anchored" data-anchor-id="github">GitHub</h2>
<p>At it’s core, GitHub is service like Dropbox which provides cloud storage. But there are important differences. It was specifically created to promote sharing of code and collaboration among software developers. As such, you can have as many free <strong>public</strong> repositories as you want, but need to pay for private ones. A limitation of GitHub is file size. There is a maximum size of 100 MB per file. This is not a problem for most people, but should you have any videos in your vault, for example, you will not be able to use GitHub at all. In any case, unless you need tools provided by GitHub, you might just as well copy your directory, or your local git repository, to Dropbox instead of pushing to GitHub.</p>
<p>In addition to storage, GitHub provides a whole suite of tools which developers can use to design automated workflows and even deploy projects directly from GitHub. None of this really applies to Obsidian either, with potential exceptions which I’ll describe below.</p>
</section>
<section id="synchronization" class="level2">
<h2 class="anchored" data-anchor-id="synchronization">Synchronization</h2>
<p>As we have seen, GitHub is designed for keeping multiple developers and project branches in sync, so it might seem to appropriate for keeping Obsidian vaults in sync. But, since there is only one author and only one branch, it is overkill at the very least. A developer pulls to see what <em>others</em> have done and pushes to share their work…neither relevant for Obsidian.</p>
<p>But my main objection is practical. Using GitHub requires manual interactions be performed every time you switch devices, namely a pull and a push to GitHub. Ideally, synchronization across devices should be automatic, instantaneous and real time. I wrote an article on synchronizing your vault across different devices using a tool called Syncthing. It is a free, fit for purpose tool which uses direct, device-to-device synchronization, requiring no intervention, and changes are immediately reflected across all devices. ## Backups Be honest: do you back up your computer regularly? If you are like the majority of people the answer is no. Given the number of articles I’ve seen on solutions for backing up vaults I can only conclude that many Obsidian users, like others, don’t have a regular backup system, because, if you are backing up your computer, you are backing up your vault. Obsidian is just another directory, and doesn’t need anything special. If you already perform regular backups, and have tested file recovery, then you don’t need to read the next bit…unless you are using GitHub for your backups.</p>
<p>To understand why GitHub should not be used to back up your vault, consider the main features required for a good backup system:</p>
<ul>
<li><p>Ease of recovery - even people who actually do backups often do not test how quickly and easily it is to restore files from the backups. Ideally, you should be able to navigate through backed up files and directories just like ordinary ones, and then simply copy what you want. Recovering lost or old versions of files is possible using git, but the process is much more cumbersome.</p></li>
<li><p>Rotation of daily, weekly, monthly backups - a good backup system will automatically rotate your backups, removing unnecessary versions as they age and new ones are made. That way you can find something from two days, two weeks, two months or two years ago. Git provide no such functionality.</p></li>
<li><p>Speed and Space efficiency - over time, the amount of data you need to back up can be many gigabytes, especially if you have videos or many images. When you do a backup, the tool must check for changes across the entire directory, so it needs to be fast. At any point, you will have dozens of backups each representing a snapshot in time. In order to maintain so many “copies”, the system must be efficient in compressing the information. With git and GitHub there is no compression except for during file transfer.</p></li>
<li><p>Off-site backups - Best practice for backups means storing at least one copy of your backups in a different physical location. This could be a cloud server. A good tool should make off-site backups just as easy as on-site backups. GitHub does fulfill this requirement.</p></li>
</ul>
<p>The best backup system around is called Restic. It is free, open source, cross-platform, and can be easily managed with a few simple commands. Most importantly, it is blazing fast, and creates surprisingly small repositories. This is basically because it breaks up your files into variable-length <em>blobs</em>, or chunks of bytes. I will explain the details in a subsequent article. ## Sharing - use cases for git and GitHub</p>
<p>I have found some very good use cases for git and GitHub. They involve sharing content of my vault. Before describing them, let me point out that sharing of vault content should generally only be one way. Obsidian is not meant to be a collaborative tool. So you, and only you, control what goes into your vault.</p>
<section id="presentation" class="level3">
<h3 class="anchored" data-anchor-id="presentation">Presentation</h3>
<p>Git, and especially GitHub itself, are convenient for creating live, interactive presentations from content in my vault. I can create a formal presentation using the Advanced Slides plugin, or just make a section of my vault with specific content and put that part on GitHub. GitHub allows others to browse the vault or view the presentation on-line. Alternatively, they can download the content, open it locally with Obsidian, or simply copy it into their own vault.</p>
<p>In the context of a presentation, git itself is useful, because a presentation is a product. Like any product, version control is useful. A presentation can change and evolve. Sometimes one wants to see something from a prior iteration of a project, and git makes this simple. In other words, presentations have versions.</p>
<p>I’ll give some tips on the mechanics of how to do this at the end, but it’s simply a matter of collecting all the necessary files, including attachments, in a sub-directory of my vault. I copy this directory to a different location, open it as a vault and enable necessary plugins. GitHub can directly serve HTML files, so I convert the entire new vault to HTML with the Webpage HTML Export plugin. I create a <code>README.md</code> with some sort of linked table of contents or at least a link to enter the html files. With that done, I can just push to GitHub, and everything goes live in minutes on a url GitHub creates for me.</p>
<p>At this point I can make the presentation and the the audience can follow along on their own computers and engage with the content, either on-line or locally by downloading the vault from GitHub. If they happen to be Obsidian users, they could also copy the files into their own vault to further interact with the material.</p>
</section>
<section id="class-management" class="level3">
<h3 class="anchored" data-anchor-id="class-management">Class Management</h3>
<p>As a teacher, it didn’t take long to consider how Obsidian might be used in the classroom. The idea of making and distributing course content which is easily navigable, visually interesting, and incorporates multi-media, graphs and charts, and external resources is very attractive. Sharing of content can be done the same way as the presentation above, and students could get it either “live” or by making their own copy.</p>
<p>But, as I do go on about, Obsidian is a database too, so why not push this a step further, and run the whole course with Obsidian, including design, distribution of materials, receiving assignments from students, applying rubrics if appropriate, grading and evaluations. This sounds like a project, and git and GitHub are perfect for this use. In addition to facilitating the distribution of the course materials, you can update the materials from time to time, and students will always have access to the latest version. I segregate the course into a <code>public/</code> and <code>private/</code> directory, and only push <code>public/</code> to GitHub. All completed work, grades, evaluations, and any identifying material is kept confidential. Students can submit their responses by emailing the single note, which I simply place in the <code>private/</code> directory. The Properties take care of everything else (except the actual grading).</p>
<p>This is obviously a more complex example, involving metadata (properties), Dataview, and various templates to provide the metadata and compile grades. A full description would take too long for this article, but I intend to write a detailed article with a sample vault in the near future.</p>
</section>
</section>
<section id="usage-of-git-and-github" class="level2">
<h2 class="anchored" data-anchor-id="usage-of-git-and-github">Usage of git and GitHub</h2>
<p>This article is already long, so I can’t go into details about using git and GitHub, but I want to show how simple it is for this purpose. You need to install git itself, and I use another program called <em>gh</em> (the GitHub Client), which allows me to manage everything from the command line. With these installed and a free GitHub account, all I need to do is create the repository locally with the command <code>git init</code>. I then create the repository on GitHub itself with</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gh</span> repo create my-vault-name <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--public</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--source</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>. <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--remote</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>upstream<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span></code></pre></div>
<p>After that, whenever I add, delete or change content, I just do</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Some message"</span></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push</span></code></pre></div>
<p>On the GitHub website, under the Settings menu there is a Pages option. Simply go there and you can deploy your vault (with HTML rendered) with a couple of clicks. It will provide you with a live URL, where the content will be kept up to date every time you <code>push</code>.</p>
<p>That’s all there is to it.</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Obsidian</category>
  <category>Linux</category>
  <guid>https://biscotty.online/posts/obsidian/git-github-obsidian/</guid>
  <pubDate>Fri, 19 Jan 2024 07:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/git-github-obsidian/tn-metadata-menu.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Summarizing Information with DataviewJS</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/dataview/dataviewjs-interactive-dynamic-tables/</link>
  <description><![CDATA[ 






<section id="summarizing-information-with-dataviewjs" class="level1">
<h1>Summarizing Information with DataviewJS</h1>
<p><img src="https://biscotty.online/posts/obsidian/dataview/dataviewjs-interactive-dynamic-tables/djs-db-exc.png" class="img-fluid"></p>
<p>This article follows up on <a href="https://biscotty.online/blogs/gentle-introduction-to-dataviewjs">earlier articles</a> in which I showed how to create interactive tables which are automatically updated and can be edited directly in the table. This article will describe how to create summary statistics for data. The statistics on the dashboard update based on the current day.</p>
<p>As you can see, I’ve done a bit of rearranging since the last article to make things even more readable. The statistics tables have been re-sized and reformatted for a cleaner display, and I’ve added more information. There are still some tweaks I want to do, but this is a very useful dashboard.</p>
<p>A quick comment on canvases: since I started working on canvases it’s hard to go back to the 80 characters wide format of a note. Sure, when I’m writing an article or focusing on a bit of code, that format feels very natural. But when doing pretty much anything else, well, it’s just nice to be able to spread out, and not have to open and close files, or page up and down through documents. Using a canvas is like putting all of your current work on your desk, with everything open to the pages you are interested in. In a future article I will show how a dashboard can be used in place of a Daily Note to manage your day.</p>
<p>Here is the table I will show how to create in this article. As before, you can just skip to the bottom and grab the code if you want. This article explains everything rather thoroughly and introduces some general programming concepts. I think that, if you spend a little time with the material you will find that it is not, as they say, rocket science.</p>
<p><img src="https://biscotty.online/posts/obsidian/dataview/dataviewjs-interactive-dynamic-tables/djs-db-stats.png" class="img-fluid"></p>
<p>That’s 22 numbers to calculate! The process isn’t too complicated, but we need to keep track of a lot of things. To avoid a lot of repetition, we will create some custom functions, and you need to learn how to “push” lists into lists.</p>
<p>Let’s start by writing down what we need to do.</p>
<ul>
<li>Create the data sets
<ul>
<li>Get the logs for current and prior periods</li>
<li>Separate by activity</li>
</ul></li>
<li>Make a variable and calculate each statistic for current and prior periods
<ul>
<li>distance for each activity and total (6 total)</li>
<li>duration for each activity and total (6 total)</li>
<li>speed for each activity (4 total)</li>
<li>counts for each activity (6 total)</li>
</ul></li>
<li>Generate the output
<ul>
<li>Create the tables’ headers</li>
<li>Generate the table rows</li>
<li>Create headers for the with workout totals</li>
<li>Display the tables with header elements</li>
</ul></li>
</ul>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The data</h2>
<p>First, let’s grab the data for the current and prior seven day periods. In the last article I showed how to get the current period. Did you figure out how to get the prior period? One way is to first take the data from the last 14 days, and then remove the most recent 7 days. So we’ll do it like this:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> priorPages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pages</span>() </span>
<span id="cb1-2">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>)</span>
<span id="cb1-3">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subtract</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"days"</span>))</span>
<span id="cb1-4">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subtract</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"days"</span>)) </span></code></pre></div>
<p>Create the <code>currentPages</code> data set as well. Then each needs to be separated by walking and biking. You can do it like this:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentWalkPages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> currentPages</span>
<span id="cb2-2">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Activity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚶"</span>)</span></code></pre></div>
<p>Go ahead and create the rest of the datasets. You need <code>currentBikePages</code>, <code>priorWalkPages</code> and <code>priorBikePages</code>.</p>
</section>
<section id="calculations" class="level2">
<h2 class="anchored" data-anchor-id="calculations">Calculations</h2>
<p>Good programming involves avoiding repetitive tasks. Whenever you need to do the same thing more than once or twice, the standard practice is to make a function.</p>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<p>Here is an example of a function we can use. It is arguably overkill to make this a function, but it will provide a good example. A function starts with the keyword <code>function</code> followed by the name you want to use. The name is followed by parentheses which are required, but may be empty. They are used to pass arguments to the function. The function itself is then placed in curly braces. After the function does it’s work, it needs to <code>return</code> some value.</p>
<p>I have a bunch of numbers in minutes which I want to convert to hours. This is just a matter of dividing by 60 of course, but I also want to round off to one decimal. There is a function <code>toFixed()</code> which can be used on strings. It takes one argument, the number of decimal places you want to round it to. This is the function:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toHours</span> (time) {</span>
<span id="cb3-2"> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-3">}</span></code></pre></div>
<p>and I use it like this.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalCurrentTime <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toHours</span>( <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> pages) )</span></code></pre></div>
<p>Of course, I haven’t created <code>sumStat()</code> yet. To calculate the sum there is a JavaScript function called <code>reduce()</code>. It is used like this:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reduce</span>(</span>
<span id="cb5-2">    (sum<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Distance</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-3">     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-4">)</span></code></pre></div>
<p>The syntax looks a little complicated, but it’s not so bad if you break it down. <code>reduce()</code> takes two arguments. The first argument is <code>(sum, b) =&gt; sum + b.Distance</code>, which is itself a function with two arguments. The second argument here is our old friend <code>b</code>. In this case, we also need temporary variable called an <em>accumulator</em>. The name of this variable is arbitrary, like <code>b</code>. <code>reduce()</code> will go through each log, adding the value of the <code>Distance</code> field to the accumulator. The second argument to <code>reduce()</code> is just the initial value for the accumulator, which is almost always 0.</p>
<p>Now I can write the function like this</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span> (stat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> thePages) {</span>
<span id="cb6-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> pageValues <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> thePages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values</span></span>
<span id="cb6-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration"</span>) {</span>
<span id="cb6-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pageValues</span>
<span id="cb6-5">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reduce</span>((sum<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Duration</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-6">    }</span>
<span id="cb6-7">    </span>
<span id="cb6-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span>) {</span>
<span id="cb6-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pageValues</span>
<span id="cb6-10">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reduce</span>((sum<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Distance</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-11">    }</span>
<span id="cb6-12">}</span></code></pre></div>
<p>I didn’t want to write two separate functions for calculating the sums, instead I use a <em>conditional</em> <code>if</code> statement, which works as you might expect. Notice a few things about this. First, <code>pageValues</code> just saves us adding <code>.values</code> to each <code>if</code> statement. <code>if</code> statements require a condition in parentheses. It must be something that evaluates to a <em>boolean</em> value (true or false, remember). Then, as usual, the block of code you want to execute must be in curly braces. Finally, you almost always want to <code>return</code> something. Once you hit a <code>return</code> statement, nothing else gets executed in the function.</p>
</section>
<section id="maths" class="level3">
<h3 class="anchored" data-anchor-id="maths">Maths</h3>
<p>Now we can create all of our time and distance variables like this:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalCurrentTime <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toHours</span>( <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>( <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentPages ) )</span>
<span id="cb7-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalCurrentDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>( <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentPages )<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<p>Speed is just distance over time, so.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentWalkSpeed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb8-2">    totalCurrentWalkDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> totalCurrentWalkTime</span>
<span id="cb8-3">    )</span>
<span id="cb8-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<p>Notice that I specified to round to one decimal point. To find the total number of workouts it is necessary merely to count the number of pages in each category, since each represents one workout. <code>pages()</code> is a list, or array. Arrays all have an attribute/property called <code>length</code>. So to count all workouts in the last seven days I can just write <code>const currentCount = currentPages.length</code>.</p>
<p>Everything else is just repetition, since we need 22 values at the end of the day. Any repetitive activity cries out for a new function to encapsulate this repetition, but I’ll leave that for another day. (This is called <em>refactoring</em>.)</p>
</section>
</section>
<section id="generate-the-output" class="level2">
<h2 class="anchored" data-anchor-id="generate-the-output">Generate the output</h2>
<p>The tables from the last article used a <code>dv.pages()</code> object for the table rows. This time I need to create each table row myself. Each table row is itself a list. So I need a list of lists. It is easy to do this with the <code>push()</code> command, which just adds an item to a list. The item being added can be anything, including a list. I will build the table rows like this:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb9-2">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalCurrentDistance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalPriorDistance])</span></code></pre></div>
<p>I have to <em>initialize</em> the variable, because I can’t <code>push</code> anything onto a non-existent list. I used <code>let</code> instead of <code>const</code>. The difference is that a <code>const</code> variable cannot change after it has been created, while one declared with <code>var</code> can. (In older code you will see <code>var</code> instead of <code>let</code>. This still works but <code>let</code> is preferred.)</p>
<p>So all that remains is to <code>push</code> each row of the table into the <code>rows</code> variable, create the <code>headers</code> for the table, and use <code>dv.table()</code> to display it. The final code is at the bottom. I strongly suggest, having reached this point, that you try to do this on your own and don’t simply copy and paste my code.</p>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final thoughts</h2>
<p>If you read through both articles, congratulations. Give yourself a pat on the back. You are doing object-oriented programming in the most widely-used language on the internet. And you have all of the knowledge you need to create rich, useful dashboards.</p>
<p>Happy coding!</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* Create data sets  */</span></span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentPages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pages</span>() </span>
<span id="cb10-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>)</span>
<span id="cb10-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subtract</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"days"</span>))</span>
<span id="cb10-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> priorPages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pages</span>() </span>
<span id="cb10-7">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>)</span>
<span id="cb10-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subtract</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"days"</span>))</span>
<span id="cb10-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subtract</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"days"</span>)) </span>
<span id="cb10-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentWalkPages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> currentPages</span>
<span id="cb10-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Activity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚶"</span>)</span>
<span id="cb10-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentBikePages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> currentPages</span>
<span id="cb10-13">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Activity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚴"</span>)</span>
<span id="cb10-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> priorWalkPages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> priorPages</span>
<span id="cb10-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Activity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚶"</span>)</span>
<span id="cb10-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> priorBikePages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> priorPages</span>
<span id="cb10-17">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Activity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚴"</span>)</span>
<span id="cb10-18"></span>
<span id="cb10-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* Function to sum the distances, duration */</span></span>
<span id="cb10-20"></span>
<span id="cb10-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span> (stat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> thePages) {</span>
<span id="cb10-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> pageValues <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> thePages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values</span></span>
<span id="cb10-23">    </span>
<span id="cb10-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration"</span>) {</span>
<span id="cb10-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pageValues</span>
<span id="cb10-26">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reduce</span>((sum<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Duration</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb10-27">    }</span>
<span id="cb10-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span>) {</span>
<span id="cb10-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pageValues</span>
<span id="cb10-30">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reduce</span>((sum<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Distance</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb10-31">    }</span>
<span id="cb10-32">}</span>
<span id="cb10-33"></span>
<span id="cb10-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* Function to convert minutes to hours */</span></span>
<span id="cb10-35"></span>
<span id="cb10-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toHours</span> (time) {</span>
<span id="cb10-37"> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-38">}</span>
<span id="cb10-39"></span>
<span id="cb10-40"></span>
<span id="cb10-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* Calculate the distances (6 values) */</span></span>
<span id="cb10-42"></span>
<span id="cb10-43"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalCurrentDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>( <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentPages )<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-44"></span>
<span id="cb10-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalCurrentWalkDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>currentWalkPages)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalCurrentBikeDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentBikePages)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalPriorDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>priorPages)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalPriorWalkDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>priorWalkPages)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-49"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalPriorBikeDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>priorBikePages)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-50"></span>
<span id="cb10-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* Calculate the durations (6 values) */</span></span>
<span id="cb10-52"></span>
<span id="cb10-53"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalCurrentTime <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toHours</span>( <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>( <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentPages ) )</span>
<span id="cb10-54"></span>
<span id="cb10-55"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalCurrentWalkTime <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toHours</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>currentWalkPages))</span>
<span id="cb10-56"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalCurrentBikeTime <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toHours</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>currentBikePages))</span>
<span id="cb10-57"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalPriorTime <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toHours</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>priorPages))</span>
<span id="cb10-58"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalPriorWalkTime <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toHours</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>priorWalkPages))</span>
<span id="cb10-59"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> totalPriorBikeTime <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toHours</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sumStat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>priorBikePages))</span>
<span id="cb10-60"></span>
<span id="cb10-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* Calculate the speed (4 values) */</span></span>
<span id="cb10-62"></span>
<span id="cb10-63"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentWalkSpeed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (totalCurrentWalkDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> totalCurrentWalkTime)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-64"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> priorWalkSpeed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (totalPriorWalkDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> totalPriorWalkTime)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-65"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentBikeSpeed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (totalCurrentBikeDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> totalCurrentBikeTime)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-66"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> priorBikeSpeed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (totalPriorBikeDistance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> totalPriorBikeTime)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toFixed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-67"></span>
<span id="cb10-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* Count the workouts */</span></span>
<span id="cb10-69"></span>
<span id="cb10-70"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentCount <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> currentPages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length</span></span>
<span id="cb10-71"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> priorCount <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> priorPages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length</span></span>
<span id="cb10-72"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentBikeCount <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> currentBikePages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length</span></span>
<span id="cb10-73"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> priorBikeCount <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> priorBikePages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length</span></span>
<span id="cb10-74"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentWalkCount <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> currentWalkPages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length</span></span>
<span id="cb10-75"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> priorWalkCount <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> priorWalkPages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length</span></span>
<span id="cb10-76"></span>
<span id="cb10-77"></span>
<span id="cb10-78"></span>
<span id="cb10-79"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* Create an array (list) and add the table rows</span></span>
<span id="cb10-80"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">   The first table displays the distance and duration */</span></span>
<span id="cb10-81">   </span>
<span id="cb10-82"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb10-83">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miles"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalCurrentDistance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalPriorDistance])</span>
<span id="cb10-84">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚶"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalCurrentWalkDistance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalPriorWalkDistance])</span>
<span id="cb10-85">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚴"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalCurrentBikeDistance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalPriorBikeDistance])</span>
<span id="cb10-86">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>])</span>
<span id="cb10-87">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hours"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalCurrentTime<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalPriorTime])</span>
<span id="cb10-88">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚶"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalCurrentWalkTime<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalPriorWalkTime])</span>
<span id="cb10-89">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚴"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalCurrentBikeTime<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> totalPriorBikeTime])</span>
<span id="cb10-90">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>])</span>
<span id="cb10-91">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Speed (m/h)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>])</span>
<span id="cb10-92">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚶"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentWalkSpeed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> priorWalkSpeed])</span>
<span id="cb10-93">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚴"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentBikeSpeed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> priorBikeSpeed])</span>
<span id="cb10-94">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>])</span>
<span id="cb10-95">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Workouts"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentCount<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> priorCount])</span>
<span id="cb10-96">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚶"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentWalkCount<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> priorWalkCount])</span>
<span id="cb10-97">rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚴"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentBikeCount<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> priorBikeCount])</span>
<span id="cb10-98"></span>
<span id="cb10-99"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* Create the table header */</span></span>
<span id="cb10-100"></span>
<span id="cb10-101"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> tableHeader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Current"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prior"</span>]</span>
<span id="cb10-102"></span>
<span id="cb10-103"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* Display the table */</span></span>
<span id="cb10-104"></span>
<span id="cb10-105">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">header</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7 Day Stats"</span>)</span>
<span id="cb10-106">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(tableHeader<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> rows)</span></code></pre></div>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Javascript</category>
  <category>Obsidian</category>
  <category>PKM</category>
  <category>DataviewJS</category>
  <guid>https://biscotty.online/posts/obsidian/dataview/dataviewjs-interactive-dynamic-tables/</guid>
  <pubDate>Mon, 16 Oct 2023 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/dataview/dataviewjs-interactive-dynamic-tables/djs-db-exc.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Interactive Tables with DataviewJS</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/dataview/dataviewjs-summaries-statistics/</link>
  <description><![CDATA[ 






<section id="interactive-tables-with-dataviewjs" class="level1">
<h1>Interactive Tables with DataviewJS</h1>
<p><img src="https://biscotty.online/posts/obsidian/dataview/dataviewjs-summaries-statistics/djs-exercise-dashboard.png" class="img-fluid"></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This article is a follow-up to my <a href="http://biscotty.online/blogs/obsidian/dataview/gentle-introduction-to-dataviewjs">Gentle Introduction to DataviewJS</a> articles, and assumes that you have read them. It is written for anglers, but if you just want the fish you can Tldr; your way to the bottom an just grab the code. Even if you are here to learn how to fish, depending on your learning style, you may want to take a look at the complete code first before this walk-through.</p>
<p>We are now ready to start building a fully dynamic and interactive dashboard to manage the exercise logs. In this case, I’m tracking the following:</p>
<ul>
<li>type of activity</li>
<li>distance</li>
<li>duration</li>
<li>date of activity</li>
<li>route</li>
</ul>
<p>I have optional fields for notes and, as you can see, for images. Summary tables are generated using calculated values. The entire canvas updates automatically to the current day.</p>
<p>This example could easily be extended for tracking anything which includes numerical data and images. Imagine a research project, for example, where observations are taken combining numerical data, textual observations, and photos. Actually creating the log entries, thanks to Metadata Menu and Unique Notes, takes almost no time. You can read about how to do this here.</p>
<p>In this article, I’ll focus on creating this dynamic table.</p>
<p><img src="https://biscotty.online/posts/obsidian/dataview/dataviewjs-summaries-statistics/djs-d-cv.png" class="img-fluid"></p>
<p>Appropriate widgets are provided allowing for direct editing or the use of popup modals for multi-select fields and dates. The list will display all logs over the last 7 days, so different logs will appear depending on the day.</p>
<p>To do this, we will use the excellent JavaScript functionality provided by Metadata Menu. It would be more interesting were you to create a bunch of logs (notes) covering a date range of at least three months and follow along. They should all contain the following fields:</p>
<ul>
<li>topic</li>
<li>type</li>
<li>Route</li>
<li>Activity</li>
<li>Duration</li>
<li>Distance</li>
<li>Note</li>
<li>Image</li>
<li>Link</li>
</ul>
</section>
<section id="time-math" class="level2">
<h2 class="anchored" data-anchor-id="time-math">Time Math</h2>
<p>Throughout this dashboard I work with time. It is natural to want to look at time periods of weeks and months, and to compare current periods to prior periods of the same length. We, just as naturally, compare a week starting Monday or Sunday to a prior week starting on the same day. And we compare February to January. This is often a good thing, because it fits the way people naturally think.</p>
<p>But if you are really looking at the numbers, you quickly see the flaw in comparing time periods this way. You can’t compare a <strong>complete</strong> week to the prior week until the end of the week. To get around this, people use week-to-date, or quite commonly month-to-date. For months the problem is worse, as in the case of Feb/Jan comparison that’s 28 days compared to 31 days. That’s more than a 10% difference in days, and therefor in data!</p>
<p>A simple way around this, and one which provides better analysis, is to use rolling windows of time. Any seven day period contains every day of the week, and so comparing two of any such periods valid (and complete) week-to-week comparisons. For months, you can compare any 30 (or 28) day period to the prior period of equal length, so you get a full, month-long picture with apples-to-apples data (that’s a technical term😉).</p>
<p>In the first article I introduced <code>moment()</code>, an object provided by Dataview (by MomentJS actually). This makes time math easy. <code>moment()</code> itself means today, now, this very second. If you want the date/time two days ago, you can subtract two days with <code>moment().subtract(2, "days")</code>. I’ll leave it as an exercise to the reader to figure out how to find the date two months ago.</p>
<p>In order to use <code>moment()</code> for any date other than now, you need to write, eg., <code>moment(new Date("2023-10-20")</code>. We will do this so that we can format the date differently using the <code>format()</code> function in <code>moment()</code>. <code>format()</code> wants an argument, a date format string. I don’t need to see the year, and a 2-digit month is fine and shorter. On the other hand, seeing the day of the week would be useful. The format string to produce “10/10 Tue” is “MM/DD ddd”. ### Challenge As an exercise, you might pause here and think about how to display “two days ago” in the format “10/10 Tue”. You have all the knowledge you need. Think about chaining commands together with the period. ### Solution</p>
<p>Here is a solution:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> dateFormat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MM/DD ddd"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> twoDaysAgo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subtract</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"days"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(dateFormat)</span>
<span id="cb1-3"></span>
<span id="cb1-4">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paragraph</span>(twoDaysAgo)</span></code></pre></div>
<p>When writing, and especially reading, code, formatting is important. I could have written</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> twoDaysAgo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subtract</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"days"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(dateFormat)</span></code></pre></div>
<p>but it is much less clear what is going on. If you are trying to understand a piece of code, start by reformatting. ## Asynchronous Functions</p>
<p>Most computer programs execute line by line, with each line completing before moving on to the next line. Normally this is what you want. However, as the quantity of data commonly worked with increases geometrically, and the fact that it is often distributed widely across the internet, applications which require <em>fetching</em> data can easily grind to a halt due to a slow internet connection, slow servers, large quantities, etc. To overcome this problems, some functions are executed <em>asynchronously</em>. When an asynchronous function is executed, it doesn’t return the actual data. Instead, it returns what is called a <em>promise</em>. That allows the program to continue executing while the data is being fetched. It will continue execution until the data is actually required, at which point it will wait (not freeze).</p>
<p>In practice this is quite easy, involving the use of two new key words: <code>async</code> and <code>await</code>. The first, <code>async</code>, is added to the function definition, and the second, <code>await</code>, is added before any data fetching. That’s all you need to know so that you will understand the words when you see them.</p>
</section>
<section id="metadata-menu" class="level2">
<h2 class="anchored" data-anchor-id="metadata-menu">Metadata Menu</h2>
<p>Metadata Menu provides an asynchronous function for making the tables interactive. To use the function, you must import it with</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode fs code-with-copy"><code class="sourceCode fsharp"><span id="cb3-1">const <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>fieldModifier: f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> = this.app.plugins.plugins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata-menu"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>.api</span></code></pre></div>
<p>Using the curly braces like this is called deconstructing a variable or function. This means that somewhere there is a function called <code>fieldModifier</code>. The <code>: f</code> is just an alias, so that every time you use the function you don’t need to write out <code>fieldModifier</code>, you can just write <code>f</code>.</p>
<p>The other part is interesting. Take it step by step. <code>this</code> is the root directory of your vault. <code>app</code> is the hidden <code>obsidian</code> directory, inside of which there is, you guessed it, a <code>plugins</code> directory with an entry called <code>metadata-menu</code>. The rest, <code>plugins["metadata-menu"].api</code> says to look in the <code>metadata-menu</code> directory for something called <code>api</code>. This object will contain a function called <code>fieldModifier</code>, which we can now refer to simply as <code>f</code>.</p>
<p><code>fieldModifier()</code>, which is <code>f()</code> to us now, is used in <code>map()</code> and takes three arguments: the <code>dv</code> object, whatever temporary variable you are using in <code>map()</code> (we have been using <code>b</code>), and the name of the field we want. Were it a normal function you would write</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb4-1">dataviewjs dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pages</span>()     </span>
<span id="cb4-2">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(b<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span>[p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f</span>(dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Activity"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-4">  ]</span></code></pre></div>
<p>Since this fetching of date is asynchronous, you have to use the key words <code>async/await</code> here, so</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb5-1">dataviewjs dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pages</span>()     </span>
<span id="cb5-2">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">async</span> b<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span>[</span>
<span id="cb5-3">    p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">await</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f</span>(dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Activity"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-5">    ]</span></code></pre></div>
<p>The entire section containing <code>pages().map</code> needs to be wrapped in an asynchronous function called <code>Promise.all()</code>, which must be (a)waited for and returns, unsurprisingly, a promise.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">await</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Promise</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pages</span>()</span>
<span id="cb6-2">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">async</span> b<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span>[</span>
<span id="cb6-3">    p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">await</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f</span>(dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Activity"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-5">    ])</span></code></pre></div>
</section>
<section id="the-table" class="level2">
<h2 class="anchored" data-anchor-id="the-table">The Table</h2>
<p>Now, lets finally take a look at the entire code that creates the dashboard. Take some time to read through it. Everything should be understandable at this point.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">fieldModifier</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> f} <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb7-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">app</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plugins</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plugins</span>\[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata-menu"</span>\]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">api</span></span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> dateFormat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MM/DD ddd"</span></span>
<span id="cb7-5"></span>
<span id="cb7-6">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">header</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7 Day Details"</span>)</span>
<span id="cb7-7"></span>
<span id="cb7-8">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(\[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🗓️"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚶🚴"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"📓"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"⏱️"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🗺️"</span>\]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">await</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Promise</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pages</span>()</span>
<span id="cb7-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>)</span>
<span id="cb7-12">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(b <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subtract</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"days"</span>))</span>
<span id="cb7-13">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(p <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"desc"</span>)</span>
<span id="cb7-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">async</span> b<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span>[</span>
<span id="cb7-15">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Date</span>(b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ActivityDate</span>))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(dateFormat)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">await</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f</span>(dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Activity"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb7-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">await</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f</span>(dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distance"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb7-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">await</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f</span>(dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Duration"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb7-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">await</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f</span>(dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Route"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-20">    ]</span>
<span id="cb7-21">  )</span>
<span id="cb7-22">)</span></code></pre></div>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps</h2>
<p>In the <a href="https://biscotty.online/blogs/obsidian/dataview/dataviewjs-summaries-statistics/">next article</a> I will explain how to generate summary information like totals and averages for display on the dashboard. In the mean time I strongly suggest that you do two things:</p>
<ol type="1">
<li>Add images to some of your logs and create the table for the Gallery section of the dashboard</li>
<li>Turn some of your existing Dataview tables into DataviewJS tables. Or, at least, make some new ones from your own information</li>
<li>Spend some time working with date ranges. In this example, we selected the past seven days. How can you select the seven days prior to that? (Hint: you need to chain together two <code>where()</code> clauses.)</li>
<li>Can you create a month-to-date view? There are various ways to do it, but it’s helpful to know that you can do <code>moment().startOf('month')</code> to grab the first day of the month. Check out the <a href="https://momentjs.com/docs/#/manipulating/">documentation</a> for more possibilities.</li>
</ol>
<p>Happy coding!</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Javascript</category>
  <category>Obsidian</category>
  <category>DataviewJS</category>
  <guid>https://biscotty.online/posts/obsidian/dataview/dataviewjs-summaries-statistics/</guid>
  <pubDate>Sat, 14 Oct 2023 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/dataview/dataviewjs-summaries-statistics/djs-exercise-dashboard.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>DataviewJS: A Gentle Introduction</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/dataview/gentle-introduction-to-dataviewjs/</link>
  <description><![CDATA[ 






<section id="dataviewjs-a-gentle-introduction" class="level1">
<h1>DataviewJS: A Gentle Introduction</h1>
<p>This article is intended for people who are new to programming, but can serve as a jumping off point for experienced programmers new to JavaScript in general or DataviewJS in particular. The documentation can be found <a href="https://blacksmithgu.github.io/obsidian-dataview/">here</a>.</p>
<p>You may be asking yourself, “Why learn JavaScript since I have Dataview queries to make lists and tables with my data”? You need JavaScript if, for example, you want interactive tables which allow you to edit data directly from the table without opening the associated note (very important in an <a href="http://biscotty.online/blogs/obsidian/freeing-your-thinking/freeing-your-thinking-part-1/">information-first, NoSQL style</a>). Or if you want to work with relative dates, eg. “last week”, without needing to update your queries every week. JavaScript allows you to show things like totals, counts and averages together with your tables. And since you are writing JavaScript anyway, you can fully customize the way everything is displayed.</p>
<p>JavaScript may seem intimidating, but it’s really not too complex or complicated for what we need to do in Obsidian. The basic examples I start with here won’t display any tables, but will get you comfortable with some of the basic concepts and how to write simple JavaScript code. It is very important that you do these examples yourself in your own vault. Like any language, the only way to learn it is to use it (and make mistakes).</p>
<section id="javascript" class="level2">
<h2 class="anchored" data-anchor-id="javascript">JavaScript</h2>
<p>JavaScript is a general purpose programming language not unlike Python, but quite different from the confusingly-named Java programming language to which it bears no relation. It is responsible for most of the dynamic content on the internet. As happens with human languages spoken widely, JavaScript has evolved a variety of “regional dialects”, sharing a common grammar and basic lexicon, but adding words and idioms to work in specific environments. DataviewJS is one such dialect, one which provides a vocabulary specifically tailored for Obsidian. It does this by giving us a <em>Dataview object</em>, but more on that later.</p>
<p>This will be a learn-by-example sort of thing, but it’s worth mentioning a few things up front for those totally new to this. In JavaScript, spaces, tabs and line breaks don’t matter. You could write your script on one line, but that would be silly. I suggest that you use spaces and line breaks liberally, because it will make your code much easier to write, read and quickly understand when you look back at it later. You will also see some people using semi-colons at the end of lines. This, too, is optional. Finally, variables can be named however you like, but the convention for multi-word variables is to capitalize the first letter of every word except the first, like <code>theVariableName</code>.</p>
<p>(Fun fact: this naming convention is called “camel case”, with the capital letters seen as humps protruding from the back of a camel. Two humps can be seen in one form, <code>CamelCase</code>. The form used in JavaScript, <code>camelCase</code> is specifically called “dromedary case” for apparent reasons.)</p>
<p>One thing about JavaScript which took me a while to get used to at first was all of the curly braces (<code>{}</code>). All that they indicate is that there is a block of JavaScript code inside, usually with multiple lines. While we’re on the subject of braces, the square brackets (<code>[]</code>) are used when you want a list of things. Just separate each item by commas, and put quotations around each item, like <code>["Item 1", "Item2"]</code>. You often want to go through lists item by item (a process called iteration), and we will see later how to do this. Apostrophes (<code>'</code>) and quotations (<code>"</code>) can be used interchangeably to wrap text. Don’t worry, we’ll go over all this later.</p>
</section>
<section id="hello-world" class="level2">
<h2 class="anchored" data-anchor-id="hello-world">Hello World</h2>
<p>The first program you traditionally write in any programming language is “Hello World”, which displays, not unsurprisingly, “Hello World” as output. Here is such a one in DataviewJS:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb1-1">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paragraph</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hello World"</span>)</span></code></pre></div>
<p>The output looks like this:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb2-1">Hello World</span></code></pre></div>
<p>Yeah! You are now a JavaScript programmer! This simple example introduces some important concepts, though.</p>
<p>First, when you want to write some JavaScript, you must use a code block with the key word <code>dataviewjs</code>. While you are writing code, it can be convenient to start the code block with <code>js dataviewjs</code> rather than simply <code>dataviewjs</code>. You will get nice syntax highlighting that way, and can simply remove the first <code>js</code> when you want to run your code.</p>
<p>As you might have guessed, <code>paragraph</code> just means to display the text in parentheses as a paragraph. Technically, <code>dv.paragraph()</code> is a command, or <em>function</em>, and the part in parentheses is called the <em>arguments</em>. Note the quotations surrounding the text.</p>
<p>So what’s this <code>dv</code> thing? Remember when I said that each flavor of JavaScript provides special vocabulary for it’s context? They do this typically by providing an “object” containing the functionality. <code>dv</code> is what is called the <em>Dataview object</em>, and anytime you want to access the functionality of DataviewJS you indicate that by starting your statement or phrase with <code>dv</code> followed by a period. Since displaying a paragraph on a page of markdown is specific to DataviewJS, we write <code>dv.paragraph()</code></p>
<p>In addition to paragraphs, the <code>dv</code> object allows us to display headers, lists, tables, etc. In fact, the <code>dv</code> object can display any HTML element. You can display multiple elements by putting them one after another in your code.</p>
<p>Let’s look at another example:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb3-1">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">header</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Introduction to DataviewJS"</span>)</span>
<span id="cb3-2">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paragraph</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"Hi, my name is DataviewJS"'</span>)</span></code></pre></div>
</section>
<section id="introduction-to-dataviewjs" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-dataviewjs">Introduction to DataviewJS</h2>
<p>Hi, my name is DataviewJS</p>
<p>Since it’s hard to show the result naturally, I’ve included screenshots from my vault with the code on the right and the results on the left.</p>
<p><img src="https://biscotty.online/posts/obsidian/dataview/gentle-introduction-to-dataviewjs/djs-intro-1.png" class="img-fluid"></p>
<p>Here I’m displaying 2 elements. Headers require two arguments, the first indicating the header level. This example is the same as writing <code>## Introduction to DataviewJS</code>. Note that we don’t use quotations around numbers (usually). The <code>dv</code> object also allows us to display lists, like this:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb4-1">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Item 1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Item 2"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Item 3"</span>])</span></code></pre></div>
<p>Remember that, when making lists in JavaScript, you use the square brackets and separate each item with a comma. This is also called an <em>array</em>. This is a pretty simple example, but sometimes things get a lot more complicated, and since spaces and new lines don’t matter, it is good practice to write the same code like this:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb5-1">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>([</span>
<span id="cb5-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Item 1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Item 2"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Item 3"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-5">])</span></code></pre></div>
<p>This makes it much easier to see what is going on, and also makes copying and pasting of individual items easier, too.</p>
</section>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">Variables</h2>
<p>Well, you may not be too impressed so far. Nothing we’ve done yet has been anything we couldn’t have done by simply writing the markdown. Things get more interesting when we start using <em>variables</em>. These allows us to create and manipulate information before displaying it. Variables are usually made (declared) with either <code>const</code> or <code>let</code> in JavaScript. So <code>const myName = "Brian"</code> creates a variable called <code>myName</code> with the value of “Brian”. We can then write this:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> myName <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brian"</span></span>
<span id="cb6-2">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paragraph</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hi, my name is "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> myName <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>)</span></code></pre></div>
<p>which produces</p>
<pre><code>Hi, my name is Brian.</code></pre>
<p>When used with text, called <em>strings</em> in coding lingo, the <code>+</code> puts together (concatenates) multiple strings. You can see that a long string with multiple variables could start to look messy. A more convenient way to combine text and variables is to use back ticks instead of quotes, and put the variable names in curly braces preceded with the dollar sign. So instead we can write:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> myName <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brian"</span></span>
<span id="cb8-2">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paragraph</span>(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`Hi, my name is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>myName<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">.`</span>)</span></code></pre></div>
<p>to get the same result.</p>
<p>You could still object, no pun intended, that we haven’t done anything we couldn’t have done just by writing out the sentence. We’ll get to that in the next article, but before closing this one, I’ll show you something you can only do with JavaScript. DataviewJS comes with another JavaScript flavor baked in called MomentJS. Like DataviewJS provides a <code>dv</code> object, MomentJS provides a <code>moment</code> object which makes it easy to work with dates and times. We’ll talk a lot more about this later, but for now you can use it like this:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> today <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Date</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">now</span>())<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MMMM DD, YYYY"</span>)</span>
<span id="cb9-2">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paragraph</span>(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`Today is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>today<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span></code></pre></div>
<pre><code>Today is October 10, 2023</code></pre>
<p>This display’s today’s date in a format specified by argument to the <code>format()</code> function. Every time you open a note or canvas, the current day will be displayed.</p>
<p>Putting it all together, we can write</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> myName <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brian"</span></span>
<span id="cb11-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> today <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">moment</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Date</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">now</span>())<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MMMM DD, YYYY"</span>)</span>
<span id="cb11-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> learnings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb11-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JavaScript basics"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The dataview object"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Displaying elements with JavaScript"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JavaScript variables"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-8">]</span>
<span id="cb11-9">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">header</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`Things </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>myName<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;"> learned on </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>today<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb11-10">dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(learnings)</span></code></pre></div>
<p>to produce</p>
<section id="things-brian-learned-on-october-10-2023" class="level3">
<h3 class="anchored" data-anchor-id="things-brian-learned-on-october-10-2023">Things Brian learned on October 10, 2023</h3>
<ul>
<li>JavaScript basics</li>
<li>The dataview object</li>
<li>Displaying elements with JavaScript</li>
<li>JavaScript variables</li>
</ul>
<p><img src="https://biscotty.online/posts/obsidian/dataview/gentle-introduction-to-dataviewjs/djs-intro-2.png" class="img-fluid"></p>
</section>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>In the <a href="http://biscotty.online/blogs/obsidian/dataview/dataviewjs-summaries-statistics/">next article</a> I’ll start looking at using DataviewJS to make lists and tables and otherwise use the information in your vault. Meanwhile, if you want to learn more about working with dates, you can visit the <a href="https://momentjs.com/">Moment.js website</a>. And the DataviewJS documentation can be found <a href="https://blacksmithgu.github.io/obsidian-dataview/">here</a>. Happy coding!</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Javascript</category>
  <category>Obsidian</category>
  <category>DataviewJS</category>
  <guid>https://biscotty.online/posts/obsidian/dataview/gentle-introduction-to-dataviewjs/</guid>
  <pubDate>Wed, 11 Oct 2023 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/dataview/gentle-introduction-to-dataviewjs/djs-intro-2.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Obsidian: Pretty Canvas</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/pretty-canvas/</link>
  <description><![CDATA[ 






<section id="obsidian-pretty-canvas" class="level1">
<h1>Obsidian: Pretty Canvas</h1>
<p>Going visual has really helped free my thinking, and pretty much all of my time in Obsidian is now spent on canvases. Other than when I am making fleeting notes on an article, book or video, I do pretty much everything from a canvas. I process and edit my notes, list questions which guide my research, maintain tasks associated with the effort, and perhaps develop an article on the topic, all from the canvas.</p>
<p>Naturally I want my canvases to be pretty. It’s not just a question of aesthetics either. Changing simple things like the color or size of elements makes the canvas much more use-able, drawing your eyes quickly to more important information and removing extraneous stuff. Obsidian fortunately allows us to use <a href="https://developer.mozilla.org/en-US/docs/Web/CSS">CSS</a> to do this.</p>
<p>Here’s an example of a Visual Dashboard I’m just getting started with for a new article. The first image is with default styling. It is usable, and has some pretty colors, but it’s visually confusing.</p>
<p><img src="https://biscotty.online/posts/obsidian/pretty-canvas/canvas-plain.png" class="img-fluid"></p>
<p>There are too many colors for one. The title of the canvas doesn’t stand out, and the group headings don’t either. There is also a bunch of stuff that I don’t need to see, like the links after every task.</p>
<p>Here is the same with CSS applied. Notice how some useless clutter has been removed, task descriptions have a standardized color which is easy to read, group headings stand out better to guide your eyes, and titles look good.</p>
<p><img src="https://biscotty.online/posts/obsidian/pretty-canvas/canvas-pretty.png" class="img-fluid"></p>
</section>
<section id="implementation" class="level1">
<h1>Implementation</h1>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<p>Using CSS is pretty straight-forward in principle, but figuring out how to apply it can take a bit of work, as there seems to be no good documentation for automatically generated classes. Also, CSS is simply unfamiliar to many people. Never the less, a little can go a long way. So I wanted to share some of the styling I’m using for my canvases as a jumping-off point for you to personalize your canvases and be more efficient in working with them.</p>
<p>To get started, you need to create a <code>snippets</code> directory in the hidden <code>obsidian</code> directory of your vault. Any files placed here with the extension <code>css</code> will be available to Obsidian. You can name the files anything you want, so choose a descriptive name. With obvious irony, these files can only be edited with an external editor, but any editor will do, like vim, nano or Notepad. I suggest you create a file called <code>canvas-fyt.css</code> and copy the contents below into the file. In Obsidian, you will be able to “activate” whichever files you want to use, so you can have multiple styles of canvases.</p>
<p>Once you have created a <code>css</code> file in the correct directory you can go to the Appearance section and toggle on the new file to make it active. You may need to press the reload button to re-scan the directory.</p>
<p><img src="https://biscotty.online/posts/obsidian/pretty-canvas/enable-css.png" class="img-fluid"></p>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>With that done, let’s start with the background. Add the following to the file to change the color and remove the dots:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb1-1">svg<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.canvas-background</span> {</span>
<span id="cb1-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">background</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">linear-gradient(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">deg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#253B0B</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#2c0149</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#390B1C</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-3">}</span>
<span id="cb1-4"></span>
<span id="cb1-5">svg<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.canvas-background</span> circle {</span>
<span id="cb1-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">display</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">none</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-7">}</span></code></pre></div>
<p>The background is actually an image of the type svg, which stands for Scalable Vector Graphic (as compared to png or jpg). The svg is automatically assigned the class <code>canvas-background</code>. By writing <code>svg.canvas-background</code> we select only the background image and not any other svg files which might be on the canvas. As you can see, styles use key/value pairs followed by a semi-colon. I’ve used a gradient here, but if you only want a single color, you could simply write <code>background-color: tan;</code> for example. There are over 150 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/named-color">named colors</a> which you can use. If you have an RGB value from a color picker, you can write <code>background-color: rgb(10,160,245);</code>.</p>
<p><code>display: none;</code> says not to display a particular element, in this case the grid dots (circles). We’ll use this again later.</p>
</section>
<section id="tasks" class="level2">
<h2 class="anchored" data-anchor-id="tasks">Tasks</h2>
<p>Next we can style the tasks. Adding</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.task-description</span> {</span>
<span id="cb2-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">cyan</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-3">}</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.tasks-backlink</span> {</span>
<span id="cb2-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">display</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">none</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-7">}</span></code></pre></div>
<p>will change all of the task descriptions to a consistent and easily readable color. It also removes the backlink text which points to the file containing the task. I’m not interested in files, so this is useless to me but takes up a lot of visual space.</p>
</section>
<section id="titlesheaders" class="level2">
<h2 class="anchored" data-anchor-id="titlesheaders">Titles/Headers</h2>
<p>With that done we can turn to the textual elements. For these, you must specify on the canvas which elements you want to apply the styles to. For this you need to use HTML instead of markdown, allowing you to assign a <em>class</em> to an element. Let’s style the headings which I will use for titles so they stand out.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.title-tag-1</span> {</span>
<span id="cb3-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">text-align</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">center</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-size</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">em</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-4">}</span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.title-tag-2</span> {</span>
<span id="cb3-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">text-align</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">center</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-size</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">em</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-8">}</span>
<span id="cb3-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.title-tag-3</span> {</span>
<span id="cb3-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">text-align</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">center</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-size</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">em</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-12">}</span></code></pre></div>
<p>On the canvas, in order to use the styles, you can’t use the standard hash tags (<code>#, ##, ###</code>) for headers. Instead you need to use HTML and specify the class. For example, instead of writing <code># Header</code> you write <code>&lt;h1 class="title-tag-1"&gt;Header&lt;/h1&gt;</code>. Then you will see the styles applied to the class.</p>
<p>Notice the units used for the font size. You can use different units for font size such as pixels (<code>font-size: 24px;</code>). <code>em</code> is convenient though, because it is a relative size. <code>2 em</code> is like saying “display this twice as large as it would normally be displayed”. The actual size will change based on the zoom level.</p>
</section>
<section id="other-textual-elements" class="level2">
<h2 class="anchored" data-anchor-id="other-textual-elements">Other textual elements</h2>
<p>I also like to be able to have certain words jump out on the page, more than can be achieved with bold or italics. So I have a class</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.my-emphasis</span> {</span>
<span id="cb4-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#b7db6f</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-size</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">em</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-4">}</span></code></pre></div>
<p>I can use this class by wrapping text in a <code>&lt;span&gt;</code> element like this:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb5-1">In this paragraph &lt;span class="my-emphasis"<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>these words&lt;/span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> will stand out.</span></code></pre></div>
<p>In this paragraph <span class="cta">these words</span> will stand out.</p>
<p>To change the font, add</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> {</span>
<span id="cb6-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-family</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quicksand"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">sans-serif</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-3">}</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.canvas-group-label</span> {</span>
<span id="cb6-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-size</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">em</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-family</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quicksand"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-weight</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">bold</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">black</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-9">}</span></code></pre></div>
<p>I like the Quicksand font. It is a <a href="https://fonts.google.com/">free font</a> from Google, which provides a huge variety of fonts. In order to display a font you must download it and install it to your system. If it is not on your system, the default sans-serif font will be used instead. As you can see, I’ve also changed the size, color and weight of the labels for the groups on the canvas.</p>
<p>Finally, I would like to have the filenames of links on the canvas to be a different color, so</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.internal-link</span> {</span>
<span id="cb7-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">red</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-3">}</span></code></pre></div>
<p>And that’s it. For convenience I provide the complete file below. I hope adding some style will enrich your experience working with your Visual Dashboards.</p>
</section>
</section>
<section id="final-file" class="level1">
<h1>Final File</h1>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb8-1">svg<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.canvas-background</span> {</span>
<span id="cb8-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">background</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">linear-gradient(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">deg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#253B0B</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#2c0149</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#390B1C</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-3">}</span>
<span id="cb8-4"></span>
<span id="cb8-5">svg<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.canvas-background</span> circle {</span>
<span id="cb8-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">display</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">none</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-7">}</span>
<span id="cb8-8"></span>
<span id="cb8-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.title-tag-1</span> {</span>
<span id="cb8-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">text-align</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">center</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-size</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">em</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-12">}</span>
<span id="cb8-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.title-tag-2</span> {</span>
<span id="cb8-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">text-align</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">center</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-size</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">em</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-16">}</span>
<span id="cb8-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.title-tag-3</span> {</span>
<span id="cb8-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">text-align</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">center</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-size</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">em</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-20">}</span>
<span id="cb8-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.canvas-group-label</span> {</span>
<span id="cb8-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-size</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">em</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-23">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-family</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quicksand"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-weight</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">bold</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">black</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-26">}</span>
<span id="cb8-27"></span>
<span id="cb8-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.task-description</span> {</span>
<span id="cb8-29">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">cyan</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-30">}</span>
<span id="cb8-31"></span>
<span id="cb8-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.tasks-backlink</span> {</span>
<span id="cb8-33">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">display</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">none</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-34">}</span>
<span id="cb8-35"></span>
<span id="cb8-36"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.internal-link</span> {</span>
<span id="cb8-37">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">red</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-38">}</span>
<span id="cb8-39"></span>
<span id="cb8-40"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> {</span>
<span id="cb8-41">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-family</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quicksand"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-42">}</span>
<span id="cb8-43"></span>
<span id="cb8-44"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.markdown-rendered</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.my-emphasis</span> {</span>
<span id="cb8-45">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#b7db6f</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-46">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-size</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">em</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-47">}</span></code></pre></div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Obsidian</category>
  <category>CSS</category>
  <guid>https://biscotty.online/posts/obsidian/pretty-canvas/</guid>
  <pubDate>Thu, 05 Oct 2023 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/pretty-canvas/canvas-pretty-css-composite.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Obsidian: Freeing Your Thinking Workflow</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/freeing-your-thinking/freeing-your-thinking-workflow/</link>
  <description><![CDATA[ 






<p>I recently published <a href="https://biscotty.online/blogs/obsidian/freeing-your-thinking/freeing-your-thinking-part-1">several articles</a> on using Obsidian’s native database functionality to increase focus and efficiency when working with the information in our vaults. Rather than using Obsidian as a souped-up word processor, we can abandon the file paradigm altogether and use Bookmark and Canvas for accessing, editing, analyzing and organizing our information.</p>
<p>Given the interest that the articles have generated, and the fact that the concepts may be unfamiliar to some, I thought it would be helpful to make a video demonstrating how it works in practice. It ended up being somewhat long, so this is the second part.</p>
<p>If you haven’t read the articles, this may be confusing as I don’t go into depth on the concepts. This isn’t really a how-to video, so it assumes you know your way around Obsidian.</p>
<hr>
<section id="part-1" class="level1">
<h1>Part 1</h1>
<iframe src="https://fast.wistia.net/embed/iframe/yiot4vgtp3?seo=false&amp;videoFoam=false" title="FYT Demo Part 1 Video" allow="autoplay; fullscreen" allowtransparency="true" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" msallowfullscreen="" width="750" height="422">
</iframe>
<script src="https://fast.wistia.net/assets/external/E-v1.js" async=""></script>
<hr>
</section>
<section id="part-2" class="level1">
<h1>Part 2</h1>
<iframe src="https://fast.wistia.net/embed/iframe/c5nzx1xanr?seo=true&amp;videoFoam=false" title="FYT Demo Part 2 Video" allow="autoplay; fullscreen" allowtransparency="true" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" msallowfullscreen="" width="750" height="422">
</iframe>
<script src="https://fast.wistia.net/assets/external/E-v1.js" async=""></script>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Obsidian</category>
  <category>PKM</category>
  <guid>https://biscotty.online/posts/obsidian/freeing-your-thinking/freeing-your-thinking-workflow/</guid>
  <pubDate>Thu, 21 Sep 2023 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/freeing-your-thinking/freeing-your-thinking-workflow/fyt-walkthrough.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Obsidian Canvas Dashboards</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/visual-mocs-with-canvas/</link>
  <description><![CDATA[ 






<section id="motivation" class="level1">
<h1>Motivation</h1>
<p>This is the last in a series of articles, including <a href="https://biscotty.online/blogs/obsidian/freeing-your-thinking">Freeing Your Thinking</a> and <a href="https://biscotty.online/blogs/obsidian/bookmarks">Building a Knowledge Tree</a>, where I talk about using Obsidian as a non-relational database. The main idea is to interact with information, not files, and Obsidian’s core plugins facilitate this approach. I have talked about Search, Bookmarks, Unique Notes and Graph View. This article will describe how to use Canvas to create visual maps of content which not only present information in a clear, attractive and flexible way, but also allow you to explore and interact with your information. As usual, our goal is to obviate the need to open files.</p>
<p>In data science there is a motto “visualize, visualize, visualize.” In the business world, information is commonly presented in the form of a dashboard to allow for visualizing data. A dashboard is a graphical user interface containing views of information. Aside from providing graphical elements and views, a dashboard will typically provide navigational tools and other ways to interact with information and even edit information directly from the dashboard.</p>
<p>Before discussing canvas, I want to mention <a href="https://github.com/zsviczian/obsidian-excalidraw-plugin">Excalidraw</a>, an excellent Community Plugin by Zsolt Viczián. It is great for creating visual maps of content with many graphical elements easily available. I highly recommend it. Nevertheless, one of the purposes of this series is to highlight Obsidian’s native tools, and Canvas is quite powerful in its own right.</p>
</section>
<section id="canvas" class="level1">
<h1>Canvas</h1>
<p>Canvas in Obsidian provides all we need to create dashboards. It allows for the following elements:</p>
<ul>
<li>Notes, but more importantly sections and blocks from notes</li>
<li>Cards, virtual notes which can contain any elements that an ordinary note can and can be converted to an actual note with a mouse click</li>
<li>Graphics, which can be incorporated independently or as an embed in a Card or Note. They can even be used as backgrounds for groups</li>
<li>Groups, which provide visual structure and facilitate navigation</li>
<li>Connectors, which can be directional and annotated, especially good for KanBan style canvases</li>
</ul>
</section>
<section id="visual-maps-of-content" class="level1">
<h1>Visual Maps of Content</h1>
<p>Map of Content is a somewhat generic term to refer to a note which includes information from other notes. They can be simple indices of links to related notes, or complete research articles or books, or something in between. The type of MOC depends upon the purpose.</p>
<p>Here I will demonstrate two different types of Visual MOCs. First, an informational dashboard of an academic topic, which could be used by a student or teacher for study or lesson planning. Secondly, a fully interactive dashboard for managing all aspects of my writing and publications. Without leaving the canvas, I can edit both metadata and content of notes.</p>
<p>This workflow relies on three community plugins: Dataview, Metadata Menu and Hover Editor.</p>
<section id="topical-dashboard" class="level2">
<h2 class="anchored" data-anchor-id="topical-dashboard">Topical Dashboard</h2>
<p>Canvases are ideal for pulling together information on a given topic and presenting it in a visually interesting way. As a student, I can accumulate information (not files) on a topic and add it to my canvas. This makes review of the topic easy. As a teacher, such a MOC could provide the basis of a lesson plan, and could even be distributed as course material.</p>
<p>As an example, this is a canvas covering the Normal Distribution, an important topic in probability and statistics. <img src="https://biscotty.online/posts/obsidian/visual-mocs-with-canvas/canvas-nd-overview.png" class="img-fluid"></p>
<p>All of my information is grouped in categories. The information itself is drawn from specific sections or blocks within notes, not entire notes. I can navigate the canvas with a convenient drop down, allowing me to jump to a particular section. This is especially convenient on large canvases. <img src="https://biscotty.online/posts/obsidian/visual-mocs-with-canvas/canvas-command-menu.png" class="img-fluid"></p>
<p>Otherwise I can simply use the mouse to move around the canvas and zoom in and out as I review my information. <img src="https://biscotty.online/posts/obsidian/visual-mocs-with-canvas/canvas-nd-detail.png" class="img-fluid"></p>
</section>
<section id="interactive-dashboard" class="level2">
<h2 class="anchored" data-anchor-id="interactive-dashboard">Interactive Dashboard</h2>
<p>This is an example of using a visual MOC to both present information and also manage information. It includes interactive tables, previews of documents in progress, and graphics to identify the stage of development of each project.</p>
<p><img src="https://biscotty.online/posts/obsidian/visual-mocs-with-canvas/canvas-publications.png" class="img-fluid"></p>
<p>Thanks to Metadata Menu, I can edit the metadata for any document without opening it. <img src="https://biscotty.online/posts/obsidian/visual-mocs-with-canvas/canvas-mm-table.png" class="img-fluid"></p>
<p><img src="https://biscotty.online/posts/obsidian/visual-mocs-with-canvas/canvas-mm-modal.png" class="img-fluid"></p>
<p>Using Hover editor, I can even edit a document without leaving the dashboard.</p>
<p><img src="https://biscotty.online/posts/obsidian/visual-mocs-with-canvas/canvas-hover-editor.png" class="img-fluid"></p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>This series of articles was meant to introduce the concept of using Obsidian as a database rather than a traditional file editor, with emphasis on Core Plugins. In the first article, I covered creating information without worrying about file names and directories (Unique Notes), and then accessing that information without navigating to or even opening files (Search). In the second, I discussed interacting with Obsidian to organize and analyze information (Graph View and Bookmarks). Most recently, I showed how Bookmarks can be used to create a useful Knowledge Tree using views of information rather than files.</p>
<p>Here I finish with a way to create visually interesting and useful maps of content using Canvas, together with the Community Plugins Dataview, Metadata Menu, and Hover Edge. Again, this allows you to interact with your information as one would a database, without opening files.</p>
<p>I hope you are intrigued enough to try this method. Thank you for reading this, and constructive criticism is always welcome.</p>
</section>
<section id="gratitude" class="level1">
<h1>Gratitude</h1>
<p>I would like to thank some people who have been my muses as I’ve learned Obsidian. They are all good sources of experience and insight.</p>
<ul>
<li>Zsolt Viczián</li>
<li>Sergio (From Sergio)</li>
<li>Nicole van der Hoeven</li>
<li>Nick Milo</li>
</ul>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Obsidian</category>
  <guid>https://biscotty.online/posts/obsidian/visual-mocs-with-canvas/</guid>
  <pubDate>Thu, 14 Sep 2023 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/visual-mocs-with-canvas/canvas-publications.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Obsidian Metadata Menu Plugin</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/metadata-menu/</link>
  <description><![CDATA[ 






<section id="metadata-menu" class="level1">
<h1>Metadata Menu</h1>
<p>With the release of Obsidian 1.4.5, many people’s focus has been on metadata, which Obsidian calls Properties. I have written a series of articles (see <a href="https://biscotty.online/obsidian/concepts/freeing-your-thinking">Freeing Your Thinking</a>) on using Obsidian’s natural database features, and my entire workflow depends heavily on metadata. Naturally, I was anticipating this release with some excitement, having seen some previews on YouTube.</p>
<p>I was frankly disappointed. It is movement in a positive direction, and has some very nice features for managing metadata. However, its insistence on YAML for properties when many users such as myself prefer in-line metadata for its flexibility, makes some of its features useless to me.</p>
<p>Another reason for my disappointment, or feeling underwhelmed, was that I had already discovered a truly amazing plugin for managing metadata which did everything I need and more. <a href="https://github.com/mdelobelle/metadatamenu">Metadata Menu</a>, a Community Plugin by <a href="https://github.com/mdelobelle">mathieu</a>, provides a full set of features for managing properties. It has a modal, available in multiple places, which allows you to manage literally all aspects of a file’s metadata without opening the file, perfect for my workflow. It even has a file class template system which supports nesting groups of metadata fields. Fields in tables can have actions, allowing for direct editing of metadata in the table itself using standard widgets. And, it is visually clean and attractive</p>
<p>This video isn’t a guide to using Metadata Menu. Rather, it’s to show off some of its features. If metadata is important to you, you must check it out.</p>
<hr>
<iframe src="https://fast.wistia.net/embed/iframe/yfcu9td6yc?seo=false&amp;videoFoam=false" title="Metadata Menu Final Video" allow="autoplay; fullscreen" allowtransparency="true" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" msallowfullscreen="" width="750" height="422">
</iframe>
<script src="https://fast.wistia.net/assets/external/E-v1.js" async=""></script>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Obsidian</category>
  <guid>https://biscotty.online/posts/obsidian/metadata-menu/</guid>
  <pubDate>Wed, 06 Sep 2023 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/metadata-menu/MMCover.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Obsidian Bookmarks</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/obsidian-bookmarks/</link>
  <description><![CDATA[ 






<p>Bookmarks are the key to effectively using obsidian as a non-relational database. The virtues of approaching your notes this way are several and I covered some in the <a href="https://biscotty.online/blogs/obsidian/freeing-your-thinking/freeing-your-thinking-part-1/">Freeing Your Thinking</a> series. In this article I want to develop the idea of using Bookmarks to construct flexible, interactive Knowledge Trees to organize notes. Just as a reminder, we are organizing information, not files.</p>
<p>The Navigation tab gives at best a static arrangement of information, while the Bookmarks tab provides a dynamic way to interact with, develop and access your information. Here you can create <em>Views</em> of your information which you can organize by domain, subject, activity, etc. Views are saved filters and queries. Your information, unlike your files, can happily exist in multiple places in your Knowledge Tree.</p>
<p>When you begin to build your Knowledge Tree, you might start by creating <em>Views</em> which map to your current directories using filters. After all, you want to preserve the information you have put into your vault by organizing your notes in a File Tree. Most people have a separate directory for fleeting notes, so you might make a view containing <code>path: "fleeting-note-directory"</code>. But is such a view terribly useful? Browsing through all your fleeting notes is fun if you’ve nothing better to do, but it’s not focused or efficient use of time if you are working on a particular topic. Wouldn’t it be better to just see the fleeting notes related to my topic? So I save the filter <code>Whatever Topic \type:: fleeting\</code> alongside my views of the topic itself and have a list of fleeting notes only on that topic.</p>
<p>As you start mapping your old directories to views, you might begin to ask yourself at some point why you would ever really want to see all your MOCs in a list? Or Daily Notes? Or Logs? If you want <em>information</em> from these types of notes you typically create a note containing a Dataview query. Bookmarked filters, which I’m calling views, are like virtual Dataview queries. And, since you can do this without referencing file locations, you might question how much useful information was actually embedded in your folder structure. Then you might have a cup of tea.</p>
<p>One last point to stress: the bookmarks, which I will call views, are ephemeral. They can be created, duplicated, renamed and moved around without affecting the information itself. When focusing on a topic, drag it to the top of the tree and put it back when you are done.</p>
<section id="the-mechanics" class="level1">
<h1>The Mechanics</h1>
<section id="commands" class="level2">
<h2 class="anchored" data-anchor-id="commands">Commands</h2>
<p>The following table shows the bookmarks commands with suggested Hotkeys which are most likely unassigned.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 42%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Description</th>
<th>Hotkey</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Bookmark…</td>
<td>Bookmark current file</td>
<td><code>Ctrl-Cmd-Alt-M</code></td>
</tr>
<tr class="even">
<td>Show Bookmarks</td>
<td>Open bookmarks panel</td>
<td><code>Ctrl-B</code></td>
</tr>
<tr class="odd">
<td>Bookmark Current Search</td>
<td></td>
<td><code>Ctrl-Cmd-Alt-S</code></td>
</tr>
<tr class="even">
<td>Bookmark Current Block</td>
<td>Bookmark Block Under Cursor</td>
<td><code>Ctrl-Cmd-Alt-B</code></td>
</tr>
<tr class="odd">
<td>Bookmark Current Heading</td>
<td>Bookmark Heading Under Cursor</td>
<td><code>Ctrl-Cmd-Alt-H</code></td>
</tr>
</tbody>
</table>
</section>
<section id="bookmarks-panel" class="level2">
<h2 class="anchored" data-anchor-id="bookmarks-panel">Bookmarks Panel</h2>
<p>The panel lists all bookmarks, which, remember, are saved searches, or views. In the panel you can create, rename and delete bookmark groups to organize your bookmarks. Bookmarks can be dragged around to rearrange them.</p>
</section>
</section>
<section id="knowledge-trees" class="level1">
<h1>Knowledge Trees</h1>
<p>When working with a database, we typically create views. Views are subsets of your information based on queries which have been saved. They can be used passively, as a way to look at certain information on a certain topic. They can also be used interactively, as a basis for more fine-grained queries, which, if interesting, can themselves be saved as views.</p>
<p>I have my Knowledge Tree organized by the different domains of my life, Living, Learning and Creating. In addition, I have a section with utilities I call the Toolbox.</p>
<section id="living" class="level2">
<h2 class="anchored" data-anchor-id="living">Living</h2>
<p>This is the structure of my Living section:</p>
<pre><code>- Daily Notes
- Logs
    - Exercise
    - Piano
    - etc.
- Daily Notes
- CV
- People
- Leisure</code></pre>
<p><em>Daily Notes</em> is a view of <code>type:: daily</code>. Exercise and Piano are actual files with interactive Dataview queries. The rest are bookmark groups containing other views.</p>
</section>
<section id="learning" class="level2">
<h2 class="anchored" data-anchor-id="learning">Learning</h2>
<p>I use <em>Learning</em> for study and research activities. This part of the tree is the most complex in terms of structure.</p>
<p>By creating multiple views on a given topic and organizing them in folders I can essentially create an outline of my information using views. This kind of outline, again, is very flexible and can be reshaped easily as my knowledge develops.</p>
<p>This is an excerpt of my section on the normal distribution. It’s “home” is in the bookmark group <code>Learing/Data Science/Probability/</code>.</p>
<pre><code>Normal Distribution                 # All information on the Normal Distribution
Normal Distribution                 # The reference note on the topic
                                      The 2 are distinguished by different icons
Central Limit Theorem               # A bookmark group containing other views
68-95-99.7 Rule                     # A view of a block in a note
R Functions for Normal Distribution # A view of a section of a note</code></pre>
</section>
<section id="creating" class="level2">
<h2 class="anchored" data-anchor-id="creating">Creating</h2>
<p>is for writing and creation of other content. Creating includes works for external and internal use.</p>
<pre><code>- Articles
- Stories
- Video Scripts
- Musings</code></pre>
</section>
<section id="toolbox" class="level2">
<h2 class="anchored" data-anchor-id="toolbox">Toolbox</h2>
<p>In the toolbox I have the following directories, which should be self-explanatory:</p>
<pre><code>- Templates
- fileClasses
    - Class Definitions
    - Value Lists
- Fleeting Notes
- Other
    - Articles
    - MOCs
    - References
    - Atomics</code></pre>
<p>Other than templates and fileClasses, I rarely use the Toolbox.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>I hope I have adequately conveyed some of the advantages of building Knowledge Trees. Maybe you noticed that the word “tree” is actually a misnomer. The branches of real trees don’t reconnect, but ours can. What we really have is a Knowledge Network. Bookmarks allow us to leverage Obsidian’s NoSQL features to free our Second Brain.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Obsidian</category>
  <guid>https://biscotty.online/posts/obsidian/obsidian-bookmarks/</guid>
  <pubDate>Tue, 05 Sep 2023 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/obsidian-bookmarks/tn-metadata-menu.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Obsidian: The mechanics of Graph View</title>
  <dc:creator>Brian Carey</dc:creator>
  <link>https://biscotty.online/posts/obsidian/graph-view-deets/</link>
  <description><![CDATA[ 






<p>Core functionality in Obsidian seems to be somewhat overlooked. I have written in other articles about using Search, Bookmarks, and Unique Notes for Freeing Your Thinking. In these videos, I demonstrate the functionality of another core component, Graph View.</p>
<p>A graph is a specific data structure consisting of nodes and edges. Obsidian consists of notes which are linked together. This type of data can be stored in a non-relational database. With links and metadata, Obsidian is a non-relational database.</p>
<p>For these reasons, graph view is a powerful way to visualize your data. Graph view is a force directed graph drawing. Where Obsidian search is the best way to find information, graph view is the best way to visualize information and discovering relationships which have not been defined, such as orphans.</p>
<p>These videos go through the details of the graph view functionality in the hope that you will begin to use it to visualize data.</p>
<hr>
<section id="part-1" class="level2">
<h2 class="anchored" data-anchor-id="part-1">Part 1</h2>
<iframe src="https://fast.wistia.net/embed/iframe/fy4yt8o2q3?seo=false&amp;videoFoam=false" title="GV-Deets-Pt1 Video" allow="autoplay; fullscreen" allowtransparency="true" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" msallowfullscreen="" width="750" height="422">
</iframe>
<script src="https://fast.wistia.net/assets/external/E-v1.js" async=""></script>
<hr>
</section>
<section id="part-2" class="level2">
<h2 class="anchored" data-anchor-id="part-2">Part 2</h2>
<iframe src="https://fast.wistia.net/embed/iframe/m04ic0bdnu?seo=false&amp;videoFoam=false" title="GV-Deets-Pt2 Video" allow="autoplay; fullscreen" allowtransparency="true" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" msallowfullscreen="" width="750" height="422">
</iframe>
<script src="https://fast.wistia.net/assets/external/E-v1.js" async=""></script>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>Obsidian</category>
  <category>Graphs</category>
  <guid>https://biscotty.online/posts/obsidian/graph-view-deets/</guid>
  <pubDate>Thu, 31 Aug 2023 06:00:00 GMT</pubDate>
  <media:content url="https://biscotty.online/posts/obsidian/graph-view-deets/GVFull.png" medium="image" type="image/png" height="81" width="144"/>
</item>
</channel>
</rss>
