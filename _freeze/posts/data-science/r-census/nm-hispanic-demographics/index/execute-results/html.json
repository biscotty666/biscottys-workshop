{
  "hash": "1bda83bf7dece7edcc7559e22273a101",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Hispanics in New Mexico\nsubtitle: A A demographic study with R and TidyCensus\ndescription: New Mexico has a Latino population unlike anywhere else in the US. This article shows how to use R and tidycensus to explore the data.\noutput: \n  html_document:\n    toc: true\n    keep_md: true\n    self_contained: true\ndate: 2025-05-24\ncode-overflow: wrap\ncategories: [R, Data Science, GIS]\ndraft: false\n---\n\n\n# Motivation\n\nThis article will explore some interesting aspects of New Mexico's racial demographics using R and the TidyCensus package. The US Census Bureau makes an amazing amount of data available to the public on <https://census.gov>. The site allows you to easily search for and download demographic information with myriad variables and geographic subsets. The site also provides an API for programmatic access, and R is fortunate to have the TidyCensus package to easily grab data of interest to the programmer.\n\nNew Mexico has relatively large Native American and Hispanic populations. Nearly half of New Mexico residents are Hispanic, compared to a national average of around 20% (we'll calculate it later). The profile of Latinos in New Mexico, however, is very different from the rest of the country, as we shall see.\n\nNot only is the Hispanic population of New Mexico uniquely large in percentage terms, it is also unusual in terms of national identity of the Hispanics. Unlike Latinos in most of the rest of the country, many Hispanics in New Mexico do not identify at all with Latin America, but directly with their European ancestry.\n\nThe rest of this article will explore the Hispanic population in New Mexico and the historical context which explains this particular situation. Along the way, I will show how to use the R package `tidycensus` to access the wealth of data on <https://census.gov>.\n\n# A little history\n\nNew Mexico has the oldest state capital in the United States, Santa Fe having been founded 10 years before Boston. While the British were exploring from the coast, the Spaniards were moving upwards from what was to be Mexico into the territory that would become New Mexico.\n\nMexico won independence from Spain in 1821, and that included New Mexico. While the Spanixh residents gave nominal allegiance to Mexico, it was never very enthusiastic. After the Treaty of Hidalgo, in which the territory of New Mexico was ceded to the United States, Hispanics quickly dropped any pro-Mexican sentiment, they might have had and were anxious to assert their identity as Americans with roots in Europe, not Latin America. This group is called *nuevomexicanos* by many, but in New Mexico they are called Hispanos.\n\n# Immigrants in New Mexico\n\n## Getting ACS data\n\nBefore looking at Latinos specifically, I would like to take a quick look at immigration to New Mexico, since many Hispanics are immigrants. Using `get_acs()` I can get data from the *American Community Survey* 5-year tables. The most time-consuming part is sifting through the thousands of variables to find the ones you want. Fortunately, `tidycensus` provides a function to download the variables, which can then be `View`ed and searched.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidycensus)\nlibrary(tidyverse)\nlibrary(tigris)\nlibrary(patchwork)\nlibrary(sf)\noptions(tigris_use_cache = TRUE)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nv23 <- load_variables(2023, \"acs5\", cache = TRUE)\nView(v23)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npob_vars = c(\n  Native = \"B05002_002\",\n  ForeignBorn = \"B05002_013\"\n)\n```\n:::\n\n\nNow I can use `get_acs()` to download the data. There are many possibilities for `geography`, which is required. Some are obvious like \"us\", \"state\" and \"county\". I specify which state I want. The `summary_var` argument adds an additional column to the data frame containing totals, allowing for easy calculations of percentages.\n\n`get_acs()` has an optional argument which can be passed, `geometry = TRUE`. This handy method adds geometries from `tigris` and returns the `sf` object necessary for cartographic plotting. Unfortunately, I get errors using this for county and state data, so I need to manually perform the process.\n\nFirst, I'll grab shapes for the states and for the counties in New Mexico. The `shift_geometry()` function will put Alaska and Hawaii in a convenient place on the maps. `GEOID` is standard across all datasets, and encodes the state, county, and census tract, depending on the level of data requested. There are many columns in the `tigris` datasets, but I only want the name and geometry.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tigris)\nstates <- states() |> \n  select(GEOID, state = NAME, geometry) |> \n  shift_geometry()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRetrieving data for the year 2021\n```\n\n\n:::\n\n```{.r .cell-code}\nnm_counties <- counties(\"NM\") |> \n  select(GEOID, county = NAME, geometry)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRetrieving data for the year 2022\n```\n\n\n:::\n:::\n\n\nNow, with standard `dplyr` syntax, I can create the `sf` data frame. I want to do comparisons to the US in general, so I will also get data for all 50 states. `left_join` allows me to add the geometry from `nm_counties` based on the invaluable `GEOID`. Once joined, though, I no longer need it, nor a number of other columns, so I select the ones I want.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimmigration_23 <- get_acs(\n  geography = \"county\",\n  state = \"NM\",\n  variables = pob_vars,\n  summary_var = \"B05002_001\",\n  year = 2023,\n  cache_table = TRUE,\n) |> \n  left_join(nm_counties,  by = \"GEOID\") |> \n  select(variable, estimate, moe,\n         county, summary_est, geometry) |> \n  st_as_sf()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2019-2023 5-year ACS\n```\n\n\n:::\n:::\n\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimmigration_us <- get_acs(\n  geography = \"state\",\n  variables = pob_vars,\n  summary_var = \"B05002_001\",\n  year = 2023,\n  cache_table = TRUE,\n) |> \n  left_join(states,  by = \"GEOID\") |> \n  select(variable, estimate, moe,\n         state, summary_est, geometry) |> \n  st_as_sf()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2019-2023 5-year ACS\n```\n\n\n:::\n:::\n\n\n:::\n\nPercentages can be more interesting than raw numbers, so I will calculate them. R makes it so easy to create new columns based on existing ones.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimmigration_23$pct_foreign = immigration_23$estimate / immigration_23$summary_est\nimmigration_us$pct_foreign = immigration_us$estimate / immigration_us$summary_est\n```\n:::\n\n\nNow we can see some basic stats:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npct_fb_nm <- with(\n  immigration_23, \n  mean(pct_foreign[variable == \"ForeignBorn\"]))\npct_fb_us <- with(\n  immigration_us, \n  mean(pct_foreign[variable == \"ForeignBorn\"]))\ndata.frame(\n  Area = c(\"New Mexico\", \"US\"),\n  Average = c(pct_fb_nm, pct_fb_us)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Area    Average\n1 New Mexico 0.06774040\n2         US 0.09565981\n```\n\n\n:::\n:::\n\n\nDespite having a the largest Hispanic population in the country, New Mexico has a much smaller percentage of immigrants than the overall average.\n\n## Visualizing the data\n\nI would like to visualize this data. Explaining `ggplot` is beyond the scope of this article, unfortunately. I highly recommend the [R Graphics Cookbook](https://r-graphics.org/). I use the `+` operator from the `patchwork` library to put the plots side by side.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1 <- ggplot(immigration_23, \n             aes(x = variable, y = estimate)) +\n  geom_col(fill = \"navy\") +\n  labs(x = element_blank(),\n       y = \"Population\",\n       fill = \"County\",\n       title = \"New Mexico\") +\n  scale_y_continuous(labels = scales::comma) +\n  theme_bw()\n\np2 <- ggplot(immigration_us, aes(x = variable, y = estimate)) +\n  geom_col(fill = \"navy\") +\n  labs(x = element_blank(),\n       y = \"Population\",\n       title = \"US\",\n       caption = \"acs5 2023\") +\n  scale_y_continuous(labels = scales::comma) +\n  labs(y = element_blank(),\n       caption = \"Source: census.gov acs5 2023\") +\n  theme_bw()\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![Foreign vs. Native Populations](index_files/figure-html/fig-fvn-col-1.png){#fig-fvn-col fig-align='center' width=80%}\n:::\n:::\n\n\nWe can see on a map where the largest concentration of immigrant groups are.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nimmigration_us$percent <- immigration_us$estimate / immigration_us$summary_est\n\nimmigration_us |> \n  filter(variable == \"ForeignBorn\") |> \n  ggplot(aes(fill = percent)) +\n  geom_sf(aes(geometry = geometry)) +\n  scale_fill_viridis_c(labels = scales::percent) +\n  labs(title = \"Immigrant population by state\",\n       caption = \"Source: census.gov acs5 2023\") +\n  theme_void() +\n  theme(plot.margin = margin(.3,.3,.3,.3, \"cm\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-imm-pop-state-1.png){#fig-imm-pop-state fig-align='center' width=90%}\n:::\n:::\n\n\nI'd like to put some cities on the New Mexico map for orientation purposes. As of this writing, I am unable to use the standard `tigris::places(\"NM\", year = 23)` command, as it says that the data is unavailable. So I needed to download the file from <https://www2.census.gov/geo/tiger/TIGER2023/PLACE/>. I'll extract a few cities in different parts of the state. The shapefiles are POLYGONs, but I need a single point, so I'll use `st_centroid()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplaces <- read_sf(\"data/places/tl_2023_35_place.shp\")\ncities <- c(\"Albuquerque\", \"Santa Fe\", \n            \"Las Cruces\", \"Raton\", \"Roswell\",\n            \"Gallup\", \"Santa Rosa\", \"Farmington\")\ncity_pts <- places |> \n  filter(NAME %in% cities) |> \n  select(City = NAME, geometry) |> \n  st_as_sf() |> \n  st_centroid()\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfb <- immigration_23 |> \n  filter(variable == \"ForeignBorn\") \n\nggplot() +\n  geom_sf(data = fb, aes(fill = pct_foreign)) +\n  geom_sf(data = city_pts, size = .5, color = \"red\") +\n  geom_sf_text(data = city_pts, aes(label = City),\n               size = 3, color = \"gold\",\n               vjust = \"top\",hjust = \"left\",\n               nudge_y = -.1) +\n  scale_fill_viridis_c(labels = scales::percent) +\n  labs(title = \"NM Immigrant population by county\",\n       caption = \"Source: census.gov acs5 2023\", \n       fill = \"percent\") +\n  theme_void() +\n  theme(plot.margin = margin(.3,.3,.3,.3, \"cm\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-imm-pop-county-1.png){#fig-imm-pop-county fig-align='center' width=90%}\n:::\n:::\n\n\nNot surprisingly, the highest percentage of immigrants is near the Mexican border.\n\n# Origins of immigrants\n\nSince we are concerned with Hispanics, it is useful to have an idea about immigration from Latin America, and Mexico in particular given that NM is a border state. I will get the data associated with the birth place of foreign residents.\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\norig_vars_23 = c(\n  Europe = \"B05006_002\",\n  Asia = \"B05006_047\",\n  Eastern_Asia = \"B05006_048\",\n  China = \"B05006_049\",\n  Asia_SC = \"B05006_056\",\n  Asia_SE = \"B05006_068\",\n  Vietnam = \"B05006_077\",\n  Asia_W = \"B05006_079\",\n  Africa = \"B05006_095\",\n  Oceania = \"B05006_130\",\n  Latin_America = \"B05006_139\",\n  Caribbean = \"B05006_140\",\n  Central_America = \"B05006_154\",\n  Mexico = \"B05006_160\",\n  South_America = \"B05006_164\",\n  Canada = \"B05006_177\"\n)\n```\n:::\n\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nforeign_origin_nm <- get_acs(\n  geography = \"county\",\n  state = \"NM\",\n  variables = orig_vars_23,\n  summary_var = \"B05006_001\",\n  year = 2023,\n  cache_table = TRUE\n) |> \n  left_join(nm_counties, by = \"GEOID\") |> \n  select(variable, estimate, moe,\n            county, total = summary_est, \n            geometry) |> \n  st_as_sf()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2019-2023 5-year ACS\n```\n\n\n:::\n:::\n\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncontinents <- c(\n  \"Europe\",\n  \"Central_America\",\n  \"Asia\",\n  \"South_America\",\n  \"Africa\",\n  \"Oceania\",\n  \"Canada\"\n)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- foreign_origin_nm |> \n  filter(variable %in% continents) |> \n  mutate(variable = fct_reorder(variable, desc(estimate))) |> \n  ggplot(aes(x = variable, y = estimate, fill = county)) +\n  geom_col() +\n  labs(x = \"Continent\",\n       y = \"Population\",\n       fill = \"County\",\n       title = \"Origins of foreign-born New Mexico population\",\n       subtitle = \"By Continent\",\n       caption = \"Source: census.gov acs5 2023\") +\n  scale_y_continuous(labels = scales::comma) +\n  theme_gray() +\n  theme(axis.text.x = element_text(angle = 30),\n        plot.margin = margin(.3,.3,.3,.3, \"cm\"))\n```\n:::\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fb-nm-bar-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nThe largest group of immigrants is from Central America, which includes Mexico in these tables. Zooming in on the eight most populated counties is interesting, showing a sizeable number of Asian immigrants, especially around Albuquerque (Bernalillo County).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties_top_8 <- foreign_origin_nm |> \n  group_by(county) |> \n  summarise(est_sum = sum(estimate)) |> \n  slice_max(order_by = est_sum, n = 8) |>\n  ungroup()\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nforeign_origin_nm |> \n  filter(variable %in% continents & county %in% counties_top_8$county) |> \n  mutate(county = fct_reorder(county, desc(total))) |> \n  ggplot(aes(x = county, y = estimate, fill = variable)) +\n  geom_col() +\n  labs(x = \"County\",\n       y = \"Population\",\n       fill = \"Continent\",\n       title = \"Origins of foreign-born New Mexico population\",\n       subtitle = \"Top 10 Counties by Population\",\n       caption = \"Source: census.gov acs5 2023\") +\n  scale_y_continuous(labels = scales::comma) +\n  scale_fill_viridis_d(labels = c(\"Africa\", \"Asia\", \"Canada\", \"Central America\",\n                               \"Europe\", \"Oceania\", \"South America\")) +\n  theme_gray() +\n  theme(axis.text.x = element_text(angle = 30))\n```\n\n::: {.cell-output-display}\n![Continents of origin for New Mexican Immigrants](index_files/figure-html/fig-fb-nm-1.png){#fig-fb-nm fig-align='center' width=90%}\n:::\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\n# Hispanics\n\nLet's look at where most Latinos live in the country.\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_hisp_pct <- get_acs(\n  geography = \"state\",\n  variables = c(\"B03001_002\", \"B03001_003\"),\n  summary_var = \"B03001_001\",\n  year = 2023,\n  cache_table = TRUE\n) |>\n  select(-moe, -summary_moe) |> \n  pivot_wider(names_from = variable, \n              values_from = estimate) |> \n  rename(State = \"NAME\", \n         Total = \"summary_est\", \n         Non_Hispanic = \"B03001_002\", \n         Hispanic = \"B03001_003\") |> \n  mutate(Hispanic_Pct = Hispanic / Total) |> \n  left_join(states, by = \"GEOID\") |> \n  st_as_sf() |> \n  shift_geometry()\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- us_hisp_pct |> \n  filter(state != \"Puerto Rico\") |> \n  ggplot(aes(fill = Hispanic_Pct)) +\n  geom_sf() +\n  labs(title = \"Hispanic Population by State\",\n       fill = \"Percent\",\n       caption = \"Source: census.gov acs5 2023\"\n       ) +\n  scale_fill_viridis_c(labels = scales::percent, \n                       limits = c(0,.5)) +\n  theme_void() +\n  theme(plot.margin = margin(.5,.5,.5,.5, \"cm\"))\n```\n:::\n\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-his-state-map-1.png){#fig-his-state-map fig-align='center' width=90%}\n:::\n:::\n\n\n\nHow about the top 5 states by total Latinos? Not surprisingly, the largest states have the largest population of Hispanics, and New Mexico doesn't even make the list.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_hisp_pct |> \n  st_drop_geometry() |> \n  slice_max(order_by = Hispanic, n = 8) |> \n  select(State, Hispanic)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 2\n  State       Hispanic\n  <chr>          <dbl>\n1 California  15630830\n2 Texas       11697134\n3 Florida      5865737\n4 New York     3898652\n5 Puerto Rico  3215824\n6 Illinois     2348118\n7 Arizona      2255770\n8 New Jersey   2032968\n```\n\n\n:::\n:::\n\n\nOn the other hand, looking by percentage tells a different story:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_hisp_pct |> \n  st_drop_geometry() |> \n  slice_max(order_by = Hispanic_Pct, n = 8) |> \n  select(State, Hispanic_Pct)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 2\n  State       Hispanic_Pct\n  <chr>              <dbl>\n1 Puerto Rico        0.988\n2 New Mexico         0.482\n3 California         0.398\n4 Texas              0.395\n5 Arizona            0.310\n6 Nevada             0.292\n7 Florida            0.267\n8 Colorado           0.222\n```\n\n\n:::\n:::\n\n\nAs you can see, New Mexico is the state with the highest proportion of Latinos, nearly half, and almost 10% higher than the next highest states.\n\nWe can see how Latinos are spread across New Mexico. For easy plotting, I will make columns from the two variables using `pivot_wider()` and add a column with percentages.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnm_hisp_pct <- get_acs(\n  geography = \"county\",\n  state = \"NM\",\n  variables = c(\"B03001_002\", \"B03001_003\"),\n  summary_var = \"B03001_001\",\n  year = 2023,\n  cache_table = TRUE) |> \n  left_join(nm_counties,\n            by = \"GEOID\") |> \n  select(-moe, -summary_moe) |> \n  pivot_wider(names_from = variable, values_from = estimate) |> \n  rename(County = \"NAME\", Total = \"summary_est\", \n         Non_Hispanic = \"B03001_002\", Hispanic = \"B03001_003\") |> \n  mutate(Hispanic_Pct = Hispanic / Total) |> \n  st_as_sf()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2019-2023 5-year ACS\n```\n\n\n:::\n:::\n\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot() +\n  geom_sf(data = nm_hisp_pct, aes(fill = Hispanic_Pct)) +\n  geom_sf(data = city_pts, size = .5, color = \"red\") +\n  geom_sf_text(data = city_pts, aes(label = City),\n               size = 3, color = \"gold\",\n               vjust = \"top\",hjust = \"left\",\n               nudge_y = -.1) +\n  labs(title = \"Hispanic Population in New Mexico\",\n       fill = \"Percent\",\n       caption = \"Source: census.gov acs5 2023\"\n       ) +\n  scale_fill_viridis_c(labels = scales::percent, limits = c(0,.8)) +\n  theme_void() +\n  theme(plot.margin = margin(.3,.3,.3,.3, \"cm\"))\n```\n:::\n\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-his-pop-pct-1.png){#fig-his-pop-pct fig-align='center' width=90%}\n:::\n:::\n\n\nThe highest concentrations are not along the border, but in the Northern counties. These are the counties with the largest percentage of Hispanics, followed by the percentages in New Mexico's most populated counties.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnm_hisp_pct |> \n  slice_max(order_by = Hispanic_Pct, n = 8) |> \n  st_drop_geometry() |> \n  select(county, Hispanic_Pct)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 2\n  county     Hispanic_Pct\n  <chr>             <dbl>\n1 Mora              0.761\n2 San Miguel        0.753\n3 Guadalupe         0.745\n4 Doña Ana          0.676\n5 Rio Arriba        0.673\n6 Luna              0.665\n7 De Baca           0.635\n8 Lea               0.616\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnm_hisp_pct |> \n  filter(county %in% counties_top_8$county) |> \n  st_drop_geometry() |> \n  select(county, Hispanic_Pct)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 2\n  county     Hispanic_Pct\n  <chr>             <dbl>\n1 Bernalillo        0.489\n2 Chaves            0.579\n3 Doña Ana          0.676\n4 Lea               0.616\n5 Otero             0.391\n6 Sandoval          0.395\n7 Santa Fe          0.480\n8 Valencia          0.606\n```\n\n\n:::\n:::\n\n\n# Hispanic origins\n\nNow let's look at the national origins of Latinos in New Mexico.\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhisp_vars = c(\n  Non_Hispanic = \"B03001_002\",\n  Hispanic = \"B03001_003\",\n  Hispanic_Mexican  = \"B03001_004\",\n  Hispanic_PR = \"B03001_005\", \n  Hispanic_Cuba = \"B03001_006\", \n  Hispanic_DR = \"B03001_007\", \n  Hispanic_CA = \"B03001_008\", \n  Hispanic_SA = \"B03001_016\", \n  Hispanic_Spaniard = \"B03001_028\",\n  Hispanic_Spanish = \"B03001_029\",\n  Hispanic_Spanish_American = \"B03001_030\",\n  Hispanic_White = \"B03002_013\"\n)\n```\n:::\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhispanic_nm <- get_acs(\n  geography = \"county\",\n  state = \"NM\",\n  variables = hisp_vars,\n  summary_var = \"B03001_001\",\n  year = 2023,\n  cache_table = TRUE) |> \n  left_join(nm_counties, by = \"GEOID\") |> \n  select(GEOID, variable, estimate, moe,\n            county, summary_est, \n            geometry) |> \n  st_as_sf()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2019-2023 5-year ACS\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhispanic_us <- get_acs(\n  geography = \"state\",\n  variables = hisp_vars,\n  summary_var = \"B03001_001\",\n  year = 2023,\n  cache_table = TRUE) |> \n  left_join(states, by = \"GEOID\") |> \n  select(GEOID, variable, estimate, moe,\n            state, summary_est, \n            geometry) |> \n  st_as_sf()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2019-2023 5-year ACS\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhispanic_nm <- hispanic_nm |> \n  pivot_wider(names_from = variable, values_from = estimate) |> \n  rowwise() |> \n  mutate(Hispanic_Spain = sum(c_across(Hispanic_Spaniard:Hispanic_Spanish_American), na.rm = TRUE)) |> \n  select(-c(\"Hispanic_Spaniard\", \"Hispanic_Spanish\", \"Hispanic_Spanish_American\")) |> \n  pivot_longer(cols = Non_Hispanic:Hispanic_Spain, names_to = \"variable\", values_to = \"estimate\", values_drop_na = T) |> \n  group_by(county, variable) |> \n  mutate(pop = sum(estimate)) |> \n  distinct(county, variable, .keep_all = TRUE)\n```\n:::\n\n\n:::\n\nFirst, here are the proportions of Hispanic to Non-Hispanic in the biggest counties.\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- hispanic_nm |> \n  filter(county %in% counties_top_8$county & variable %in% c(\"Hispanic\", \"Non_Hispanic\")) |> \n  mutate(county = fct_reorder(county, desc(estimate))) |> \n  ggplot(aes(x = county, y = estimate, fill = variable)) +\n  geom_col(position = \"dodge\") +\n  labs(x = \"County\",\n       y = \"Population\",\n       fill = \"Continent\",\n       title = \"Hispanic vs Non-Hispanic population in New Mexico\",\n       subtitle = \"Top 10 Counties by Population\",\n       caption = \"Source: census.gov acs5 2023\") +\n  scale_y_continuous(labels = scales::comma) +\n  scale_fill_viridis_d(labels = c(\"Hispanic\", \"Non Hispanic\")) +\n  theme_gray() +\n  theme(axis.text.x = element_text(angle = 30)) +\n  theme(plot.margin = margin(.3,.3,.3,.3, \"cm\"))\n```\n:::\n\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-hvnv-bar-1.png){#fig-hvnv-bar fig-align='center' width=90%}\n:::\n:::\n\n\n\nAnd then the national identities from the same counties.\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- hispanic_nm |> \n  filter(county %in% counties_top_8$county & !(variable %in% c(\"Hispanic\", \"Non_Hispanic\"))) |> \n  mutate(county = fct_reorder(county, desc(pop))) |> \n  ggplot(aes(x = county, y = pop, fill = factor(variable, levels = c(\"Hispanic_White\", \"Hispanic_Spain\", \"Hispanic_Mexican\", \"Hispanic_CA\")))) +\n  geom_col(position = \"dodge\") +\n  labs(x = \"County\",\n       y = \"Population\",\n       fill = \"Race\",\n       title = \"Origin Identification of Hispanic Population\",\n       subtitle = \"Top 10 Counties by Population\",\n       caption = \"Source: census.gov acs5 2023\") +\n  scale_y_continuous(labels = scales::comma) +\n  scale_fill_viridis_d(labels = c(\"White\", \"Spanish\", \"Mexican\", \"Central American\")) +\n  theme_gray() +\n  theme(axis.text.x = element_text(angle = 30)) +\n  theme(plot.margin = margin(.3,.3,.3,.3, \"cm\"))\n```\n:::\n\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-org-ident-1.png){#fig-org-ident fig-align='center' width=90%}\n:::\n:::\n\n\n\nMost Hispanics clearly identify with Mexico, as is true nationally, and White implies European, and therefore Spanish, heritage.\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\nThis is a good example of building an extended workflow which obtains the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhispanic_us <- get_acs(\n  geography = \"state\",\n  variables = hisp_vars,\n  summary_var = \"B03001_001\",\n  year = 2023,\n  cache_table = TRUE) |> \n  rename(state = NAME) |> \n  pivot_wider(names_from = variable, values_from = estimate) |> \n  rowwise() |> \n  mutate(Hispanic_Spain = sum(c_across(Hispanic_Spaniard:Hispanic_Spanish_American), na.rm = TRUE)) |> \n  select(-c(\"Hispanic_Spaniard\", \"Hispanic_Spanish\", \"Hispanic_Spanish_American\")) |> \n  pivot_longer(cols = Non_Hispanic:Hispanic_Spain, names_to = \"variable\", values_to = \"estimate\", values_drop_na = T)|> \n  group_by(state, variable) |> \n  mutate(pop = sum(estimate)) |> \n  distinct(variable, .keep_all = TRUE) |> \n  mutate(percent = pop / summary_est) |> \n  left_join(states, by = \"GEOID\") |> \n  select(variable, pop, summary_est,\n         state = state.y, geometry) |> \n  st_as_sf()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2019-2023 5-year ACS\n```\n\n\n:::\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhispanic_us$percent = hispanic_us$pop / hispanic_us$summary_est\np1 <- hispanic_us |> \n  filter(state != \"Puerto Rico\" & !(variable %in% c(\"Hispanic\", \"Non_Hispanic\"))) |> \n  group_by(variable) |> \n  summarise(\n    pop = sum(pop),\n    percent = mean(percent)\n  ) |> \n  mutate(variable = fct_reorder(variable, desc(pop))) |> \n  ggplot(aes(x = variable, y = pop)) +\n  geom_col(fill = \"cyan\") +\n  labs(x = \"Nationality\",\n       y = \"Population\",\n       title = \"National Identification of\\nHispanic Population in the US\",\n       caption = \"Source: census.gov acs5 2023\") +\n  scale_y_continuous(labels = scales::comma) +\n  scale_x_discrete(\n    labels = c(\"Mexican\", \"White\", \"Central America\", \n               \"Puerto Rico\", \"South America\", \"Cuba\", \n               \"Dominican Republic\", \"Spain\")) +\n  theme_gray() +\n  theme(\n    axis.text.x = element_text(\n      angle = 30, hjust = .5),\n    plot.margin = margin(.3,.3,.3,.3, \"cm\"))\n```\n:::\n\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1\n```\n\n::: {.cell-output-display}\n![National Identification of Hispanic Population in the US](index_files/figure-html/fig-nat-ori-1.png){#fig-nat-ori fig-align='center' width=90%}\n:::\n:::\n\n\nBefore moving on, I want to highlight the code that produced this dataset, as it demonstrates how easily obtaining and wrangling data can be done with a chained workflow in R thanks to the pipe (`|>`). In this case, I want to combine the values of three variables into one. The data downloaded has three variables for Hispanics of Spanish descent (Spanish, Spaniard and Spanish American), which I want to combine into a single value. In this code, I `pivod_wider` to have the variables in columns. Then I sum the three columns to create a new column, drop the now unneeded ones, and pivot back to the long form which `ggplot` likes. I further calculate percents, and then add geometries for mapping, select only the columns I need, and creating an `sf` object.\n\nAll of that with one command! (Well, a long one.)\n\n```{{r}}\nhispanic_us <- get_acs(\n  geography = \"state\",\n  variables = hisp_vars,\n  summary_var = \"B03001_001\",\n  year = 2023,\n  cache_table = TRUE) |>\n  rename(state = NAME) |> \n  pivot_wider(names_from = variable, values_from = estimate) |> \n  rowwise() |> \n  mutate(Hispanic_Spain = sum(c_across(Hispanic_Spaniard:Hispanic_Spanish_American), na.rm = TRUE)) |> \n  select(-c(\"Hispanic_Spaniard\", \"Hispanic_Spanish\", \"Hispanic_Spanish_American\")) |> \n  pivot_longer(cols = Non_Hispanic:Hispanic_Spain, names_to = \"variable\", values_to = \"estimate\", values_drop_na = T)|> \n  group_by(state, variable) |> \n  mutate(pop = sum(estimate)) |> \n  distinct(variable, .keep_all = TRUE) |> \n  mutate(percent = pop / summary_est) |> \n  left_join(states, by = \"GEOID\") |> \n  select(variable, pop, summary_est,\n         state = state.y, geometry) |> \n  st_as_sf()\n```\n\n\nNew Mexico has the highest proportion of Hispanics who identify as white after Puerto Rico.\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- hispanic_us |> \n  filter(variable == \"Hispanic_White\") |> \n  ggplot(aes(fill = percent)) +\n  geom_sf(aes(geometry = geometry)) +\n  scale_fill_viridis_c(labels = scales::percent) +\n  labs(title = \"Hispanics with White identity\",\n       caption = \"Source: census.gov acs5 2023\") +\n  theme_void() +\n  theme(plot.margin = margin(.3,.3,.3,.3, \"cm\"))\n```\n:::\n\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-hisp-white-1.png){#fig-hisp-white fig-align='center' width=90%}\n:::\n:::\n\n\nNow let's see how the various groups of Hispanics are distributed in the state. First, for all Hispanics:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhispanic_nm$percent <- hispanic_nm$pop / hispanic_nm$summary_est\n```\n:::\n\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhisp <- hispanic_nm |> filter(variable == \"Hispanic\")\np1 <- ggplot() +\n  geom_sf(data = hisp, aes(fill = percent)) +\n  geom_sf(data = city_pts, size = .5, color = \"red\") +\n  geom_sf_text(data = city_pts, aes(label = City),\n               size = 3, color = \"gold\",\n               vjust = \"top\",hjust = \"left\",\n               nudge_y = -.1) +\n  labs(title = \"Hispanic Population in New Mexico\",\n       fill = \"Percent\") +\n  scale_fill_viridis_c(labels = scales::percent) +\n  theme_void()\np2 <- ggplot() +\n  geom_sf(data = hisp, aes(fill = pop)) +\n  geom_sf(data = city_pts, size = .5, color = \"red\") +\n  geom_sf_text(data = city_pts, aes(label = City),\n               size = 3, color = \"gold\",\n               vjust = \"top\",hjust = \"left\",\n               nudge_y = -.1) +\n  labs(fill = \"Population\",\n       caption = \"Source: census.gov acs5 2023\") +\n  scale_fill_viridis_c(labels = scales::comma) +\n  theme_void()\n\np1 + p2\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1 + p2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-hisp-nm-1.png){#fig-hisp-nm fig-align='center' width=90%}\n:::\n:::\n\n\nNow let's look at where Spanish Hispanics live in the state. In the second set of maps, I combine the Spanish and White Hispanic populations.\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhisp_spain <- hispanic_nm |> filter(variable == \"Hispanic_Spain\")\np1 <- ggplot() +\n  geom_sf(data = hisp_spain, aes(fill = percent)) +\n  geom_sf(data = city_pts, size = .5, color = \"red\") +\n  geom_sf_text(data = city_pts, aes(label = City),\n               size = 3, color = \"gold\",\n               vjust = \"top\",hjust = \"left\",\n               nudge_y = -.1) +\n  labs(title = \"Spanish Population in New Mexico\",\n       fill = \"Percent\",\n       ) +\n  scale_fill_viridis_c(labels = scales::percent) +\n  theme_void()\np2 <- ggplot() +\n  geom_sf(data = hisp_spain, aes(fill = pop)) +\n  geom_sf(data = city_pts, size = .5, color = \"red\") +\n  geom_sf_text(data = city_pts, aes(label = City),\n               size = 3, color = \"gold\",\n               vjust = \"top\",hjust = \"left\",\n               nudge_y = -.1) +\n  labs(fill = \"Population\") +\n  scale_fill_viridis_c(labels = scales::comma) +\n  theme_void()\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhisp_spain_white <- hispanic_nm |> \n  filter(variable == \"Hispanic_Spain\" | variable == \"Hispanic_White\")\np3 <- ggplot() +\n  geom_sf(data = hisp_spain_white, aes(fill = percent)) +\n  geom_sf(data = city_pts, size = .5, color = \"red\") +\n  geom_sf_text(data = city_pts, aes(label = City),\n               size = 3, color = \"gold\",\n               vjust = \"top\",hjust = \"left\",\n               nudge_y = -.1) +\n  labs(title = \"Spanish & Hispanic-White Population in New Mexico\",\n       fill = \"Percent\",\n       ) +\n  scale_fill_viridis_c(labels = scales::percent) +\n  theme_void()\np4 <- ggplot() +\n  geom_sf(data = hisp_spain_white, aes(fill = pop)) +\n  geom_sf(data = city_pts, size = .5, color = \"red\") +\n  geom_sf_text(data = city_pts, aes(label = City),\n               size = 3, color = \"gold\",\n               vjust = \"top\",hjust = \"left\",\n               nudge_y = -.1) +\n  labs(fill = \"Population\",\n       caption = \"Source: census.gov acs5 2023\") +\n  scale_fill_viridis_c(labels = scales::comma) +\n  theme_void()\n```\n:::\n\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(p1 + p2) / (p3 + p4)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-hisp-nm3-1.png){#fig-hisp-nm3 fig-align='center' width=90%}\n:::\n:::\n\n\nThe Hispanos are clearly concentrated in the north-eastern part of the state. Let's see about the Mexican Hispanics.\n\n::: {.callout-note icon=\"false\" collapse=\"true\"}\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhisp_mex <- hispanic_nm |> \n  filter(variable == \"Hispanic_Mexican\")\np1 <- ggplot() +\n  geom_sf(data = hisp_mex, aes(fill = percent)) +\n  geom_sf(data = city_pts, size = .5, color = \"red\") +\n  geom_sf_text(data = city_pts, aes(label = City),\n               size = 3, color = \"gold\",\n               vjust = \"top\",hjust = \"left\",\n               nudge_y = -.1) +\n  labs(title = \"Mexican Immigrant Population in New Mexico\",\n       fill = \"Percent\"\n       ) +\n  scale_fill_viridis_c(labels = scales::percent) +\n  theme_void()\np2 <- ggplot() +\n  geom_sf(data = hisp_mex, aes(fill = pop)) +\n  geom_sf(data = city_pts, size = .5, color = \"red\") +\n  geom_sf_text(data = city_pts, aes(label = City),\n               size = 3, color = \"gold\",\n               vjust = \"top\",hjust = \"left\",\n               nudge_y = -.1) +\n  labs(fill = \"Population\",\n       caption = \"Source: census.gov acs5 2023\") +\n  scale_fill_viridis_c(labels = scales::comma) +\n  theme_void()\n```\n:::\n\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1 + p2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-hisp-nm4-1.png){#fig-hisp-nm4 fig-align='center' width=90%}\n:::\n:::\n\n\nThe Mexican Hispanics are concentrated in the southern part of the state. It is clear from the maps that these two groups, Spanish and Mexican, are largely distinct geographically. In all cases, unsurprisingly, the largest number of people in each group live in the primary urban center of the state.\n\n# Next steps\n\nIn Bernalillo County, home of Albuquerque, the largest city by far in New Mexico, there are large numbers of all ethnicities represented in the state. It will be interesting to drill down on the county to see whether the geographic sepearation persists in an urban setting. Additionally, spatial modeling could be used to verify that the apparent geographic separation between the two groups is not random. Such an analysis would probably be more interesting in the context of the urban melting pot of Albuquerque. Thirdly, a time series analysis regarding the increase or decrease in the Mexican population to understand how the situation is evolving. Finally, correlation of the geographic distribution with statistics such as income, housing value, or the GINI statistic could be elucidating.\n\nThis notebook with all the code is available in my [GitHub repository](http://localhost:4326/posts/data-science/r-census/nm-hispanic-demographics/index.qmd). Happy coding. And if you have pointers to improve my code, I would be grateful for comments. Happy coding!\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}